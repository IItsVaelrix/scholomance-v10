import{r as M,g as na,j as b,m as zn,e as Ji,f as Bn,A as ra,h as ia,i as sa,k as oa}from"./index-DJ7VUbM-.js";var Vi=function(){},la=typeof window<"u",aa=function(n,e,t){if(!la)return[e,Vi,Vi];var r=JSON.parse,i=M.useRef(function(u){try{var f=t?t.raw?String:t.serializer:JSON.stringify,d=localStorage.getItem(u);return d!==null?r(d):(e&&localStorage.setItem(u,f(e)),e)}catch{return e}}),s=M.useState(function(){return i.current(n)}),o=s[0],l=s[1];M.useLayoutEffect(function(){return l(i.current(n))},[n]);var a=M.useCallback(function(u){try{var f=typeof u=="function"?u(o):u;if(typeof f>"u")return;var d=void 0;t||(d=JSON.stringify(f)),localStorage.setItem(n,d),l(r(d))}catch{}},[n,l]),c=M.useCallback(function(){try{localStorage.removeItem(n),l(void 0)}catch{}},[n,l]);return[o,a,c]};const ve={title:100,content:1e5},ca="scholomance-scrolls",In=1,ua=()=>`scroll-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,da=n=>Array.isArray(n)?n.map(e=>e._version===In||e._version?e:{...e,_version:1,createdAt:e.createdAt||Date.now(),updatedAt:e.updatedAt||Date.now()}):[];function fa(){const[n,e]=aa(ca,[]),t=M.useMemo(()=>da(n),[n]);M.useEffect(()=>{(n||[]).some(c=>c._version!==In)&&t.length>0&&e(t)},[n,t,e]);const r=M.useCallback((a,c)=>{const u=Date.now(),f=String(a||"").trim().slice(0,ve.title),d=String(c||"").trim().slice(0,ve.content),p={id:ua(),title:f||"Untitled Scroll",content:d,createdAt:u,updatedAt:u,_version:In};return e(h=>[p,...h||[]]),p},[e]),i=M.useCallback((a,c)=>{e(u=>(u||[]).map(f=>f.id===a?{...f,...c,title:c.title!==void 0?String(c.title).trim().slice(0,ve.title):f.title,content:c.content!==void 0?String(c.content).trim().slice(0,ve.content):f.content,updatedAt:Date.now(),_version:In}:f))},[e]),s=M.useCallback(a=>{e(c=>(c||[]).filter(u=>u.id!==a))},[e]),o=M.useCallback(a=>(t||[]).find(c=>c.id===a)||null,[t]);return{scrolls:M.useMemo(()=>[...t||[]].sort((a,c)=>c.updatedAt-a.updatedAt),[t]),createScroll:r,updateScroll:i,deleteScroll:s,getScrollById:o,scrollCount:(t||[]).length}}function ha({annotation:n,onClose:e}){const t=n?.evidence?.find(g=>g.type==="usage"&&g.value.startsWith("vowel:")),r=t?t.value.slice(6):"",i=na("vowelFamily",r),o=n?.evidence?.find(g=>g.type==="phoneme"&&!g.value.startsWith("coda:"))?.value?.split(/\s+/).filter(Boolean)||[],l=n?.evidence?.find(g=>g.type==="rhyme")?.value||"",a=n?.evidence?.filter(g=>g.type==="definition").map(g=>g.value)||[],c=n?.evidence?.find(g=>g.type==="phoneme"&&g.value.startsWith("coda:")),u=c?c.value.slice(5):null,f=M.useRef(null),d=M.useRef(null),p=M.useRef(null),[h,m]=M.useState(null);return M.useEffect(()=>{const g=_=>{_.key==="Escape"&&e?.()};return window.addEventListener("keydown",g),()=>window.removeEventListener("keydown",g)},[e]),M.useEffect(()=>{d.current?.focus()},[]),M.useLayoutEffect(()=>{const g=()=>{if(!f.current)return;const y=f.current.getBoundingClientRect(),x=window.innerWidth,C=window.innerHeight,w=-y.left,v=-y.top,T=x-(y.left+y.width),S=C-(y.top+y.height);m({left:w,top:v,right:T,bottom:S})};g();const _=()=>{requestAnimationFrame(g)};return window.addEventListener("resize",_),f.current&&window.ResizeObserver&&(p.current=new ResizeObserver(()=>{requestAnimationFrame(g)}),p.current.observe(f.current)),()=>window.removeEventListener("resize",_)},[]),b.jsxs(zn.aside,{className:`aside aside--grimoire surface annotation-panel ${i}`,"data-surface":"analysis","data-role":"overlay",initial:{y:18,opacity:0},animate:{y:0,opacity:1},exit:{y:18,opacity:0},transition:{type:"spring",damping:22},drag:!0,dragConstraints:h||void 0,dragMomentum:!1,dragElastic:.12,ref:f,role:"dialog","aria-modal":"true","aria-labelledby":"annotation-title",children:[b.jsx("div",{className:"aside-texture","aria-hidden":"true"}),b.jsxs("div",{className:"analysis-shell","data-role":"analysis",children:[b.jsxs("div",{className:"asideTop",children:[b.jsx("h3",{id:"annotation-title",className:"asideTitle accent-text",children:n.token}),b.jsx("button",{ref:d,className:"close grimoire-close",onClick:e,"aria-label":"Close",children:b.jsx("span",{children:"✕"})})]}),b.jsxs("div",{className:"annotation-content",children:[b.jsxs("div",{className:"stat grimoire-stat",children:[b.jsxs("div",{className:"statLabel",children:[b.jsx("span",{className:"stat-sigil",children:"✦"}),"Vowel Family"]}),b.jsx("div",{className:"statValue accent-text",children:r||"Unknown"})]}),b.jsxs("div",{className:"stat grimoire-stat",children:[b.jsxs("div",{className:"statLabel",children:[b.jsx("span",{className:"stat-sigil",children:"✧"}),"Phonemes"]}),b.jsx("div",{className:"statValue phoneme-list",children:o.map((g,_)=>b.jsx("span",{className:"phoneme-chip",children:g},_))})]}),b.jsxs("div",{className:"stat grimoire-stat",children:[b.jsxs("div",{className:"statLabel",children:[b.jsx("span",{className:"stat-sigil",children:"✨"}),"Rhyme Key"]}),b.jsx("div",{className:"statValue rhyme-key",children:l||"Unknown"})]}),a.length?b.jsxs("div",{className:"stat grimoire-stat",children:[b.jsxs("div",{className:"statLabel",children:[b.jsx("span",{className:"stat-sigil",children:"✶"}),"Definition"]}),b.jsx("div",{className:"statValue definition-list",children:a.map((g,_)=>b.jsx("div",{className:"definition-item",children:g},_))})]}):null,u&&b.jsxs("div",{className:"stat grimoire-stat",children:[b.jsxs("div",{className:"statLabel",children:[b.jsx("span",{className:"stat-sigil",children:"✩"}),"Coda"]}),b.jsx("div",{className:"statValue",children:u})]})]}),b.jsxs("div",{className:"aside-footer",children:[b.jsx("div",{className:"grimoire-divider",children:b.jsx("span",{children:"❧"})}),b.jsx("p",{className:"aside-note",children:"Word analysis powered by the ST-XPD vowel family system."})]})]})]})}const ao=M.createContext(null);function ga(n,e){return{getTheme:function(){return e??null}}}function Je(){const n=M.useContext(ao);return n==null&&(function(e,...t){const r=new URL("https://lexical.dev/docs/error"),i=new URLSearchParams;i.append("code",e);for(const s of t)i.append("v",s);throw r.search=i.toString(),Error(`Minified Lexical error #${e}; visit ${r.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)})(8),n}function k(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function co(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);t.search=r.toString(),console.warn(`Minified Lexical warning #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const we=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,pa=we&&"documentMode"in document?document.documentMode:null,Ne=we&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),ft=we&&/^(?!.*Seamonkey)(?=.*Firefox).*/i.test(navigator.userAgent),Wn=!(!we||!("InputEvent"in window)||pa)&&"getTargetRanges"in new window.InputEvent("input"),gn=we&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),Bt=we&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,ma=we&&/Android/.test(navigator.userAgent),uo=we&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Hi=we&&ma&&uo,pn=we&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&Ne&&!uo;function fo(...n){const e=[];for(const t of n)if(t&&typeof t=="string")for(const[r]of t.matchAll(/\S+/g))e.push(r);return e}const ya=0,_a=1,xa=2,ho=128,va=1,Sa=2,Ca=3,ba=4,Na=5,Ea=6,or=gn||Bt||pn?" ":"​",Qe=`

`,wa=ft?" ":or,ht={bold:1,capitalize:1024,code:16,highlight:ho,italic:2,lowercase:256,strikethrough:4,subscript:32,superscript:64,underline:8,uppercase:512},Ta={directionless:1,unmergeable:2},Yi={center:2,end:6,justify:4,left:1,right:3,start:5},ka={[Sa]:"center",[Ea]:"end",[ba]:"justify",[va]:"left",[Ca]:"right",[Na]:"start"},Ma={normal:0,segmented:2,token:1},Oa={[ya]:"normal",[xa]:"segmented",[_a]:"token"},Gi="$config";function go(n,e,t,r,i,s){let o=n.getFirstChild();for(;o!==null;){const l=o.__key;o.__parent===e&&(E(o)&&go(o,l,t,r,i,s),t.has(l)||s.delete(l),i.push(l)),o=o.getNextSibling()}}let Rr=!1,ui=0;function Aa(n){ui=n.timeStamp}function yr(n,e,t){const r=n.nodeName==="BR",i=e.__lexicalLineBreak;return i&&(n===i||r&&n.previousSibling===i)||r&&fr(n,t)!==void 0}function Da(n,e,t){const r=Te(Ce(t));let i=null,s=null;r!==null&&r.anchorNode===n&&(i=r.anchorOffset,s=r.focusOffset);const o=n.nodeValue;o!==null&&Ti(e,o,i,s,!1)}function Pa(n,e,t){if(O(n)){const r=n.anchor.getNode();if(r.is(t)&&n.format!==r.getFormat())return!1}return Ve(e)&&t.isAttached()}function La(n,e,t,r){for(let i=n;i&&!Kc(i);i=Sn(i)){const s=fr(i,e);if(s!==void 0){const o=le(s,t);if(o)return V(o)||!ye(i)?void 0:[i,o]}else if(i===r)return[r,Sl(t)]}}function po(n,e,t){Rr=!0;const r=performance.now()-ui>100;try{Pe(n,()=>{const i=L()||(function(d){return d.getEditorState().read(()=>{const p=L();return p!==null?p.clone():null})})(n),s=new Map,o=n.getRootElement(),l=n._editorState,a=n._blockCursorElement;let c=!1,u="";for(let d=0;d<e.length;d++){const p=e[d],h=p.type,m=p.target,g=La(m,n,l,o);if(!g)continue;const[_,y]=g;if(h==="characterData")r&&A(y)&&Ve(m)&&Pa(i,m,y)&&Da(m,y,n);else if(h==="childList"){c=!0;const x=p.addedNodes;for(let v=0;v<x.length;v++){const T=x[v],S=xl(T),N=T.parentNode;if(N!=null&&T!==a&&S===null&&!yr(T,N,n)){if(ft){const P=(ye(T)?T.innerText:null)||T.nodeValue;P&&(u+=P)}N.removeChild(T)}}const C=p.removedNodes,w=C.length;if(w>0){let v=0;for(let T=0;T<w;T++){const S=C[T];(yr(S,m,n)||a===S)&&(m.appendChild(S),v++)}w!==v&&s.set(_,y)}}}if(s.size>0)for(const[d,p]of s)p.reconcileObservedMutation(d,n);const f=t.takeRecords();if(f.length>0){for(let d=0;d<f.length;d++){const p=f[d],h=p.addedNodes,m=p.target;for(let g=0;g<h.length;g++){const _=h[g],y=_.parentNode;y==null||_.nodeName!=="BR"||yr(_,m,n)||y.removeChild(_)}}t.takeRecords()}i!==null&&(c&&me(i),ft&&El(n)&&i.insertRawText(u))})}finally{Rr=!1}}function mo(n){const e=n._observer;e!==null&&po(n,e.takeRecords(),e)}function yo(n){(function(e){ui===0&&Ce(e).addEventListener("textInput",Aa,!0)})(n),n._observer=new MutationObserver((e,t)=>{po(n,e,t)})}function Ia(n){const e=new Map,t=new Set;for(let r=typeof n=="function"?n:n.replace;r.prototype&&r.prototype.getType!==void 0;r=Object.getPrototypeOf(r)){const{ownNodeConfig:i}=pr(r);if(i&&i.stateConfigs)for(const s of i.stateConfigs){let o;"stateConfig"in s?(o=s.stateConfig,s.flat&&t.add(o.key)):o=s,e.set(o.key,o)}}return{flatKeys:t,sharedConfigMap:e}}class di{node;knownState;unknownState;sharedNodeState;size;constructor(e,t,r=void 0,i=new Map,s=void 0){this.node=e,this.sharedNodeState=t,this.unknownState=r,this.knownState=i;const{sharedConfigMap:o}=this.sharedNodeState,l=s!==void 0?s:(function(a,c,u){let f=u.size;if(c)for(const d in c){const p=a.get(d);p&&u.has(p)||f++}return f})(o,r,i);this.size=l}getValue(e){const t=this.knownState.get(e);if(t!==void 0)return t;this.sharedNodeState.sharedConfigMap.set(e.key,e);let r=e.defaultValue;if(this.unknownState&&e.key in this.unknownState){const i=this.unknownState[e.key];i!==void 0&&(r=e.parse(i)),this.updateFromKnown(e,r)}return r}getInternalState(){return[this.unknownState,this.knownState]}toJSON(){const e={...this.unknownState},t={};for(const[r,i]of this.knownState)r.isEqual(i,r.defaultValue)?delete e[r.key]:e[r.key]=r.unparse(i);for(const r of this.sharedNodeState.flatKeys)r in e&&(t[r]=e[r],delete e[r]);return qi(e)&&(t.$=e),t}getWritable(e){if(this.node===e)return this;const{sharedNodeState:t,unknownState:r}=this,i=new Map(this.knownState);return new di(e,t,(function(s,o,l){let a;if(l)for(const[c,u]of Object.entries(l)){const f=s.get(c);f?o.has(f)||o.set(f,f.parse(u)):(a=a||{},a[c]=u)}return a})(t.sharedConfigMap,i,r),i,this.size)}updateFromKnown(e,t){const r=e.key;this.sharedNodeState.sharedConfigMap.set(r,e);const{knownState:i,unknownState:s}=this;i.has(e)||s&&r in s||(s&&(delete s[r],this.unknownState=qi(s)),this.size++),i.set(e,t)}updateFromUnknown(e,t){const r=this.sharedNodeState.sharedConfigMap.get(e);r?this.updateFromKnown(r,r.parse(t)):(this.unknownState=this.unknownState||{},e in this.unknownState||this.size++,this.unknownState[e]=t)}updateFromJSON(e){const{knownState:t}=this;for(const r of t.keys())t.set(r,r.defaultValue);if(this.size=t.size,this.unknownState=void 0,e)for(const[r,i]of Object.entries(e))this.updateFromUnknown(r,i)}}function Ra(n){const e=n.getWritable(),t=e.__state?e.__state.getWritable(e):new di(e,_o(e));return e.__state=t,t}function _o(n){return n.__state?n.__state.sharedNodeState:pl(Oi(),n.getType()).sharedNodeState}function qi(n){if(n)for(const e in n)return n}function Xi(n,e,t){for(const[r,i]of e.knownState){if(n.has(r.key))continue;n.add(r.key);const s=t?t.getValue(r):r.defaultValue;if(s!==i&&!r.isEqual(s,i))return!0}return!1}function Zi(n,e,t){const{unknownState:r}=e,i=t?t.unknownState:void 0;if(r){for(const[s,o]of Object.entries(r))if(!n.has(s)&&(n.add(s),o!==(i?i[s]:void 0)))return!0}return!1}function Qi(n,e){const t=n.__state;return t&&t.node===n?t.getWritable(e):t}function es(n,e){const t=n.__mode,r=n.__format,i=n.__style,s=e.__mode,o=e.__format,l=e.__style,a=n.__state,c=e.__state;return(t===null||t===s)&&(r===null||r===o)&&(i===null||i===l)&&(n.__state===null||a===c||(function(u,f){if(u===f)return!0;if(u&&f&&u.size!==f.size)return!1;const d=new Set;return!(u&&Xi(d,u,f)||f&&Xi(d,f,u)||u&&Zi(d,u,f)||f&&Zi(d,f,u))})(a,c))}function ts(n,e){const t=n.mergeWithSibling(e),r=Y()._normalizedNodes;return r.add(n.__key),r.add(e.__key),t}function ns(n){let e,t,r=n;if(r.__text!==""||!r.isSimpleText()||r.isUnmergeable()){for(;(e=r.getPreviousSibling())!==null&&A(e)&&e.isSimpleText()&&!e.isUnmergeable();){if(e.__text!==""){if(es(e,r)){r=ts(e,r);break}break}e.remove()}for(;(t=r.getNextSibling())!==null&&A(t)&&t.isSimpleText()&&!t.isUnmergeable();){if(t.__text!==""){if(es(r,t)){r=ts(r,t);break}break}t.remove()}}else r.remove()}function Un(n){return rs(n.anchor),rs(n.focus),n}function rs(n){for(;n.type==="element";){const e=n.getNode(),t=n.offset;let r,i;if(t===e.getChildrenSize()?(r=e.getChildAtIndex(t-1),i=!0):(r=e.getChildAtIndex(t),i=!1),A(r)){n.set(r.__key,i?r.getTextContentSize():0,"text",!0);break}if(!E(r))break;n.set(r.__key,i?r.getChildrenSize():0,"element",!0)}}let gt,de,ln,lr,Fr,$r,pt,Ee,jr,an,re="",Oe=null,it=null,ze="",kt=!1,Jn=!1;function Vn(n,e){const t=pt.get(n);if(e!==null){const r=Wr(n);r.parentNode===e&&e.removeChild(r)}if(Ee.has(n)||de._keyToDOMMap.delete(n),E(t)){const r=Yn(t,pt);Kr(r,0,r.length-1,null)}t!==void 0&&ki(an,ln,lr,t,"destroyed")}function Kr(n,e,t,r){let i=e;for(;i<=t;++i){const s=n[i];s!==void 0&&Vn(s,r)}}function rt(n,e){n.setProperty("text-align",e)}const Fa="40px";function xo(n,e){const t=gt.theme.indent;if(typeof t=="string"){const i=n.classList.contains(t);e>0&&!i?n.classList.add(t):e<1&&i&&n.classList.remove(t)}const r=getComputedStyle(n).getPropertyValue("--lexical-indent-base-value")||Fa;n.style.setProperty("padding-inline-start",e===0?"":`calc(${e} * ${r})`)}function vo(n,e){const t=n.style;e===0?rt(t,""):e===1?rt(t,"left"):e===2?rt(t,"center"):e===3?rt(t,"right"):e===4?rt(t,"justify"):e===5?rt(t,"start"):e===6&&rt(t,"end")}function zr(n,e){const t=(function(r){const i=r.__dir;if(i!==null)return i;if(ee(r))return null;const s=r.getParentOrThrow();return ee(s)&&s.__dir===null?"auto":null})(e);t!==null?n.dir=t:n.removeAttribute("dir")}function Hn(n,e){const t=Ee.get(n);t===void 0&&k(60);const r=t.createDOM(gt,de);if((function(i,s,o){const l=o._keyToDOMMap;(function(a,c,u){const f=`__lexicalKey_${c._key}`;a[f]=u})(s,o,i),l.set(i,s)})(n,r,de),A(t)?r.setAttribute("data-lexical-text","true"):V(t)&&r.setAttribute("data-lexical-decorator","true"),E(t)){const i=t.__indent,s=t.__size;if(zr(r,t),i!==0&&xo(r,i),s!==0){const l=s-1;Br(Yn(t,Ee),t,0,l,t.getDOMSlot(r))}const o=t.__format;o!==0&&vo(r,o),t.isInline()||So(null,t,r),hr(t)&&(re+=Qe,ze+=Qe)}else{const i=t.getTextContent();if(V(t)){const s=t.decorate(de,gt);s!==null&&Co(n,s),r.contentEditable="false"}re+=i,ze+=i}return e!==null&&e.insertChild(r),ki(an,ln,lr,t,"created"),r}function Br(n,e,t,r,i){const s=re;re="";let o=t;for(;o<=r;++o){Hn(n[o],i);const l=Ee.get(n[o]);l!==null&&A(l)&&Oe===null&&(Oe=l.getFormat(),it=l.getStyle())}hr(e)&&(re+=Qe),i.element.__lexicalTextContent=re,re=s+re}function is(n,e){if(n){const t=n.__last;if(t){const r=e.get(t);if(r)return nn(r)?"line-break":V(r)&&r.isInline()?"decorator":null}return"empty"}return null}function So(n,e,t){const r=is(n,pt),i=is(e,Ee);r!==i&&e.getDOMSlot(t).setManagedLineBreak(i)}function $a(n,e,t){var r;Oe=null,it=null,(function(i,s,o){const l=re,a=i.__size,c=s.__size;re="";const u=o.element;if(a===1&&c===1){const f=i.__first,d=s.__first;if(f===d)Qt(f,u);else{const h=Wr(f),m=Hn(d,null);try{u.replaceChild(m,h)}catch(g){if(typeof g=="object"&&g!=null){const _=`${g.toString()} Parent: ${u.tagName}, new child: {tag: ${m.tagName} key: ${d}}, old child: {tag: ${h.tagName}, key: ${f}}.`;throw new Error(_)}throw g}Vn(f,null)}const p=Ee.get(d);A(p)&&Oe===null&&(Oe=p.getFormat(),it=p.getStyle())}else{const f=Yn(i,pt),d=Yn(s,Ee);if(f.length!==a&&k(227),d.length!==c&&k(228),a===0)c!==0&&Br(d,s,0,c-1,o);else if(c===0){if(a!==0){const p=o.after==null&&o.before==null&&o.element.__lexicalLineBreak==null;Kr(f,0,a-1,p?null:u),p&&(u.textContent="")}}else(function(p,h,m,g,_,y){const x=g-1,C=_-1;let w,v,T=y.getFirstChild(),S=0,N=0;for(;S<=x&&N<=C;){const z=h[S],$=m[N];if(z===$)T=_r(Qt($,y.element)),S++,N++;else{w===void 0&&(w=new Set(h)),v===void 0&&(v=new Set(m));const F=v.has(z),U=w.has($);if(F)if(U){const W=yt(de,$);W===T?T=_r(Qt($,y.element)):(y.withBefore(T).insertChild(W),Qt($,y.element)),S++,N++}else Hn($,y.withBefore(T)),N++;else T=_r(Wr(z)),Vn(z,y.element),S++}const B=Ee.get($);B!==null&&A(B)&&Oe===null&&(Oe=B.getFormat(),it=B.getStyle())}const P=S>x,R=N>C;if(P&&!R){const z=m[C+1],$=z===void 0?null:de.getElementByKey(z);Br(m,p,N,C,y.withBefore($))}else R&&!P&&Kr(h,S,x,y.element)})(s,f,d,a,c,o)}hr(s)&&(re+=Qe),u.__lexicalTextContent=re,re=l+re})(n,e,e.getDOMSlot(t)),r=e,Oe==null||Oe===r.__textFormat||Jn||r.setTextFormat(Oe),(function(i){it==null||it===i.__textStyle||Jn||i.setTextStyle(it)})(e)}function Yn(n,e){const t=[];let r=n.__first;for(;r!==null;){const i=e.get(r);i===void 0&&k(101),t.push(r),r=i.__next}return t}function Qt(n,e){const t=pt.get(n);let r=Ee.get(n);t!==void 0&&r!==void 0||k(61);const i=kt||$r.has(n)||Fr.has(n),s=yt(de,n);if(t===r&&!i){if(E(t)){const o=s.__lexicalTextContent;o!==void 0&&(re+=o,ze+=o)}else{const o=t.getTextContent();ze+=o,re+=o}return s}if(t!==r&&i&&ki(an,ln,lr,r,"updated"),r.updateDOM(t,s,gt)){const o=Hn(n,null);return e===null&&k(62),e.replaceChild(o,s),Vn(n,null),o}if(E(t)&&E(r)){const o=r.__indent;(kt||o!==t.__indent)&&xo(s,o);const l=r.__format;if((kt||l!==t.__format)&&vo(s,l),i&&($a(t,r,s),ee(r)||r.isInline()||So(t,r,s)),hr(r)&&(re+=Qe,ze+=Qe),(kt||r.__dir!==t.__dir)&&(zr(s,r),ee(r)&&!kt))for(const a of r.getChildren())E(a)&&zr(yt(de,a.getKey()),a)}else{const o=r.getTextContent();if(V(r)){const l=r.decorate(de,gt);l!==null&&Co(n,l)}re+=o,ze+=o}if(!Jn&&ee(r)&&r.__cachedText!==ze){const o=r.getWritable();o.__cachedText=ze,r=o}return s}function Co(n,e){let t=de._pendingDecorators;const r=de._decorators;if(t===null){if(r[n]===e)return;t=vl(de)}t[n]=e}function _r(n){let e=n.nextSibling;return e!==null&&e===de._blockCursorElement&&(e=e.nextSibling),e}function ja(n,e,t,r,i,s){re="",ze="",kt=r===2,de=t,gt=t._config,ln=t._nodes,lr=de._listeners.mutation,Fr=i,$r=s,pt=n._nodeMap,Ee=e._nodeMap,Jn=e._readOnly,jr=new Map(t._keyToDOMMap);const o=new Map;return an=o,Qt("root",null),de=void 0,ln=void 0,Fr=void 0,$r=void 0,pt=void 0,Ee=void 0,gt=void 0,jr=void 0,an=void 0,o}function Wr(n){const e=jr.get(n);return e===void 0&&k(75,n),e}function I(n){return{type:n}}const bo=I("SELECTION_CHANGE_COMMAND"),Ka=I("SELECTION_INSERT_CLIPBOARD_NODES_COMMAND"),No=I("CLICK_COMMAND"),Eo=I("BEFORE_INPUT_COMMAND"),wo=I("INPUT_COMMAND"),To=I("COMPOSITION_START_COMMAND"),ko=I("COMPOSITION_END_COMMAND"),lt=I("DELETE_CHARACTER_COMMAND"),Dt=I("INSERT_LINE_BREAK_COMMAND"),Gn=I("INSERT_PARAGRAPH_COMMAND"),Pt=I("CONTROLLED_TEXT_INSERTION_COMMAND"),fi=I("PASTE_COMMAND"),Ur=I("REMOVE_TEXT_COMMAND"),cn=I("DELETE_WORD_COMMAND"),un=I("DELETE_LINE_COMMAND"),Ye=I("FORMAT_TEXT_COMMAND"),hi=I("UNDO_COMMAND"),gi=I("REDO_COMMAND"),Mo=I("KEYDOWN_COMMAND"),Oo=I("KEY_ARROW_RIGHT_COMMAND"),za=I("MOVE_TO_END"),Ao=I("KEY_ARROW_LEFT_COMMAND"),Ba=I("MOVE_TO_START"),Do=I("KEY_ARROW_UP_COMMAND"),Po=I("KEY_ARROW_DOWN_COMMAND"),qn=I("KEY_ENTER_COMMAND"),Lo=I("KEY_SPACE_COMMAND"),Io=I("KEY_BACKSPACE_COMMAND"),Ro=I("KEY_ESCAPE_COMMAND"),Fo=I("KEY_DELETE_COMMAND"),$o=I("KEY_TAB_COMMAND"),Wa=I("INSERT_TAB_COMMAND"),Ua=I("INDENT_CONTENT_COMMAND"),ss=I("OUTDENT_CONTENT_COMMAND"),jo=I("DROP_COMMAND"),Ja=I("FORMAT_ELEMENT_COMMAND"),Ko=I("DRAGSTART_COMMAND"),zo=I("DRAGOVER_COMMAND"),Va=I("DRAGEND_COMMAND"),ar=I("COPY_COMMAND"),pi=I("CUT_COMMAND"),Jr=I("SELECT_ALL_COMMAND"),Ha=I("CLEAR_EDITOR_COMMAND"),Ya=I("CLEAR_HISTORY_COMMAND"),Nn=I("CAN_REDO_COMMAND"),En=I("CAN_UNDO_COMMAND"),Ga=I("FOCUS_COMMAND"),qa=I("BLUR_COMMAND"),Xa=I("KEY_MODIFIER_COMMAND"),Fe=Object.freeze({}),Vr=[["keydown",function(n,e){dn=n.timeStamp,Bo=n.key,!e.isComposing()&&D(e,Mo,n)}],["pointerdown",function(n,e){const t=n.target,r=n.pointerType;Yt(t)&&r!=="touch"&&r!=="pen"&&n.button===0&&Pe(e,()=>{ml(t)||(Gr=!0)})}],["compositionstart",function(n,e){D(e,To,n)}],["compositionend",function(n,e){ft?en=!0:Bt||!gn&&!pn?D(e,ko,n):(qr=!0,Xr=n.data)}],["input",function(n,e){n.stopPropagation(),Pe(e,()=>{e.dispatchCommand(wo,n)},{event:n}),Mt=null}],["click",function(n,e){Pe(e,()=>{const t=L(),r=Te(Ce(e)),i=Jt();if(r){if(O(t)){const s=t.anchor,o=s.getNode();if(s.type==="element"&&s.offset===0&&t.isCollapsed()&&!ee(o)&&X().getChildrenSize()===1&&o.getTopLevelElementOrThrow().isEmpty()&&i!==null&&t.is(i))r.removeAllRanges(),t.dirty=!0;else if(n.detail===3&&!t.isCollapsed()&&o!==t.focus.getNode()){const l=dt(o,a=>E(a)&&!a.isInline());E(l)&&l.select(0)}}else if(n.pointerType==="touch"||n.pointerType==="pen"){const s=r.anchorNode;(ye(s)||Ve(s))&&me(yi(i,r,e,n))}}D(e,No,n)})}],["cut",Fe],["copy",Fe],["dragstart",Fe],["dragover",Fe],["dragend",Fe],["paste",Fe],["focus",Fe],["blur",Fe],["drop",Fe]];Wn&&Vr.push(["beforeinput",(n,e)=>(function(t,r){const i=t.inputType;i==="deleteCompositionText"||ft&&El(r)||i!=="insertCompositionText"&&D(r,Eo,t)})(n,e)]);let dn=0,Bo=null,Wo=0,Mt=null;const Hr=new WeakMap,Xn=new WeakMap;let Yr=!1,Gr=!1,tn=!1,en=!1,qr=!1,Xr="",st=null,Uo=[0,"",0,"root",0];function Jo(n,e,t,r,i){const s=n.anchor,o=n.focus,l=s.getNode(),a=Y(),c=Te(Ce(a)),u=c!==null?c.anchorNode:null,f=s.key,d=a.getElementByKey(f),p=t.length;return f!==o.key||!A(l)||(!i&&(!Wn||Wo<r+50)||l.isDirty()&&p<2||Cl(t))&&s.offset!==o.offset&&!l.isComposing()||Ke(l)||l.isDirty()&&p>1||(i||!Wn)&&d!==null&&!l.isComposing()&&u!==$t(d)||c!==null&&e!==null&&(!e.collapsed||e.startContainer!==c.anchorNode||e.startOffset!==c.anchorOffset)||l.getFormat()!==n.format||l.getStyle()!==n.style||(function(h,m){if(m.isSegmented())return!0;if(!h.isCollapsed())return!1;const g=h.anchor.offset,_=m.getParentOrThrow(),y=ct(m);return g===0?!m.canInsertTextBefore()||!_.canInsertTextBefore()&&!m.isComposing()||y||(function(x){const C=x.getPreviousSibling();return(A(C)||E(C)&&C.isInline())&&!C.canInsertTextAfter()})(m):g===m.getTextContentSize()&&(!m.canInsertTextAfter()||!_.canInsertTextAfter()&&!m.isComposing()||y)})(n,l)}function os(n,e){return Ve(n)&&n.nodeValue!==null&&e!==0&&e!==n.nodeValue.length}function ls(n,e,t){const{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}=n;Yr&&(Yr=!1,os(r,i)&&os(s,o)&&!st)||Pe(e,()=>{if(!t)return void me(null);if(!vn(e,r,s))return;let l=L();if(st&&O(l)&&l.isCollapsed()){const a=l.anchor,c=st.anchor;(a.key===c.key&&a.offset===c.offset+1||a.offset===1&&c.getNode().is(a.getNode().getPreviousSibling()))&&(l=st.clone(),me(l))}if(st=null,O(l)){const a=l.anchor,c=a.getNode();if(l.isCollapsed()){n.type==="Range"&&n.anchorNode===n.focusNode&&(l.dirty=!0);const u=Ce(e).event,f=u?u.timeStamp:performance.now(),[d,p,h,m,g]=Uo,_=X(),y=e.isComposing()===!1&&_.getTextContent()==="";if(f<g+200&&a.offset===h&&a.key===m)Rn(l,d,p);else if(a.type==="text")A(c)||k(141),Vo(l,c);else if(a.type==="element"&&!y){E(c)||k(259);const x=a.getNode();x.isEmpty()?(function(C,w){const v=w.getTextFormat(),T=w.getTextStyle();Rn(C,v,T)})(l,x):Rn(l,0,"")}}else{const u=a.key,f=l.focus.key,d=l.getNodes(),p=d.length,h=l.isBackward(),m=h?o:i,g=h?i:o,_=h?f:u,y=h?u:f;let x=2047,C=!1;for(let w=0;w<p;w++){const v=d[w],T=v.getTextContentSize();if(A(v)&&T!==0&&!(w===0&&v.__key===_&&m===T||w===p-1&&v.__key===y&&g===0)&&(C=!0,x&=v.getFormat(),x===0))break}l.format=C?x:0}}D(e,bo,void 0)})}function Rn(n,e,t){n.format===e&&n.style===t||(n.format=e,n.style=t,n.dirty=!0)}function Vo(n,e){Rn(n,e.getFormat(),e.getStyle())}function Ho(n){if(!n.getTargetRanges)return null;const e=n.getTargetRanges();return e.length===0?null:e[0]}function Za(n){const e=n.inputType,t=Ho(n),r=Y(),i=L();if(e==="deleteContentBackward"){if(i===null){const f=Jt();if(!O(f))return!0;me(f.clone())}if(O(i)){const f=i.anchor.key===i.focus.key;if(s=n.timeStamp,Bo==="MediaLast"&&s<dn+30&&r.isComposing()&&f){if(ae(null),dn=0,setTimeout(()=>{Pe(r,()=>{ae(null)})},30),O(i)){const d=i.anchor.getNode();d.markDirty(),A(d)||k(142),Vo(i,d)}}else{ae(null),n.preventDefault();const d=i.anchor.getNode(),p=d.getTextContent(),h=d.canInsertTextAfter(),m=i.anchor.offset===0&&i.focus.offset===p.length;let g=Hi&&f&&!m&&h;if(g&&i.isCollapsed()&&(g=!V(ri(i.anchor,!0))),!g){D(r,lt,!0);const _=L();Hi&&O(_)&&_.isCollapsed()&&(st=_,setTimeout(()=>st=null))}}return!0}}var s;if(!O(i))return!0;const o=n.data;Mt!==null&&wi(!1,r,Mt),i.dirty&&Mt===null||!i.isCollapsed()||ee(i.anchor.getNode())||t===null||i.applyDOMRange(t),Mt=null;const l=i.anchor,a=i.focus,c=l.getNode(),u=a.getNode();if(e==="insertText"||e==="insertTranspose"){if(o===`
`)n.preventDefault(),D(r,Dt,!1);else if(o===Qe)n.preventDefault(),D(r,Gn,void 0);else if(o==null&&n.dataTransfer){const f=n.dataTransfer.getData("text/plain");n.preventDefault(),i.insertRawText(f)}else o!=null&&Jo(i,t,o,n.timeStamp,!0)?(n.preventDefault(),D(r,Pt,o)):Mt=o;return Wo=n.timeStamp,!0}switch(n.preventDefault(),e){case"insertFromYank":case"insertFromDrop":case"insertReplacementText":D(r,Pt,n);break;case"insertFromComposition":ae(null),D(r,Pt,n);break;case"insertLineBreak":ae(null),D(r,Dt,!1);break;case"insertParagraph":ae(null),tn&&!Bt?(tn=!1,D(r,Dt,!1)):D(r,Gn,void 0);break;case"insertFromPaste":case"insertFromPasteAsQuotation":D(r,fi,n);break;case"deleteByComposition":(function(f,d){return f!==d||E(f)||E(d)||!ct(f)||!ct(d)})(c,u)&&D(r,Ur,n);break;case"deleteByDrag":case"deleteByCut":D(r,Ur,n);break;case"deleteContent":D(r,lt,!1);break;case"deleteWordBackward":D(r,cn,!0);break;case"deleteWordForward":D(r,cn,!1);break;case"deleteHardLineBackward":case"deleteSoftLineBackward":D(r,un,!0);break;case"deleteContentForward":case"deleteHardLineForward":case"deleteSoftLineForward":D(r,un,!1);break;case"formatStrikeThrough":D(r,Ye,"strikethrough");break;case"formatBold":D(r,Ye,"bold");break;case"formatItalic":D(r,Ye,"italic");break;case"formatUnderline":D(r,Ye,"underline");break;case"historyUndo":D(r,hi,void 0);break;case"historyRedo":D(r,gi,void 0)}return!0}function Qa(n){if(ye(n.target)&&ml(n.target))return!0;const e=Y(),t=L(),r=n.data,i=Ho(n);if(r!=null&&O(t)&&Jo(t,i,r,n.timeStamp,!1)){en&&(Zn(e,r),en=!1);const s=t.anchor.getNode(),o=Te(Ce(e));if(o===null)return!0;const l=t.isBackward(),a=l?t.anchor.offset:t.focus.offset,c=l?t.focus.offset:t.anchor.offset;Wn&&!t.isCollapsed()&&A(s)&&o.anchorNode!==null&&s.getTextContent().slice(0,a)+r+s.getTextContent().slice(a+c)===Nl(o.anchorNode)||D(e,Pt,r);const u=r.length;ft&&u>1&&n.inputType==="insertCompositionText"&&!e.isComposing()&&(t.anchor.offset-=u),gn||Bt||pn||!e.isComposing()||(dn=0,ae(null))}else wi(!1,e,r!==null?r:void 0),en&&(Zn(e,r||void 0),en=!1);return(function(){ue();const s=Y();mo(s)})(),!0}function ec(n){const e=Y(),t=L();if(O(t)&&!e.isComposing()){const r=t.anchor,i=t.anchor.getNode();ae(r.key),(n.timeStamp<dn+30||r.type==="element"||!t.isCollapsed()||i.getFormat()!==t.format||A(i)&&i.getStyle()!==t.style)&&D(e,Pt,wa)}return!0}function tc(n){return Zn(Y(),n.data),!0}function Zn(n,e){const t=n._compositionKey;if(ae(null),t!==null&&e!=null){if(e===""){const r=le(t),i=$t(n.getElementByKey(t));return void(i!==null&&i.nodeValue!==null&&A(r)&&Ti(r,i.nodeValue,null,null,!0))}if(e[e.length-1]===`
`){const r=L();if(O(r)){const i=r.focus;return r.anchor.set(i.key,i.offset,i.type),void D(n,qn,null)}}}wi(!0,n,e)}function nc(n){const e=Y();if(n.key==null)return!0;if(qr&&Ds(n))return Pe(e,()=>{Zn(e,Xr)}),qr=!1,Xr="",!0;if((function(t){return H(t,"ArrowRight",{shiftKey:"any"})})(n))D(e,Oo,n);else if((function(t){return H(t,"ArrowRight",je)})(n))D(e,za,n);else if((function(t){return H(t,"ArrowLeft",{shiftKey:"any"})})(n))D(e,Ao,n);else if((function(t){return H(t,"ArrowLeft",je)})(n))D(e,Ba,n);else if((function(t){return H(t,"ArrowUp",{altKey:"any",shiftKey:"any"})})(n))D(e,Do,n);else if((function(t){return H(t,"ArrowDown",{altKey:"any",shiftKey:"any"})})(n))D(e,Po,n);else if((function(t){return H(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any",shiftKey:!0})})(n))tn=!0,D(e,qn,n);else if((function(t){return t.key===" "})(n))D(e,Lo,n);else if((function(t){return Ne&&H(t,"o",{ctrlKey:!0})})(n))n.preventDefault(),tn=!0,D(e,Dt,!0);else if((function(t){return H(t,"Enter",{altKey:"any",ctrlKey:"any",metaKey:"any"})})(n))tn=!1,D(e,qn,n);else if((function(t){return H(t,"Backspace",{shiftKey:"any"})||Ne&&H(t,"h",{ctrlKey:!0})})(n))Ds(n)?D(e,Io,n):(n.preventDefault(),D(e,lt,!0));else if((function(t){return t.key==="Escape"})(n))D(e,Ro,n);else if((function(t){return H(t,"Delete",{})||Ne&&H(t,"d",{ctrlKey:!0})})(n))(function(t){return t.key==="Delete"})(n)?D(e,Fo,n):(n.preventDefault(),D(e,lt,!1));else if((function(t){return H(t,"Backspace",As)})(n))n.preventDefault(),D(e,cn,!0);else if((function(t){return H(t,"Delete",As)})(n))n.preventDefault(),D(e,cn,!1);else if((function(t){return Ne&&H(t,"Backspace",{metaKey:!0})})(n))n.preventDefault(),D(e,un,!0);else if((function(t){return Ne&&(H(t,"Delete",{metaKey:!0})||H(t,"k",{ctrlKey:!0}))})(n))n.preventDefault(),D(e,un,!1);else if((function(t){return H(t,"b",je)})(n))n.preventDefault(),D(e,Ye,"bold");else if((function(t){return H(t,"u",je)})(n))n.preventDefault(),D(e,Ye,"underline");else if((function(t){return H(t,"i",je)})(n))n.preventDefault(),D(e,Ye,"italic");else if((function(t){return H(t,"Tab",{shiftKey:"any"})})(n))D(e,$o,n);else if((function(t){return H(t,"z",je)})(n))n.preventDefault(),D(e,hi,void 0);else if((function(t){return Ne?H(t,"z",{metaKey:!0,shiftKey:!0}):H(t,"y",{ctrlKey:!0})||H(t,"z",{ctrlKey:!0,shiftKey:!0})})(n))n.preventDefault(),D(e,gi,void 0);else{const t=e._editorState._selection;t===null||O(t)?Ps(n)&&(n.preventDefault(),D(e,Jr,n)):(function(r){return H(r,"c",je)})(n)?(n.preventDefault(),D(e,ar,n)):(function(r){return H(r,"x",je)})(n)?(n.preventDefault(),D(e,pi,n)):Ps(n)&&(n.preventDefault(),D(e,Jr,n))}return(function(t){return t.ctrlKey||t.shiftKey||t.altKey||t.metaKey})(n)&&e.dispatchCommand(Xa,n),!0}function Yo(n){let e=n.__lexicalEventHandles;return e===void 0&&(e=[],n.__lexicalEventHandles=e),e}const Lt=new Map;function Go(n){const e=Rc(n.target);if(e===null)return;const t=yl(e.anchorNode);if(t===null)return;Gr&&(Gr=!1,Pe(t,()=>{const a=Jt(),c=e.anchorNode;(ye(c)||Ve(c))&&me(yi(a,e,t,n))}));const r=Ei(t),i=r[r.length-1],s=i._key,o=Lt.get(s),l=o||i;l!==t&&ls(e,l,!1),ls(e,t,!0),t!==i?Lt.set(s,t):o&&Lt.delete(s)}function as(n){n._lexicalHandled=!0}function cs(n){return n._lexicalHandled===!0}function rc(n){const e=Hr.get(n);if(e===void 0)return;const t=Xn.get(e);if(t===void 0)return;const r=t-1;r>=0||k(164),Hr.delete(n),Xn.set(e,r),r===0&&e.removeEventListener("selectionchange",Go);const i=dr(n);Ni(i)?((function(o){if(o._parentEditor!==null){const l=Ei(o),a=l[l.length-1]._key;Lt.get(a)===o&&Lt.delete(a)}else Lt.delete(o._key)})(i),n.__lexicalEditor=null):i&&k(198);const s=Yo(n);for(let o=0;o<s.length;o++)s[o]();n.__lexicalEventHandles=[]}function Zr(n,e,t){ue();const r=n.__key,i=n.getParent();if(i===null)return;const s=(function(l){const a=L();if(!O(a)||!E(l))return a;const{anchor:c,focus:u}=a,f=c.getNode(),d=u.getNode();return ii(f,l)&&c.set(l.__key,0,"element"),ii(d,l)&&u.set(l.__key,0,"element"),a})(n);let o=!1;if(O(s)&&e){const l=s.anchor,a=s.focus;l.key===r&&(tr(l,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0),a.key===r&&(tr(a,n,i,n.getPreviousSibling(),n.getNextSibling()),o=!0)}else _e(s)&&e&&n.isSelected()&&n.selectPrevious();if(O(s)&&e&&!o){const l=n.getIndexWithinParent();ut(n),er(s,i,l,-1)}else ut(n);t||Re(i)||i.canBeEmpty()||!i.isEmpty()||Zr(i,e),e&&s&&ee(i)&&i.isEmpty()&&i.selectEnd()}const qo=Symbol.for("ephemeral");function Qn(n){return n[qo]||!1}class De{__type;__key;__parent;__prev;__next;__state;static getType(){const{ownNodeType:e}=pr(this);return e===void 0&&k(64,this.name),e}static clone(e){k(65,this.name)}$config(){return{}}config(e,t){const r=t.extends||Object.getPrototypeOf(this.constructor);return Object.assign(t,{extends:r,type:e}),{[e]:t}}afterCloneFrom(e){this.__key===e.__key?(this.__parent=e.__parent,this.__next=e.__next,this.__prev=e.__prev,this.__state=e.__state):e.__state&&(this.__state=e.__state.getWritable(this))}static importDOM;constructor(e){this.__type=this.constructor.getType(),this.__parent=null,this.__prev=null,this.__next=null,Object.defineProperty(this,"__state",{configurable:!0,enumerable:!1,value:void 0,writable:!0}),Mc(this,e)}getType(){return this.__type}isInline(){k(137,this.constructor.name)}isAttached(){let e=this.__key;for(;e!==null;){if(e==="root")return!0;const t=le(e);if(t===null)break;e=t.__parent}return!1}isSelected(e){const t=e||L();if(t==null)return!1;const r=t.getNodes().some(i=>i.__key===this.__key);if(A(this))return r;if(O(t)&&t.anchor.type==="element"&&t.focus.type==="element"){if(t.isCollapsed())return!1;const i=this.getParent();if(V(this)&&this.isInline()&&i){const s=t.isBackward()?t.focus:t.anchor;if(i.is(s.getNode())&&s.offset===i.getChildrenSize()&&this.is(i.getLastChild()))return!1}}return r}getKey(){return this.__key}getIndexWithinParent(){const e=this.getParent();if(e===null)return-1;let t=e.getFirstChild(),r=0;for(;t!==null;){if(this.is(t))return r;r++,t=t.getNextSibling()}return-1}getParent(){const e=this.getLatest().__parent;return e===null?null:le(e)}getParentOrThrow(){const e=this.getParent();return e===null&&k(66,this.__key),e}getTopLevelElement(){let e=this;for(;e!==null;){const t=e.getParent();if(Re(t))return E(e)||e===this&&V(e)||k(194),e;e=t}return null}getTopLevelElementOrThrow(){const e=this.getTopLevelElement();return e===null&&k(67,this.__key),e}getParents(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t),t=t.getParent();return e}getParentKeys(){const e=[];let t=this.getParent();for(;t!==null;)e.push(t.__key),t=t.getParent();return e}getPreviousSibling(){const e=this.getLatest().__prev;return e===null?null:le(e)}getPreviousSiblings(){const e=[],t=this.getParent();if(t===null)return e;let r=t.getFirstChild();for(;r!==null&&!r.is(this);)e.push(r),r=r.getNextSibling();return e}getNextSibling(){const e=this.getLatest().__next;return e===null?null:le(e)}getNextSiblings(){const e=[];let t=this.getNextSibling();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getCommonAncestor(e){const t=E(this)?this:this.getParent(),r=E(e)?e:e.getParent(),i=t&&r?$n(t,r):null;return i?i.commonAncestor:null}is(e){return e!=null&&this.__key===e.__key}isBefore(e){const t=$n(this,e);return t!==null&&(t.type==="descendant"||(t.type==="branch"?Ol(t)===-1:(t.type!=="same"&&t.type!=="ancestor"&&k(279),!1)))}isParentOf(e){const t=$n(this,e);return t!==null&&t.type==="ancestor"}getNodesBetween(e){const t=this.isBefore(e),r=[],i=new Set;let s=this;for(;s!==null;){const o=s.__key;if(i.has(o)||(i.add(o),r.push(s)),s===e)break;const l=E(s)?t?s.getFirstChild():s.getLastChild():null;if(l!==null){s=l;continue}const a=t?s.getNextSibling():s.getPreviousSibling();if(a!==null){s=a;continue}const c=s.getParentOrThrow();if(i.has(c.__key)||r.push(c),c===e)break;let u=null,f=c;do{if(f===null&&k(68),u=t?f.getNextSibling():f.getPreviousSibling(),f=f.getParent(),f===null)break;u!==null||i.has(f.__key)||r.push(f)}while(u===null);s=u}return t||r.reverse(),r}isDirty(){const e=Y()._dirtyLeaves;return e!==null&&e.has(this.__key)}getLatest(){if(Qn(this))return this;const e=le(this.__key);return e===null&&k(113),e}getWritable(){if(Qn(this))return this;ue();const e=tt(),t=Y(),r=e._nodeMap,i=this.__key,s=this.getLatest(),o=t._cloneNotNeeded,l=L();if(l!==null&&l.setCachedNodes(null),o.has(i))return rr(s),s;const a=Tl(s);return o.add(i),rr(a),r.set(i,a),a}getTextContent(){return""}getTextContentSize(){return this.getTextContent().length}createDOM(e,t){k(70)}updateDOM(e,t,r){k(71)}exportDOM(e){return{element:this.createDOM(e._config,e)}}exportJSON(){const e=this.__state?this.__state.toJSON():void 0;return{type:this.__type,version:1,...e}}static importJSON(e){k(18,this.name)}updateFromJSON(e){return(function(t,r){const i=t.getWritable(),s=r.$;let o=s;for(const l of _o(i).flatKeys)l in r&&(o!==void 0&&o!==s||(o={...s}),o[l]=r[l]);return(i.__state||o)&&Ra(t).updateFromJSON(o),i})(this,e)}static transform(){return null}remove(e){Zr(this,!0,e)}replace(e,t){ue();let r=L();r!==null&&(r=r.clone()),Nr(this,e);const i=this.getLatest(),s=this.__key,o=e.__key,l=e.getWritable(),a=this.getParentOrThrow().getWritable(),c=a.__size;ut(l);const u=i.getPreviousSibling(),f=i.getNextSibling(),d=i.__prev,p=i.__next,h=i.__parent;if(Zr(i,!1,!0),u===null?a.__first=o:u.getWritable().__next=o,l.__prev=d,f===null?a.__last=o:f.getWritable().__prev=o,l.__next=p,l.__parent=h,a.__size=c,t&&(E(this)&&E(l)||k(139),this.getChildren().forEach(m=>{l.append(m)})),O(r)){me(r);const m=r.anchor,g=r.focus;m.key===s&&hs(m,l),g.key===s&&hs(g,l)}return Ge()===s&&ae(o),l}insertAfter(e,t=!0){ue(),Nr(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.getParent(),o=L();let l=!1,a=!1;if(s!==null){const p=e.getIndexWithinParent();if(ut(i),O(o)){const h=s.__key,m=o.anchor,g=o.focus;l=m.type==="element"&&m.key===h&&m.offset===p+1,a=g.type==="element"&&g.key===h&&g.offset===p+1}}const c=this.getNextSibling(),u=this.getParentOrThrow().getWritable(),f=i.__key,d=r.__next;if(c===null?u.__last=f:c.getWritable().__prev=f,u.__size++,r.__next=f,i.__next=d,i.__prev=r.__key,i.__parent=r.__parent,t&&O(o)){const p=this.getIndexWithinParent();er(o,u,p+1);const h=u.__key;l&&o.anchor.set(h,p+2,"element"),a&&o.focus.set(h,p+2,"element")}return e}insertBefore(e,t=!0){ue(),Nr(this,e);const r=this.getWritable(),i=e.getWritable(),s=i.__key;ut(i);const o=this.getPreviousSibling(),l=this.getParentOrThrow().getWritable(),a=r.__prev,c=this.getIndexWithinParent();o===null?l.__first=s:o.getWritable().__next=s,l.__size++,r.__prev=s,i.__prev=a,i.__next=r.__key,i.__parent=r.__parent;const u=L();return t&&O(u)&&er(u,this.getParentOrThrow(),c),e}isParentRequired(){return!1}createParentElementNode(){return Se()}selectStart(){return this.selectPrevious()}selectEnd(){return this.selectNext(0,0)}selectPrevious(e,t){ue();const r=this.getPreviousSibling(),i=this.getParentOrThrow();if(r===null)return i.select(0,0);if(E(r))return r.select();if(!A(r)){const s=r.getIndexWithinParent()+1;return i.select(s,s)}return r.select(e,t)}selectNext(e,t){ue();const r=this.getNextSibling(),i=this.getParentOrThrow();if(r===null)return i.select();if(E(r))return r.select(0,0);if(!A(r)){const s=r.getIndexWithinParent();return i.select(s,s)}return r.select(e,t)}markDirty(){this.getWritable()}reconcileObservedMutation(e,t){this.markDirty()}}const Qr="historic",ic="history-push",at="history-merge",sc="paste",oc="collaboration",lc="skip-scroll-into-view",ac="skip-dom-selection",cc="skip-selection-focus";class Wt extends De{static getType(){return"linebreak"}static clone(e){return new Wt(e.__key)}constructor(e){super(e)}getTextContent(){return`
`}createDOM(){return document.createElement("br")}updateDOM(){return!1}isInline(){return!0}static importDOM(){return{br:e=>(function(t){const r=t.parentElement;if(r!==null&&ir(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&wn(i)){const s=r.lastChild;if(s===t||s.previousSibling===t&&wn(s))return!0}}return!1})(e)||(function(t){const r=t.parentElement;if(r!==null&&ir(r)){const i=r.firstChild;if(i===t||i.nextSibling===t&&wn(i))return!1;const s=r.lastChild;if(s===t||s.previousSibling===t&&wn(s))return!0}return!1})(e)?null:{conversion:uc,priority:0}}}static importJSON(e){return mt().updateFromJSON(e)}}function uc(n){return{node:mt()}}function mt(){return gr(new Wt)}function nn(n){return n instanceof Wt}function wn(n){return Ve(n)&&/^( |\t|\r?\n)+$/.test(n.textContent||"")}function xr(n,e){return 16&e?"code":e&ho?"mark":32&e?"sub":64&e?"sup":null}function vr(n,e){return 1&e?"strong":2&e?"em":"span"}function Xo(n,e,t,r,i){const s=r.classList;let o=It(i,"base");o!==void 0&&s.add(...o),o=It(i,"underlineStrikethrough");let l=!1;const a=8&e&&4&e;o!==void 0&&(8&t&&4&t?(l=!0,a||s.add(...o)):a&&s.remove(...o));for(const c in ht){const u=ht[c];if(o=It(i,c),o!==void 0)if(t&u){if(l&&(c==="underline"||c==="strikethrough")){e&u&&s.remove(...o);continue}((e&u)===0||a&&c==="underline"||c==="strikethrough")&&s.add(...o)}else e&u&&s.remove(...o)}}function Zo(n,e,t){const r=e.firstChild,i=t.isComposing(),s=n+(i?or:"");if(r==null)e.textContent=s;else{const o=r.nodeValue;if(o!==s)if(i||ft){const[l,a,c]=(function(u,f){const d=u.length,p=f.length;let h=0,m=0;for(;h<d&&h<p&&u[h]===f[h];)h++;for(;m+h<d&&m+h<p&&u[d-m-1]===f[p-m-1];)m++;return[h,d-h-m,f.slice(h,p-m)]})(o,s);a!==0&&r.deleteData(l,a),r.insertData(l,c)}else r.nodeValue=s}}function us(n,e,t,r,i,s){Zo(i,n,e);const o=s.theme.text;o!==void 0&&Xo(0,0,r,n,o)}function Tn(n,e){const t=document.createElement(e);return t.appendChild(n),t}class Ct extends De{__text;__format;__style;__mode;__detail;static getType(){return"text"}static clone(e){return new Ct(e.__text,e.__key)}afterCloneFrom(e){super.afterCloneFrom(e),this.__text=e.__text,this.__format=e.__format,this.__style=e.__style,this.__mode=e.__mode,this.__detail=e.__detail}constructor(e="",t){super(t),this.__text=e,this.__format=0,this.__style="",this.__mode=0,this.__detail=0}getFormat(){return this.getLatest().__format}getDetail(){return this.getLatest().__detail}getMode(){const e=this.getLatest();return Oa[e.__mode]}getStyle(){return this.getLatest().__style}isToken(){return this.getLatest().__mode===1}isComposing(){return this.__key===Ge()}isSegmented(){return this.getLatest().__mode===2}isDirectionless(){return!!(1&this.getLatest().__detail)}isUnmergeable(){return!!(2&this.getLatest().__detail)}hasFormat(e){const t=ht[e];return(this.getFormat()&t)!==0}isSimpleText(){return this.__type==="text"&&this.__mode===0}getTextContent(){return this.getLatest().__text}getFormatFlags(e,t){return nr(this.getLatest().__format,e,t)}canHaveFormat(){return!0}isInline(){return!0}createDOM(e,t){const r=this.__format,i=xr(0,r),s=vr(0,r),o=i===null?s:i,l=document.createElement(o);let a=l;this.hasFormat("code")&&l.setAttribute("spellcheck","false"),i!==null&&(a=document.createElement(s),l.appendChild(a)),us(a,this,0,r,this.__text,e);const c=this.__style;return c!==""&&(l.style.cssText=c),l}updateDOM(e,t,r){const i=this.__text,s=e.__format,o=this.__format,l=xr(0,s),a=xr(0,o),c=vr(0,s),u=vr(0,o);if((l===null?c:l)!==(a===null?u:a))return!0;if(l===a&&c!==u){const m=t.firstChild;m==null&&k(48);const g=document.createElement(u);return us(g,this,0,o,i,r),t.replaceChild(g,m),!1}let f=t;a!==null&&l!==null&&(f=t.firstChild,f==null&&k(49)),Zo(i,f,this);const d=r.theme.text;d!==void 0&&s!==o&&Xo(0,s,o,f,d);const p=e.__style,h=this.__style;return p!==h&&(t.style.cssText=h),!1}static importDOM(){return{"#text":()=>({conversion:gc,priority:0}),b:()=>({conversion:fc,priority:0}),code:()=>({conversion:$e,priority:0}),em:()=>({conversion:$e,priority:0}),i:()=>({conversion:$e,priority:0}),mark:()=>({conversion:$e,priority:0}),s:()=>({conversion:$e,priority:0}),span:()=>({conversion:dc,priority:0}),strong:()=>({conversion:$e,priority:0}),sub:()=>({conversion:$e,priority:0}),sup:()=>({conversion:$e,priority:0}),u:()=>({conversion:$e,priority:0})}}static importJSON(e){return ie().updateFromJSON(e)}updateFromJSON(e){return super.updateFromJSON(e).setTextContent(e.text).setFormat(e.format).setDetail(e.detail).setMode(e.mode).setStyle(e.style)}exportDOM(e){let{element:t}=super.exportDOM(e);return ye(t)||k(132),t.style.whiteSpace="pre-wrap",this.hasFormat("lowercase")?t.style.textTransform="lowercase":this.hasFormat("uppercase")?t.style.textTransform="uppercase":this.hasFormat("capitalize")&&(t.style.textTransform="capitalize"),this.hasFormat("bold")&&(t=Tn(t,"b")),this.hasFormat("italic")&&(t=Tn(t,"i")),this.hasFormat("strikethrough")&&(t=Tn(t,"s")),this.hasFormat("underline")&&(t=Tn(t,"u")),{element:t}}exportJSON(){return{detail:this.getDetail(),format:this.getFormat(),mode:this.getMode(),style:this.getStyle(),text:this.getTextContent(),...super.exportJSON()}}selectionTransform(e,t){}setFormat(e){const t=this.getWritable();return t.__format=typeof e=="string"?ht[e]:e,t}setDetail(e){const t=this.getWritable();return t.__detail=typeof e=="string"?Ta[e]:e,t}setStyle(e){const t=this.getWritable();return t.__style=e,t}toggleFormat(e){const t=nr(this.getFormat(),e,null);return this.setFormat(t)}toggleDirectionless(){const e=this.getWritable();return e.__detail^=1,e}toggleUnmergeable(){const e=this.getWritable();return e.__detail^=2,e}setMode(e){const t=Ma[e];if(this.__mode===t)return this;const r=this.getWritable();return r.__mode=t,r}setTextContent(e){if(this.__text===e)return this;const t=this.getWritable();return t.__text=e,t}select(e,t){ue();let r=e,i=t;const s=L(),o=this.getTextContent(),l=this.__key;if(typeof o=="string"){const a=o.length;r===void 0&&(r=a),i===void 0&&(i=a)}else r=0,i=0;if(!O(s))return nl(l,r,l,i,"text","text");{const a=Ge();a!==s.anchor.key&&a!==s.focus.key||ae(l),s.setTextNodeRange(this,r,this,i)}return s}selectStart(){return this.select(0,0)}selectEnd(){const e=this.getTextContentSize();return this.select(e,e)}spliceText(e,t,r,i){const s=this.getWritable(),o=s.__text,l=r.length;let a=e;a<0&&(a=l+a,a<0&&(a=0));const c=L();if(i&&O(c)){const f=e+l;c.setTextNodeRange(s,f,s,f)}const u=o.slice(0,a)+r+o.slice(a+t);return s.__text=u,s}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}splitText(...e){ue();const t=this.getLatest(),r=t.getTextContent();if(r==="")return[];const i=t.__key,s=Ge(),o=r.length;e.sort((S,N)=>S-N),e.push(o);const l=[],a=e.length;for(let S=0,N=0;S<o&&N<=a;N++){const P=e[N];P>S&&(l.push(r.slice(S,P)),S=P)}const c=l.length;if(c===1)return[t];const u=l[0],f=t.getParent();let d;const p=t.getFormat(),h=t.getStyle(),m=t.__detail;let g=!1,_=null,y=null;const x=L();if(O(x)){const[S,N]=x.isBackward()?[x.focus,x.anchor]:[x.anchor,x.focus];S.type==="text"&&S.key===i&&(_=S),N.type==="text"&&N.key===i&&(y=N)}t.isSegmented()?(d=ie(u),d.__format=p,d.__style=h,d.__detail=m,d.__state=Qi(t,d),g=!0):d=t.setTextContent(u);const C=[d];for(let S=1;S<c;S++){const N=ie(l[S]);N.__format=p,N.__style=h,N.__detail=m,N.__state=Qi(t,N);const P=N.__key;s===i&&ae(P),C.push(N)}const w=_?_.offset:null,v=y?y.offset:null;let T=0;for(const S of C){if(!_&&!y)break;const N=T+S.getTextContentSize();if(_!==null&&w!==null&&w<=N&&w>=T&&(_.set(S.getKey(),w-T,"text"),w<N&&(_=null)),y!==null&&v!==null&&v<=N&&v>=T){y.set(S.getKey(),v-T,"text");break}T=N}if(f!==null){(function(P){const R=P.getPreviousSibling(),z=P.getNextSibling();R!==null&&rr(R),z!==null&&rr(z)})(this);const S=f.getWritable(),N=this.getIndexWithinParent();g?(S.splice(N,0,C),this.remove()):S.splice(N,1,C),O(x)&&er(x,f,N,c-1)}return C}mergeWithSibling(e){const t=e===this.getPreviousSibling();t||e===this.getNextSibling()||k(50);const r=this.__key,i=e.__key,s=this.__text,o=s.length;Ge()===i&&ae(r);const l=L();if(O(l)){const f=l.anchor,d=l.focus;f!==null&&f.key===i&&vs(f,t,r,e,o),d!==null&&d.key===i&&vs(d,t,r,e,o)}const a=e.__text,c=t?a+s:s+a;this.setTextContent(c);const u=this.getWritable();return e.remove(),u}isTextEntity(){return!1}}function dc(n){return{forChild:mi(n.style),node:null}}function fc(n){const e=n,t=e.style.fontWeight==="normal";return{forChild:mi(e.style,t?void 0:"bold"),node:null}}const ds=new WeakMap;function hc(n){if(!ye(n))return!1;if(n.nodeName==="PRE")return!0;const e=n.style.whiteSpace;return typeof e=="string"&&e.startsWith("pre")}function gc(n){const e=n;n.parentElement===null&&k(129);let t=e.textContent||"";if((function(r){let i,s=r.parentNode;const o=[r];for(;s!==null&&(i=ds.get(s))===void 0&&!hc(s);)o.push(s),s=s.parentNode;const l=i===void 0?s:i;for(let a=0;a<o.length;a++)ds.set(o[a],l);return l})(e)!==null){const r=t.split(/(\r?\n|\t)/),i=[],s=r.length;for(let o=0;o<s;o++){const l=r[o];l===`
`||l===`\r
`?i.push(mt()):l==="	"?i.push(mn()):l!==""&&i.push(ie(l))}return{node:i}}if(t=t.replace(/\r/g,"").replace(/[ \t\n]+/g," "),t==="")return{node:null};if(t[0]===" "){let r=e,i=!0;for(;r!==null&&(r=fs(r,!1))!==null;){const s=r.textContent||"";if(s.length>0){/[ \t\n]$/.test(s)&&(t=t.slice(1)),i=!1;break}}i&&(t=t.slice(1))}if(t[t.length-1]===" "){let r=e,i=!0;for(;r!==null&&(r=fs(r,!0))!==null;)if((r.textContent||"").replace(/^( |\t|\r?\n)+/,"").length>0){i=!1;break}i&&(t=t.slice(0,t.length-1))}return t===""?{node:null}:{node:ie(t)}}function fs(n,e){let t=n;for(;;){let r;for(;(r=e?t.nextSibling:t.previousSibling)===null;){const s=t.parentElement;if(s===null)return null;t=s}if(t=r,ye(t)){const s=t.style.display;if(s===""&&!li(t)||s!==""&&!s.startsWith("inline"))return null}let i=t;for(;(i=e?t.firstChild:t.lastChild)!==null;)t=i;if(Ve(t))return t;if(t.nodeName==="BR")return null}}const pc={code:"code",em:"italic",i:"italic",mark:"highlight",s:"strikethrough",strong:"bold",sub:"subscript",sup:"superscript",u:"underline"};function $e(n){const e=pc[n.nodeName.toLowerCase()];return e===void 0?{node:null}:{forChild:mi(n.style,e),node:null}}function ie(n=""){return gr(new Ct(n))}function A(n){return n instanceof Ct}function mi(n,e){const t=n.fontWeight,r=n.textDecoration.split(" "),i=t==="700"||t==="bold",s=r.includes("line-through"),o=n.fontStyle==="italic",l=r.includes("underline"),a=n.verticalAlign;return c=>(A(c)&&(i&&!c.hasFormat("bold")&&c.toggleFormat("bold"),s&&!c.hasFormat("strikethrough")&&c.toggleFormat("strikethrough"),o&&!c.hasFormat("italic")&&c.toggleFormat("italic"),l&&!c.hasFormat("underline")&&c.toggleFormat("underline"),a!=="sub"||c.hasFormat("subscript")||c.toggleFormat("subscript"),a!=="super"||c.hasFormat("superscript")||c.toggleFormat("superscript"),e&&!c.hasFormat(e)&&c.toggleFormat(e)),c)}class Ut extends Ct{static getType(){return"tab"}static clone(e){return new Ut(e.__key)}constructor(e){super("	",e),this.__detail=2}static importDOM(){return null}createDOM(e){const t=super.createDOM(e),r=It(e.theme,"tab");return r!==void 0&&t.classList.add(...r),t}static importJSON(e){return mn().updateFromJSON(e)}setTextContent(e){return e!=="	"&&e!==""&&co(126),super.setTextContent("	")}spliceText(e,t,r,i){return r===""&&t===0||r==="	"&&t===1||k(286),this}setDetail(e){return e!==2&&k(127),this}setMode(e){return e!=="normal"&&k(128),this}canInsertTextBefore(){return!1}canInsertTextAfter(){return!1}}function mn(){return gr(new Ut)}function Qo(n){return n instanceof Ut}class mc{key;offset;type;_selection;constructor(e,t,r){this._selection=null,this.key=e,this.offset=t,this.type=r}is(e){return this.key===e.key&&this.offset===e.offset&&this.type===e.type}isBefore(e){return this.key===e.key?this.offset<e.offset:Ml(Ae(Ue(this,"next")),Ae(Ue(e,"next")))<0}getNode(){const e=le(this.key);return e===null&&k(20),e}set(e,t,r,i){const s=this._selection,o=this.key;i&&this.key===e&&this.offset===t&&this.type===r||(this.key=e,this.offset=t,this.type=r,yn()||(Ge()===o&&ae(e),s!==null&&(s.setCachedNodes(null),s.dirty=!0)))}}function Ie(n,e,t){return new mc(n,e,t)}function Sr(n,e){let t=e.__key,r=n.offset,i="element";if(A(e)){i="text";const s=e.getTextContentSize();r>s&&(r=s)}else if(!E(e)){const s=e.getNextSibling();if(A(s))t=s.__key,r=0,i="text";else{const o=e.getParent();o&&(t=o.__key,r=e.getIndexWithinParent()+1)}}n.set(t,r,i)}function hs(n,e){if(E(e)){const t=e.getLastDescendant();E(t)||A(t)?Sr(n,t):Sr(n,e)}else Sr(n,e)}class cr{_nodes;_cachedNodes;dirty;constructor(e){this._cachedNodes=null,this._nodes=e,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){if(!_e(e))return!1;const t=this._nodes,r=e._nodes;return t.size===r.size&&Array.from(t).every(i=>r.has(i))}isCollapsed(){return!1}isBackward(){return!1}getStartEndPoints(){return null}add(e){this.dirty=!0,this._nodes.add(e),this._cachedNodes=null}delete(e){this.dirty=!0,this._nodes.delete(e),this._cachedNodes=null}clear(){this.dirty=!0,this._nodes.clear(),this._cachedNodes=null}has(e){return this._nodes.has(e)}clone(){return new cr(new Set(this._nodes))}extract(){return this.getNodes()}insertRawText(e){}insertText(){}insertNodes(e){const t=this.getNodes(),r=t.length,i=t[r-1];let s;if(A(i))s=i.select();else{const o=i.getIndexWithinParent()+1;s=i.getParentOrThrow().select(o,o)}s.insertNodes(e);for(let o=0;o<r;o++)t[o].remove()}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=this._nodes,r=[];for(const i of t){const s=le(i);s!==null&&r.push(s)}return yn()||(this._cachedNodes=r),r}getTextContent(){const e=this.getNodes();let t="";for(let r=0;r<e.length;r++)t+=e[r].getTextContent();return t}deleteNodes(){const e=this.getNodes();if((L()||Jt())===this&&e[0]){const t=fe(e[0],"next");Gc(et(t,t))}for(const t of e)t.remove()}}function O(n){return n instanceof bt}class bt{format;style;anchor;focus;_cachedNodes;dirty;constructor(e,t,r,i){this.anchor=e,this.focus=t,e._selection=this,t._selection=this,this._cachedNodes=null,this.format=r,this.style=i,this.dirty=!1}getCachedNodes(){return this._cachedNodes}setCachedNodes(e){this._cachedNodes=e}is(e){return!!O(e)&&this.anchor.is(e.anchor)&&this.focus.is(e.focus)&&this.format===e.format&&this.style===e.style}isCollapsed(){return this.anchor.is(this.focus)}getNodes(){const e=this._cachedNodes;if(e!==null)return e;const t=(function(r){const i=[],[s,o]=r.getTextSlices();s&&i.push(s.caret.origin);const l=new Set,a=new Set;for(const c of r)if(Le(c)){const{origin:u}=c;i.length===0?l.add(u):(a.add(u),i.push(u))}else{const{origin:u}=c;E(u)&&a.has(u)||i.push(u)}if(o&&i.push(o.caret.origin),Kt(r.focus)&&E(r.focus.origin)&&r.focus.getNodeAtCaret()===null)for(let c=We(r.focus.origin,"previous");Le(c)&&l.has(c.origin)&&!c.origin.isEmpty()&&c.origin.is(i[i.length-1]);c=Pi(c))l.delete(c.origin),i.pop();for(;i.length>1;){const c=i[i.length-1];if(!E(c)||a.has(c)||c.isEmpty()||l.has(c))break;i.pop()}if(i.length===0&&r.isCollapsed()){const c=Ae(r.anchor),u=Ae(r.anchor.getFlipped()),f=p=>qe(p)?p.origin:p.getNodeAtCaret(),d=f(c)||f(u)||(r.anchor.getNodeAtCaret()?c.origin:u.origin);i.push(d)}return i})(Dl(js(this),"next"));return yn()||(this._cachedNodes=t),t}setTextNodeRange(e,t,r,i){this.anchor.set(e.__key,t,"text"),this.focus.set(r.__key,i,"text")}getTextContent(){const e=this.getNodes();if(e.length===0)return"";const t=e[0],r=e[e.length-1],i=this.anchor,s=this.focus,o=i.isBefore(s),[l,a]=ei(this);let c="",u=!0;for(let f=0;f<e.length;f++){const d=e[f];if(E(d)&&!d.isInline())u||(c+=`
`),u=!d.isEmpty();else if(u=!1,A(d)){let p=d.getTextContent();d===t?d===r?i.type==="element"&&s.type==="element"&&s.offset!==i.offset||(p=l<a?p.slice(l,a):p.slice(a,l)):p=o?p.slice(l):p.slice(a):d===r&&(p=o?p.slice(0,a):p.slice(0,l)),c+=p}else!V(d)&&!nn(d)||d===r&&this.isCollapsed()||(c+=d.getTextContent())}return c}applyDOMRange(e){const t=Y(),r=t.getEditorState()._selection,i=tl(e.startContainer,e.startOffset,e.endContainer,e.endOffset,t,r);if(i===null)return;const[s,o]=i;this.anchor.set(s.key,s.offset,s.type,!0),this.focus.set(o.key,o.offset,o.type,!0),Un(this)}clone(){const e=this.anchor,t=this.focus;return new bt(Ie(e.key,e.offset,e.type),Ie(t.key,t.offset,t.type),this.format,this.style)}toggleFormat(e){this.format=nr(this.format,e,null),this.dirty=!0}setFormat(e){this.format=e,this.dirty=!0}setStyle(e){this.style=e,this.dirty=!0}hasFormat(e){const t=ht[e];return(this.format&t)!==0}insertRawText(e){const t=e.split(/(\r?\n|\t)/),r=[],i=t.length;for(let s=0;s<i;s++){const o=t[s];o===`
`||o===`\r
`?r.push(mt()):o==="	"?r.push(mn()):r.push(ie(o))}this.insertNodes(r)}insertText(e){const t=this.anchor,r=this.focus,i=this.format,s=this.style;let o=t,l=r;!this.isCollapsed()&&r.isBefore(t)&&(o=r,l=t),o.type==="element"&&(function(g,_,y,x){const C=g.getNode(),w=C.getChildAtIndex(g.offset),v=ie();if(v.setFormat(y),v.setStyle(x),fl(w))w.splice(0,0,[v]);else{const T=ee(C)?Se().append(v):v;w===null?C.append(T):w.insertBefore(T)}g.is(_)&&_.set(v.__key,0,"text"),g.set(v.__key,0,"text")})(o,l,i,s),l.type==="element"&&hn(l,Ae(Ue(l,"next")));const a=o.offset;let c=l.offset;const u=this.getNodes(),f=u.length;let d=u[0];A(d)||k(26);const p=d.getTextContent().length,h=d.getParentOrThrow();let m=u[f-1];if(f===1&&l.type==="element"&&(c=p,l.set(o.key,c,"text")),this.isCollapsed()&&a===p&&(Ke(d)||!d.canInsertTextAfter()||!h.canInsertTextAfter()&&d.getNextSibling()===null)){let g=d.getNextSibling();if(A(g)&&g.canInsertTextBefore()&&!Ke(g)||(g=ie(),g.setFormat(i),g.setStyle(s),h.canInsertTextAfter()?d.insertAfter(g):h.insertAfter(g)),g.select(0,0),d=g,e!=="")return void this.insertText(e)}else if(this.isCollapsed()&&a===0&&(Ke(d)||!d.canInsertTextBefore()||!h.canInsertTextBefore()&&d.getPreviousSibling()===null)){let g=d.getPreviousSibling();if(A(g)&&!Ke(g)||(g=ie(),g.setFormat(i),h.canInsertTextBefore()?d.insertBefore(g):h.insertBefore(g)),g.select(),d=g,e!=="")return void this.insertText(e)}else if(d.isSegmented()&&a!==p){const g=ie(d.getTextContent());g.setFormat(i),d.replace(g),d=g}else if(!this.isCollapsed()&&e!==""){const g=m.getParent();if(!h.canInsertTextBefore()||!h.canInsertTextAfter()||E(g)&&(!g.canInsertTextBefore()||!g.canInsertTextAfter()))return this.insertText(""),el(this.anchor,this.focus,null),void this.insertText(e)}if(f===1){if(ct(d)){const x=ie(e);return x.select(),void d.replace(x)}const g=d.getFormat(),_=d.getStyle();if(a!==c||g===i&&_===s){if(Qo(d)){const x=ie(e);return x.setFormat(i),x.setStyle(s),x.select(),void d.replace(x)}}else{if(d.getTextContent()!==""){const x=ie(e);if(x.setFormat(i),x.setStyle(s),x.select(),a===0)d.insertBefore(x,!1);else{const[C]=d.splitText(a);C.insertAfter(x,!1)}return void(x.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length))}d.setFormat(i),d.setStyle(s)}const y=c-a;d=d.spliceText(a,y,e,!0),d.getTextContent()===""?d.remove():this.anchor.type==="text"&&(d.isComposing()?this.anchor.offset-=e.length:(this.format=g,this.style=_))}else{const g=new Set([...d.getParentKeys(),...m.getParentKeys()]),_=E(d)?d:d.getParentOrThrow();let y=E(m)?m:m.getParentOrThrow(),x=m;if(!_.is(y)&&y.isInline())do x=y,y=y.getParentOrThrow();while(y.isInline());if(l.type==="text"&&(c!==0||m.getTextContent()==="")||l.type==="element"&&m.getIndexWithinParent()<c)if(A(m)&&!ct(m)&&c!==m.getTextContentSize()){if(m.isSegmented()){const S=ie(m.getTextContent());m.replace(S),m=S}ee(l.getNode())||l.type!=="text"||(m=m.spliceText(0,c,"")),g.add(m.__key)}else{const S=m.getParentOrThrow();S.canBeEmpty()||S.getChildrenSize()!==1?m.remove():S.remove()}else g.add(m.__key);const C=y.getChildren(),w=new Set(u),v=_.is(y),T=_.isInline()&&d.getNextSibling()===null?_:d;for(let S=C.length-1;S>=0;S--){const N=C[S];if(N.is(d)||E(N)&&N.isParentOf(d))break;N.isAttached()&&(!w.has(N)||N.is(x)?v||T.insertAfter(N,!1):N.remove())}if(!v){let S=y,N=null;for(;S!==null;){const P=S.getChildren(),R=P.length;(R===0||P[R-1].is(N))&&(g.delete(S.__key),N=S),S=S.getParent()}}if(ct(d))if(a===p)d.select();else{const S=ie(e);S.select(),d.replace(S)}else d=d.spliceText(a,p-a,e,!0),d.getTextContent()===""?d.remove():d.isComposing()&&this.anchor.type==="text"&&(this.anchor.offset-=e.length);for(let S=1;S<f;S++){const N=u[S],P=N.__key;g.has(P)||N.remove()}}}removeText(){const e=L()===this;jn(this,qc(js(this))),e&&L()!==this&&me(this)}formatText(e,t=null){if(this.isCollapsed())return this.toggleFormat(e),void ae(null);const r=this.getNodes(),i=[];for(const C of r)A(C)&&i.push(C);const s=C=>{r.forEach(w=>{if(E(w)){const v=w.getFormatFlags(e,C);w.setTextFormat(v)}})},o=i.length;if(o===0)return this.toggleFormat(e),ae(null),void s(t);const l=this.anchor,a=this.focus,c=this.isBackward(),u=c?a:l,f=c?l:a;let d=0,p=i[0],h=u.type==="element"?0:u.offset;if(u.type==="text"&&h===p.getTextContentSize()&&(d=1,p=i[1],h=0),p==null)return;const m=p.getFormatFlags(e,t);s(m);const g=o-1;let _=i[g];const y=f.type==="text"?f.offset:_.getTextContentSize();if(p.is(_)){if(h===y)return;if(Ke(p)||h===0&&y===p.getTextContentSize())p.setFormat(m);else{const C=p.splitText(h,y),w=h===0?C[0]:C[1];w.setFormat(m),u.type==="text"&&u.set(w.__key,0,"text"),f.type==="text"&&f.set(w.__key,y-h,"text")}return void(this.format=m)}h===0||Ke(p)||([,p]=p.splitText(h),h=0),p.setFormat(m);const x=_.getFormatFlags(e,m);y>0&&(y===_.getTextContentSize()||Ke(_)||([_]=_.splitText(y)),_.setFormat(x));for(let C=d+1;C<g;C++){const w=i[C],v=w.getFormatFlags(e,x);w.setFormat(v)}u.type==="text"&&u.set(p.__key,h,"text"),f.type==="text"&&f.set(_.__key,y,"text"),this.format=m|x}insertNodes(e){if(e.length===0)return;if(this.isCollapsed()||this.removeText(),this.anchor.key==="root"){this.insertParagraph();const h=L();return O(h)||k(134),h.insertNodes(e)}const t=(this.isBackward()?this.focus:this.anchor).getNode(),r=dt(t,He),i=e[e.length-1];if(E(r)&&"__language"in r){if("__language"in e[0])this.insertText(e[0].getTextContent());else{const h=Cr(this);r.splice(h,0,e),i.selectEnd()}return}if(!e.some(h=>(E(h)||V(h))&&!h.isInline())){E(r)||k(211,t.constructor.name,t.getType());const h=Cr(this);return r.splice(h,0,e),void i.selectEnd()}const s=(function(h){const m=Se();let g=null;for(let _=0;_<h.length;_++){const y=h[_],x=nn(y);if(x||V(y)&&y.isInline()||E(y)&&y.isInline()||A(y)||y.isParentRequired()){if(g===null&&(g=y.createParentElementNode(),m.append(g),x))continue;g!==null&&g.append(y)}else m.append(y),g=null}return m})(e),o=s.getLastDescendant(),l=s.getChildren(),a=!E(r)||!r.isEmpty()?this.insertParagraph():null,c=l[l.length-1];let u=l[0];var f;E(f=u)&&He(f)&&!f.isEmpty()&&E(r)&&(!r.isEmpty()||r.canMergeWhenEmpty())&&(E(r)||k(211,t.constructor.name,t.getType()),r.append(...u.getChildren()),u=l[1]),u&&(r===null&&k(212,t.constructor.name,t.getType()),(function(h,m){const g=m.getParentOrThrow().getLastChild();let _=m;const y=[m];for(;_!==g;)_.getNextSibling()||k(140),_=_.getNextSibling(),y.push(_);let x=h;for(const C of y)x=x.insertAfter(C)})(r,u));const d=dt(o,He);a&&E(d)&&(a.canMergeWhenEmpty()||He(c))&&(d.append(...a.getChildren()),a.remove()),E(r)&&r.isEmpty()&&r.remove(),o.selectEnd();const p=E(r)?r.getLastChild():null;nn(p)&&d!==r&&p.remove()}insertParagraph(){if(this.anchor.key==="root"){const o=Se();return X().splice(this.anchor.offset,0,[o]),o.select(),o}const e=Cr(this),t=dt(this.anchor.getNode(),He);E(t)||k(213);const r=t.getChildAtIndex(e),i=r?[r,...r.getNextSiblings()]:[],s=t.insertNewAfter(this,!1);return s?(s.append(...i),s.selectStart(),s):null}insertLineBreak(e){const t=mt();if(this.insertNodes([t]),e){const r=t.getParentOrThrow(),i=t.getIndexWithinParent();r.select(i,i)}}extract(){const e=[...this.getNodes()],t=e.length;let r=e[0],i=e[t-1];const[s,o]=ei(this),l=this.isBackward(),[a,c]=l?[this.focus,this.anchor]:[this.anchor,this.focus],[u,f]=l?[o,s]:[s,o];if(t===0)return[];if(t===1){if(A(r)&&!this.isCollapsed()){const d=r.splitText(u,f),p=u===0?d[0]:d[1];return p?(a.set(p.getKey(),0,"text"),c.set(p.getKey(),p.getTextContentSize(),"text"),[p]):[]}return[r]}if(A(r)&&(u===r.getTextContentSize()?e.shift():u!==0&&([,r]=r.splitText(u),e[0]=r,a.set(r.getKey(),0,"text"))),A(i)){const d=i.getTextContent().length;f===0?e.pop():f!==d&&([i]=i.splitText(f),e[e.length-1]=i,c.set(i.getKey(),i.getTextContentSize(),"text"))}return e}modify(e,t,r){if(Ss(this,e,t,r))return;const i=e==="move",s=Y(),o=Te(Ce(s));if(!o)return;const l=s._blockCursorElement,a=s._rootElement,c=this.focus.getNode();if(a===null||l===null||!E(c)||c.isInline()||c.canBeEmpty()||si(l,s,a),this.dirty){let u=yt(s,this.anchor.key),f=yt(s,this.focus.key);this.anchor.type==="text"&&(u=$t(u)),this.focus.type==="text"&&(f=$t(f)),u&&f&&sl(o,u,this.anchor.offset,f,this.focus.offset)}if((function(u,f,d,p){u.modify(f,d,p)})(o,e,t?"backward":"forward",r),o.rangeCount>0){const u=o.getRangeAt(0),f=this.anchor.getNode(),d=ee(f)?f:Lc(f);if(this.applyDOMRange(u),this.dirty=!0,!i){const p=this.getNodes(),h=[];let m=!1;for(let g=0;g<p.length;g++){const _=p[g];ii(_,d)?h.push(_):m=!0}if(m&&h.length>0)if(t){const g=h[0];E(g)?g.selectStart():g.getParentOrThrow().selectStart()}else{const g=h[h.length-1];E(g)?g.selectEnd():g.getParentOrThrow().selectEnd()}o.anchorNode===u.startContainer&&o.anchorOffset===u.startOffset||(function(g){const _=g.focus,y=g.anchor,x=y.key,C=y.offset,w=y.type;y.set(_.key,_.offset,_.type,!0),_.set(x,C,w,!0)})(this)}}r==="lineboundary"&&Ss(this,e,t,r,"decorators")}forwardDeletion(e,t,r){if(!r&&(e.type==="element"&&E(t)&&e.offset===t.getChildrenSize()||e.type==="text"&&e.offset===t.getTextContentSize())){const i=t.getParent(),s=t.getNextSibling()||(i===null?null:i.getNextSibling());if(E(s)&&s.isShadowRoot())return!0}return!1}deleteCharacter(e){const t=this.isCollapsed();if(this.isCollapsed()){const r=this.anchor;let i=r.getNode();if(this.forwardDeletion(r,i,e))return;const s=Ii(Ue(r,e?"previous":"next"));if(s.getTextSlices().every(l=>l===null||l.distance===0)){let l={type:"initial"};for(const a of s.iterNodeCarets("shadowRoot"))if(Le(a)){if(!a.origin.isInline()){if(a.origin.isShadowRoot()){if(l.type==="merge-block")break;if(E(s.anchor.origin)&&s.anchor.origin.isEmpty()){const c=Ae(a);jn(this,et(c,c)),s.anchor.origin.remove()}return}l.type!=="merge-next-block"&&l.type!=="merge-block"||(l={block:l.block,caret:a,type:"merge-block"})}}else{if(l.type==="merge-block")break;if(Kt(a)){if(E(a.origin)){if(a.origin.isInline()){if(!a.origin.isParentOf(s.anchor.origin))break}else l={block:a.origin,type:"merge-next-block"};continue}if(V(a.origin)){if(!a.origin.isIsolated())if(l.type==="merge-next-block"&&(a.origin.isKeyboardSelectable()||!a.origin.isInline())&&E(s.anchor.origin)&&s.anchor.origin.isEmpty()){s.anchor.origin.remove();const c=il();c.add(a.origin.getKey()),me(c)}else a.origin.remove();return}break}}if(l.type==="merge-block"){const{caret:a,block:c}=l;return jn(this,et(!a.origin.isEmpty()&&c.isEmpty()?Ri(fe(c,a.direction)):s.anchor,a)),this.removeText()}}const o=this.focus;if(this.modify("extend",e,"character"),this.isCollapsed()){if(e&&r.offset===0&&ps(this,r.getNode()))return}else{const l=o.type==="text"?o.getNode():null;if(i=r.type==="text"?r.getNode():null,l!==null&&l.isSegmented()){const a=o.offset,c=l.getTextContentSize();if(l.is(i)||e&&a!==c||!e&&a!==0)return void ms(l,e,a)}else if(i!==null&&i.isSegmented()){const a=r.offset,c=i.getTextContentSize();if(i.is(l)||e&&a!==0||!e&&a!==c)return void ms(i,e,a)}(function(a,c){const u=a.anchor,f=a.focus,d=u.getNode(),p=f.getNode();if(d===p&&u.type==="text"&&f.type==="text"){const h=u.offset,m=f.offset,g=h<m,_=g?h:m,y=g?m:h,x=y-1;_!==x&&(function(C){return!(Cl(C)||yc(C))})(d.getTextContent().slice(_,y))&&(c?f.set(f.key,x,f.type):u.set(u.key,x,u.type))}})(this,e)}}if(this.removeText(),e&&!t&&this.isCollapsed()&&this.anchor.type==="element"&&this.anchor.offset===0){const r=this.anchor.getNode();r.isEmpty()&&ee(r.getParent())&&r.getPreviousSibling()===null&&ps(this,r)}}deleteLine(e){this.isCollapsed()&&this.modify("extend",e,"lineboundary"),this.isCollapsed()?this.deleteCharacter(e):this.removeText()}deleteWord(e){if(this.isCollapsed()){const t=this.anchor,r=t.getNode();if(this.forwardDeletion(t,r,e))return;this.modify("extend",e,"word")}this.removeText()}isBackward(){return this.focus.isBefore(this.anchor)}getStartEndPoints(){return[this.anchor,this.focus]}}function _e(n){return n instanceof cr}function gs(n){const e=n.offset;if(n.type==="text")return e;const t=n.getNode();return e===t.getChildrenSize()?t.getTextContent().length:0}function ei(n){const e=n.getStartEndPoints();if(e===null)return[0,0];const[t,r]=e;return t.type==="element"&&r.type==="element"&&t.key===r.key&&t.offset===r.offset?[0,0]:[gs(t),gs(r)]}function ps(n,e){for(let t=e;t;t=t.getParent()){if(E(t)){if(t.collapseAtStart(n))return!0;if(Re(t))break}if(t.getPreviousSibling())break}return!1}const yc=(()=>{try{const n=new RegExp("\\p{Emoji}","u"),e=n.test.bind(n);if(e("❤️")&&e("#️⃣")&&e("👍"))return e}catch{}return()=>!1})();function ms(n,e,t){const r=n,i=r.getTextContent().split(/(?=\s)/g),s=i.length;let o=0,l=0;for(let c=0;c<s;c++){const u=c===s-1;if(l=o,o+=i[c].length,e&&o===t||o>t||u){i.splice(c,1),u&&(l=void 0);break}}const a=i.join("").trim();a===""?r.remove():(r.setTextContent(a),r.select(l,l))}function ys(n,e,t,r){let i,s=e;if(ye(n)){let o=!1;const l=n.childNodes,a=l.length,c=r._blockCursorElement;s===a&&(o=!0,s=a-1);let u=l[s],f=!1;if(u===c)u=l[s+1],f=!0;else if(c!==null){const d=c.parentNode;n===d&&e>Array.prototype.indexOf.call(d.children,c)&&s--}if(i=At(u),A(i))s=Xe(i,o?"next":"previous");else{let d=At(n);if(d===null)return null;if(E(d)){const p=r.getElementByKey(d.getKey());p===null&&k(214),[d,s]=d.getDOMSlot(p).resolveChildIndex(d,p,n,e),E(d)||k(215),o&&s>=d.getChildrenSize()&&(s=Math.max(0,d.getChildrenSize()-1));let m=d.getChildAtIndex(s);if(E(m)&&(function(g,_,y){const x=g.getParent();return y===null||x===null||!x.canBeEmpty()||x!==y.getNode()})(m,0,t)){const g=o?m.getLastDescendant():m.getFirstDescendant();g===null?d=m:(m=g,d=E(m)?m:m.getParentOrThrow()),s=0}A(m)?(i=m,d=null,s=Xe(m,o?"next":"previous")):m!==d&&o&&!f&&(E(d)||k(216),s=Math.min(d.getChildrenSize(),s+1))}else{const p=d.getIndexWithinParent();s=e===0&&V(d)&&At(n)===d?p:p+1,d=d.getParentOrThrow()}if(E(d))return Ie(d.__key,s,"element")}}else i=At(n);return A(i)?Ie(i.__key,Xe(i,s,"clamp"),"text"):null}function _s(n,e,t){const r=n.offset,i=n.getNode();if(r===0){const s=i.getPreviousSibling(),o=i.getParent();if(e){if((t||!e)&&s===null&&E(o)&&o.isInline()){const l=o.getPreviousSibling();A(l)&&n.set(l.__key,l.getTextContent().length,"text")}}else E(s)&&!t&&s.isInline()?n.set(s.__key,s.getChildrenSize(),"element"):A(s)&&n.set(s.__key,s.getTextContent().length,"text")}else if(r===i.getTextContent().length){const s=i.getNextSibling(),o=i.getParent();if(e&&E(s)&&s.isInline())n.set(s.__key,0,"element");else if((t||e)&&s===null&&E(o)&&o.isInline()&&!o.canInsertTextAfter()){const l=o.getNextSibling();A(l)&&n.set(l.__key,0,"text")}}}function el(n,e,t){if(n.type==="text"&&e.type==="text"){const r=n.isBefore(e),i=n.is(e);_s(n,r,i),_s(e,!r,i),i&&e.set(n.key,n.offset,n.type);const s=Y();if(s.isComposing()&&s._compositionKey!==n.key&&O(t)){const o=t.anchor,l=t.focus;n.set(o.key,o.offset,o.type,!0),e.set(l.key,l.offset,l.type,!0)}}}function tl(n,e,t,r,i,s){if(n===null||t===null||!vn(i,n,t))return null;const o=ys(n,e,O(s)?s.anchor:null,i);if(o===null)return null;const l=ys(t,r,O(s)?s.focus:null,i);if(l===null)return null;if(o.type==="element"&&l.type==="element"){const a=At(n),c=At(t);if(V(a)&&V(c))return null}return el(o,l,s),[o,l]}function ti(n){return E(n)&&!n.isInline()}function nl(n,e,t,r,i,s){const o=tt(),l=new bt(Ie(n,e,i),Ie(t,r,s),0,"");return l.dirty=!0,o._selection=l,l}function rl(){const n=Ie("root",0,"element"),e=Ie("root",0,"element");return new bt(n,e,0,"")}function il(){return new cr(new Set)}function yi(n,e,t,r){const i=t._window;if(i===null)return null;const s=r||i.event,o=s?s.type:void 0,l=o==="selectionchange",a=!Rr&&(l||o==="beforeinput"||o==="compositionstart"||o==="compositionend"||o==="click"&&s&&s.detail===3||o==="drop"||o===void 0);let c,u,f,d;if(O(n)&&!a)return n.clone();if(e===null)return null;if(c=e.anchorNode,u=e.focusNode,f=e.anchorOffset,d=e.focusOffset,(l||o===void 0)&&O(n)&&!vn(t,c,u))return n.clone();const p=tl(c,f,u,d,t,n);if(p===null)return null;const[h,m]=p;return new bt(h,m,O(n)?n.format:0,O(n)?n.style:"")}function L(){return tt()._selection}function Jt(){return Y()._editorState._selection}function er(n,e,t,r=1){const i=n.anchor,s=n.focus,o=i.getNode(),l=s.getNode();if(!e.is(o)&&!e.is(l))return;const a=e.__key;if(n.isCollapsed()){const c=i.offset;if(t<=c&&r>0||t<c&&r<0){const u=Math.max(0,c+r);i.set(a,u,"element"),s.set(a,u,"element"),xs(n)}}else{const c=n.isBackward(),u=c?s:i,f=u.getNode(),d=c?i:s,p=d.getNode();if(e.is(f)){const h=u.offset;(t<=h&&r>0||t<h&&r<0)&&u.set(a,Math.max(0,h+r),"element")}if(e.is(p)){const h=d.offset;(t<=h&&r>0||t<h&&r<0)&&d.set(a,Math.max(0,h+r),"element")}}xs(n)}function xs(n){const e=n.anchor,t=e.offset,r=n.focus,i=r.offset,s=e.getNode(),o=r.getNode();if(n.isCollapsed()){if(!E(s))return;const l=s.getChildrenSize(),a=t>=l,c=a?s.getChildAtIndex(l-1):s.getChildAtIndex(t);if(A(c)){let u=0;a&&(u=c.getTextContentSize()),e.set(c.__key,u,"text"),r.set(c.__key,u,"text")}return}if(E(s)){const l=s.getChildrenSize(),a=t>=l,c=a?s.getChildAtIndex(l-1):s.getChildAtIndex(t);if(A(c)){let u=0;a&&(u=c.getTextContentSize()),e.set(c.__key,u,"text")}}if(E(o)){const l=o.getChildrenSize(),a=i>=l,c=a?o.getChildAtIndex(l-1):o.getChildAtIndex(i);if(A(c)){let u=0;a&&(u=c.getTextContentSize()),r.set(c.__key,u,"text")}}}function tr(n,e,t,r,i){let s=null,o=0,l=null;r!==null?(s=r.__key,A(r)?(o=r.getTextContentSize(),l="text"):E(r)&&(o=r.getChildrenSize(),l="element")):i!==null&&(s=i.__key,A(i)?l="text":E(i)&&(l="element")),s!==null&&l!==null?n.set(s,o,l):(o=e.getIndexWithinParent(),o===-1&&(o=t.getChildrenSize()),n.set(t.__key,o,"element"))}function vs(n,e,t,r,i){n.type==="text"?n.set(t,n.offset+(e?0:i),"text"):n.offset>r.getIndexWithinParent()&&n.set(n.key,n.offset-1,"element")}function sl(n,e,t,r,i){try{n.setBaseAndExtent(e,t,r,i)}catch{}}function _c(n,e,t,r,i,s,o){const l=r.anchorNode,a=r.focusNode,c=r.anchorOffset,u=r.focusOffset,f=document.activeElement;if(i.has(oc)&&f!==s||f!==null&&bi(f))return;if(!O(e))return void(n!==null&&vn(t,l,a)&&r.removeAllRanges());const d=e.anchor,p=e.focus,h=d.key,m=p.key,g=yt(t,h),_=yt(t,m),y=d.offset,x=p.offset,C=e.format,w=e.style,v=e.isCollapsed();let T=g,S=_,N=!1;if(d.type==="text"){T=$t(g);const F=d.getNode();N=F.getFormat()!==C||F.getStyle()!==w}else O(n)&&n.anchor.type==="text"&&(N=!0);var P,R,z,$,B;if(p.type==="text"&&(S=$t(_)),T!==null&&S!==null&&(v&&(n===null||N||O(n)&&(n.format!==C||n.style!==w))&&(P=C,R=w,z=y,$=h,B=performance.now(),Uo=[P,R,z,$,B]),c!==y||u!==x||l!==T||a!==S||r.type==="Range"&&v||(f!==null&&s.contains(f)||i.has(cc)||s.focus({preventScroll:!0}),d.type==="element"))){if(sl(r,T,y,S,x),!i.has(lc)&&e.isCollapsed()&&s!==null&&s===document.activeElement){const F=O(e)&&e.anchor.type==="element"?T.childNodes[y]||null:r.rangeCount>0?r.getRangeAt(0):null;if(F!==null){let U;if(F instanceof Text){const W=document.createRange();W.selectNode(F),U=W.getBoundingClientRect()}else U=F.getBoundingClientRect();(function(W,ce,te){const xe=wl(te),nt=Mi(xe);if(xe===null||nt===null)return;let{top:G,bottom:Q}=ce,ne=0,K=0,Z=te;for(;Z!==null;){const ke=Z===xe.body;if(ke)ne=0,K=Ce(W).innerHeight;else{const Me=Z.getBoundingClientRect();ne=Me.top,K=Me.bottom}let be=0;if(G<ne?be=-(ne-G):Q>K&&(be=Q-K),be!==0)if(ke)nt.scrollBy(0,be);else{const Me=Z.scrollTop;Z.scrollTop+=be;const he=Z.scrollTop-Me;G-=he,Q-=he}if(ke)break;Z=Sn(Z)}})(t,U,s)}}Yr=!0}}function xc(n){let e=L()||Jt();e===null&&(e=X().selectEnd()),e.insertNodes(n)}function Cr(n){let e=n;n.isCollapsed()||e.removeText();const t=L();O(t)&&(e=t),O(e)||k(161);const r=e.anchor;let i=r.getNode(),s=r.offset;for(;!He(i);){const o=i;if([i,s]=vc(i,s),o.is(i))break}return s}function vc(n,e){const t=n.getParent();if(!t){const i=Se();return X().append(i),i.select(),[X(),0]}if(A(n)){const i=n.splitText(e);if(i.length===0)return[t,n.getIndexWithinParent()];const s=e===0?0:1;return[t,i[0].getIndexWithinParent()+s]}if(!E(n)||e===0)return[t,n.getIndexWithinParent()];const r=n.getChildAtIndex(e);if(r){const i=new bt(Ie(n.__key,e,"element"),Ie(n.__key,e,"element"),0,""),s=n.insertNewAfter(i);s&&s.append(r,...r.getNextSiblings())}return[t,n.getIndexWithinParent()+1]}function Ss(n,e,t,r,i="decorators-and-blocks"){if(e==="move"&&r==="character"&&!n.isCollapsed()){const[u,f]=t===n.isBackward()?[n.focus,n.anchor]:[n.anchor,n.focus];return f.set(u.key,u.offset,u.type),!0}const s=Ue(n.focus,t?"previous":"next"),o=r==="lineboundary",l=e==="move";let a=s,c=i==="decorators-and-blocks";if(!Al(a)){for(const u of a){c=!1;const{origin:f}=u;if(!V(f)||f.isIsolated()||(a=u,!o||!f.isInline()))break}if(c)for(const u of Ii(s).iterNodeCarets(e==="extend"?"shadowRoot":"root")){if(Le(u))u.origin.isInline()||(a=u);else{if(E(u.origin))continue;V(u.origin)&&!u.origin.isInline()&&(a=u)}break}}if(a===s)return!1;if(l&&!o&&V(a.origin)&&a.origin.isKeyboardSelectable()){const u=il();return u.add(a.origin.getKey()),me(u),!0}return a=Ae(a),l&&hn(n.anchor,a),hn(n.focus,a),c||!o}let se=null,oe=null,pe=!1,br=!1,Fn=0;const Cs={characterData:!0,childList:!0,subtree:!0};function yn(){return pe||se!==null&&se._readOnly}function ue(){pe&&k(13)}function ol(){Fn>99&&k(14)}function tt(){return se===null&&k(195,ll()),se}function Y(){return oe===null&&k(196,ll()),oe}function ll(){let n=0;const e=new Set,t=Ft.version;if(typeof window<"u")for(const i of document.querySelectorAll("[contenteditable]")){const s=dr(i);if(Ni(s))n++;else if(s){let o=String(s.constructor.version||"<0.17.1");o===t&&(o+=" (separately built, likely a bundler configuration issue)"),e.add(o)}}let r=` Detected on the page: ${n} compatible editor(s) with version ${t}`;return e.size&&(r+=` and incompatible editors with versions ${Array.from(e).join(", ")}`),r}function Sc(){return oe}function bs(n,e,t){const r=e.__type,i=pl(n,r);let s=t.get(r);s===void 0&&(s=Array.from(i.transforms),t.set(r,s));const o=s.length;for(let l=0;l<o&&(s[l](e),e.isAttached());l++);}function Ns(n,e){return n!==void 0&&n.__key!==e&&n.isAttached()}function al(n,e){if(!e)return;const t=n._updateTags;let r=e;Array.isArray(e)||(r=[e]);for(const i of r)t.add(i)}function Cc(n){return _i(n,Y()._nodes)}function _i(n,e){const t=n.type,r=e.get(t);r===void 0&&k(17,t);const i=r.klass;n.type!==i.getType()&&k(18,i.name);const s=i.importJSON(n),o=n.children;if(E(s)&&Array.isArray(o))for(let l=0;l<o.length;l++){const a=_i(o[l],e);s.append(a)}return s}function Es(n,e,t){const r=se,i=pe,s=oe;se=e,pe=!0,oe=n;try{return t()}finally{se=r,pe=i,oe=s}}function Be(n,e){const t=n._pendingEditorState,r=n._rootElement,i=n._headless||r===null;if(t===null)return;const s=n._editorState,o=s._selection,l=t._selection,a=n._dirtyType!==0,c=se,u=pe,f=oe,d=n._updating,p=n._observer;let h=null;if(n._pendingEditorState=null,n._editorState=t,!i&&a&&p!==null){oe=n,se=t,pe=!1,n._updating=!0;try{const v=n._dirtyType,T=n._dirtyElements,S=n._dirtyLeaves;p.disconnect(),h=ja(s,t,n,v,T,S)}catch(v){if(v instanceof Error&&n._onError(v),br)throw v;return hl(n,null,r,t),yo(n),n._dirtyType=2,br=!0,Be(n,s),void(br=!1)}finally{p.observe(r,Cs),n._updating=d,se=c,pe=u,oe=f}}t._readOnly||(t._readOnly=!0);const m=n._dirtyLeaves,g=n._dirtyElements,_=n._normalizedNodes,y=n._updateTags,x=n._deferred;a&&(n._dirtyType=0,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements=new Map,n._normalizedNodes=new Set,n._updateTags=new Set),(function(v,T){const S=v._decorators;let N=v._pendingDecorators||S;const P=T._nodeMap;let R;for(R in N)P.has(R)||(N===S&&(N=vl(v)),delete N[R])})(n,t);const C=i?null:Te(Ce(n));if(n._editable&&C!==null&&(a||l===null||l.dirty||!l.is(o))&&r!==null&&!y.has(ac)){oe=n,se=t;try{if(p!==null&&p.disconnect(),a||l===null||l.dirty){const v=n._blockCursorElement;v!==null&&si(v,n,r),_c(o,l,n,C,y,r)}(function(v,T,S){let N=v._blockCursorElement;if(O(S)&&S.isCollapsed()&&S.anchor.type==="element"&&T.contains(document.activeElement)){const P=S.anchor,R=P.getNode(),z=P.offset;let $=!1,B=null;if(z===R.getChildrenSize())Er(R.getChildAtIndex(z-1))&&($=!0);else{const F=R.getChildAtIndex(z);if(F!==null&&Er(F)){const U=F.getPreviousSibling();(U===null||Er(U))&&($=!0,B=v.getElementByKey(F.__key))}}if($){const F=v.getElementByKey(R.__key);return N===null&&(v._blockCursorElement=N=(function(U){const W=U.theme,ce=document.createElement("div");ce.contentEditable="false",ce.setAttribute("data-lexical-cursor","true");let te=W.blockCursor;if(te!==void 0){if(typeof te=="string"){const xe=fo(te);te=W.blockCursor=xe}te!==void 0&&ce.classList.add(...te)}return ce})(v._config)),T.style.caretColor="transparent",void(B===null?F.appendChild(N):F.insertBefore(N,B))}}N!==null&&si(N,v,T)})(n,r,l)}finally{p!==null&&p.observe(r,Cs),oe=f,se=c}}h!==null&&(function(v,T,S,N,P){const R=Array.from(v._listeners.mutation),z=R.length;for(let $=0;$<z;$++){const[B,F]=R[$];for(const U of F){const W=T.get(U);W!==void 0&&B(W,{dirtyLeaves:N,prevEditorState:P,updateTags:S})}}})(n,h,y,m,s),O(l)||l===null||o!==null&&o.is(l)||n.dispatchCommand(bo,void 0);const w=n._pendingDecorators;w!==null&&(n._decorators=w,n._pendingDecorators=null,rn("decorator",n,!0,w)),(function(v,T,S){const N=Ms(T),P=Ms(S);N!==P&&rn("textcontent",v,!0,P)})(n,e||s,t),rn("update",n,!0,{dirtyElements:g,dirtyLeaves:m,editorState:t,mutatedNodes:h,normalizedNodes:_,prevEditorState:e||s,tags:y}),(function(v,T){if(v._deferred=[],T.length!==0){const S=v._updating;v._updating=!0;try{for(let N=0;N<T.length;N++)T[N]()}finally{v._updating=S}}})(n,x),(function(v){const T=v._updates;if(T.length!==0){const S=T.shift();if(S){const[N,P]=S;ur(v,N,P)}}})(n)}function rn(n,e,t,...r){const i=e._updating;e._updating=t;try{const s=Array.from(e._listeners[n]);for(let o=0;o<s.length;o++)s[o].apply(null,r)}finally{e._updating=i}}function ws(n,e){const t=n._updates;let r=e||!1;for(;t.length!==0;){const i=t.shift();if(i){const[s,o]=i,l=n._pendingEditorState;let a;o!==void 0&&(a=o.onUpdate,o.skipTransforms&&(r=!0),o.discrete&&(l===null&&k(191),l._flushSync=!0),a&&n._deferred.push(a),al(n,o.tag)),l==null?ur(n,s,o):s()}}return r}function ur(n,e,t){const r=n._updateTags;let i,s=!1,o=!1;t!==void 0&&(i=t.onUpdate,al(n,t.tag),s=t.skipTransforms||!1,o=t.discrete||!1),i&&n._deferred.push(i);const l=n._editorState;let a=n._pendingEditorState,c=!1;(a===null||a._readOnly)&&(a=n._pendingEditorState=ul(a||l),c=!0),a._flushSync=o;const u=se,f=pe,d=oe,p=n._updating;se=a,pe=!1,n._updating=!0,oe=n;const h=n._headless||n.getRootElement()===null;Si(null);try{c&&(h?l._selection!==null&&(a._selection=l._selection.clone()):a._selection=(function(y,x){const C=y.getEditorState()._selection,w=Te(Ce(y));return O(C)||C==null?yi(C,w,y,x):C.clone()})(n,t&&t.event||null));const g=n._compositionKey;e(),s=ws(n,s),(function(y,x){const C=x.getEditorState()._selection,w=y._selection;if(O(w)){const v=w.anchor,T=w.focus;let S;if(v.type==="text"&&(S=v.getNode(),S.selectionTransform(C,w)),T.type==="text"){const N=T.getNode();S!==N&&N.selectionTransform(C,w)}}})(a,n),n._dirtyType!==0&&(s?(function(y,x){const C=x._dirtyLeaves,w=y._nodeMap;for(const v of C){const T=w.get(v);A(T)&&T.isAttached()&&T.isSimpleText()&&!T.isUnmergeable()&&ns(T)}})(a,n):(function(y,x){const C=x._dirtyLeaves,w=x._dirtyElements,v=y._nodeMap,T=Ge(),S=new Map;let N=C,P=N.size,R=w,z=R.size;for(;P>0||z>0;){if(P>0){x._dirtyLeaves=new Set;for(const $ of N){const B=v.get($);A(B)&&B.isAttached()&&B.isSimpleText()&&!B.isUnmergeable()&&ns(B),B!==void 0&&Ns(B,T)&&bs(x,B,S),C.add($)}if(N=x._dirtyLeaves,P=N.size,P>0){Fn++;continue}}x._dirtyLeaves=new Set,x._dirtyElements=new Map,R.delete("root")&&R.set("root",!0);for(const $ of R){const B=$[0],F=$[1];if(w.set(B,F),!F)continue;const U=v.get(B);U!==void 0&&Ns(U,T)&&bs(x,U,S)}N=x._dirtyLeaves,P=N.size,R=x._dirtyElements,z=R.size,Fn++}x._dirtyLeaves=C,x._dirtyElements=w})(a,n),ws(n),(function(y,x,C,w){const v=y._nodeMap,T=x._nodeMap,S=[];for(const[N]of w){const P=T.get(N);P!==void 0&&(P.isAttached()||(E(P)&&go(P,N,v,T,S,w),v.has(N)||w.delete(N),S.push(N)))}for(const N of S)T.delete(N);for(const N of C){const P=T.get(N);P===void 0||P.isAttached()||(v.has(N)||C.delete(N),T.delete(N))}})(l,a,n._dirtyLeaves,n._dirtyElements)),g!==n._compositionKey&&(a._flushSync=!0);const _=a._selection;if(O(_)){const y=a._nodeMap,x=_.anchor.key,C=_.focus.key;y.get(x)!==void 0&&y.get(C)!==void 0||k(19)}else _e(_)&&_._nodes.size===0&&(a._selection=null)}catch(g){return g instanceof Error&&n._onError(g),n._pendingEditorState=l,n._dirtyType=2,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),void Be(n)}finally{se=u,pe=f,oe=d,n._updating=p,Fn=0}n._dirtyType!==0||n._deferred.length>0||(function(g,_){const y=_.getEditorState()._selection,x=g._selection;if(x!==null){if(x.dirty||!x.is(y))return!0}else if(y!==null)return!0;return!1})(a,n)?a._flushSync?(a._flushSync=!1,Be(n)):c&&kc(()=>{Be(n)}):(a._flushSync=!1,c&&(r.clear(),n._deferred=[],n._pendingEditorState=null))}function Pe(n,e,t){oe===n&&t===void 0?e():ur(n,e,t)}class sn{element;before;after;constructor(e,t,r){this.element=e,this.before=t||null,this.after=r||null}withBefore(e){return new sn(this.element,e,this.after)}withAfter(e){return new sn(this.element,this.before,e)}withElement(e){return this.element===e?this:new sn(e,this.before,this.after)}insertChild(e){const t=this.before||this.getManagedLineBreak();return t!==null&&t.parentElement!==this.element&&k(222),this.element.insertBefore(e,t),this}removeChild(e){return e.parentElement!==this.element&&k(223),this.element.removeChild(e),this}replaceChild(e,t){return t.parentElement!==this.element&&k(224),this.element.replaceChild(e,t),this}getFirstChild(){const e=this.after?this.after.nextSibling:this.element.firstChild;return e===this.before||e===this.getManagedLineBreak()?null:e}getManagedLineBreak(){return this.element.__lexicalLineBreak||null}setManagedLineBreak(e){if(e===null)this.removeManagedLineBreak();else{const t=e==="decorator"&&(pn||Bt||gn);this.insertManagedLineBreak(t)}}removeManagedLineBreak(){const e=this.getManagedLineBreak();if(e){const t=this.element,r=e.nodeName==="IMG"?e.nextSibling:null;r&&t.removeChild(r),t.removeChild(e),t.__lexicalLineBreak=void 0}}insertManagedLineBreak(e){const t=this.getManagedLineBreak();if(t){if(e===(t.nodeName==="IMG"))return;this.removeManagedLineBreak()}const r=this.element,i=this.before,s=document.createElement("br");if(r.insertBefore(s,i),e){const o=document.createElement("img");o.setAttribute("data-lexical-linebreak","true"),o.style.cssText="display: inline !important; border: 0px !important; margin: 0px !important;",o.alt="",r.insertBefore(o,s),r.__lexicalLineBreak=o}else r.__lexicalLineBreak=s}getFirstChildOffset(){let e=0;for(let t=this.after;t!==null;t=t.previousSibling)e++;return e}resolveChildIndex(e,t,r,i){if(r===this.element){const a=this.getFirstChildOffset();return[e,Math.min(a+e.getChildrenSize(),Math.max(a,i))]}const s=Ts(t,r);s.push(i);const o=Ts(t,this.element);let l=e.getIndexWithinParent();for(let a=0;a<o.length;a++){const c=s[a],u=o[a];if(c===void 0||c<u)break;if(c>u){l+=1;break}}return[e.getParentOrThrow(),l]}}function Ts(n,e){const t=[];let r=e;for(;r!==n&&r!==null;r=r.parentNode){let i=0;for(let s=r.previousSibling;s!==null;s=s.previousSibling)i++;t.push(i)}return r!==n&&k(225),t.reverse()}class _n extends De{__first;__last;__size;__format;__style;__indent;__dir;__textFormat;__textStyle;constructor(e){super(e),this.__first=null,this.__last=null,this.__size=0,this.__format=0,this.__style="",this.__indent=0,this.__dir=null,this.__textFormat=0,this.__textStyle=""}afterCloneFrom(e){super.afterCloneFrom(e),this.__key===e.__key&&(this.__first=e.__first,this.__last=e.__last,this.__size=e.__size),this.__indent=e.__indent,this.__format=e.__format,this.__style=e.__style,this.__dir=e.__dir,this.__textFormat=e.__textFormat,this.__textStyle=e.__textStyle}getFormat(){return this.getLatest().__format}getFormatType(){const e=this.getFormat();return ka[e]||""}getStyle(){return this.getLatest().__style}getIndent(){return this.getLatest().__indent}getChildren(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t),t=t.getNextSibling();return e}getChildrenKeys(){const e=[];let t=this.getFirstChild();for(;t!==null;)e.push(t.__key),t=t.getNextSibling();return e}getChildrenSize(){return this.getLatest().__size}isEmpty(){return this.getChildrenSize()===0}isDirty(){const e=Y()._dirtyElements;return e!==null&&e.has(this.__key)}isLastChild(){const e=this.getLatest(),t=this.getParentOrThrow().getLastChild();return t!==null&&t.is(e)}getAllTextNodes(){const e=[];let t=this.getFirstChild();for(;t!==null;){if(A(t)&&e.push(t),E(t)){const r=t.getAllTextNodes();e.push(...r)}t=t.getNextSibling()}return e}getFirstDescendant(){let e=this.getFirstChild();for(;E(e);){const t=e.getFirstChild();if(t===null)break;e=t}return e}getLastDescendant(){let e=this.getLastChild();for(;E(e);){const t=e.getLastChild();if(t===null)break;e=t}return e}getDescendantByIndex(e){const t=this.getChildren(),r=t.length;if(e>=r){const s=t[r-1];return E(s)&&s.getLastDescendant()||s||null}const i=t[e];return E(i)&&i.getFirstDescendant()||i||null}getFirstChild(){const e=this.getLatest().__first;return e===null?null:le(e)}getFirstChildOrThrow(){const e=this.getFirstChild();return e===null&&k(45,this.__key),e}getLastChild(){const e=this.getLatest().__last;return e===null?null:le(e)}getLastChildOrThrow(){const e=this.getLastChild();return e===null&&k(96,this.__key),e}getChildAtIndex(e){const t=this.getChildrenSize();let r,i;if(e<t/2){for(r=this.getFirstChild(),i=0;r!==null&&i<=e;){if(i===e)return r;r=r.getNextSibling(),i++}return null}for(r=this.getLastChild(),i=t-1;r!==null&&i>=e;){if(i===e)return r;r=r.getPreviousSibling(),i--}return null}getTextContent(){let e="";const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContent(),E(s)&&i!==r-1&&!s.isInline()&&(e+=Qe)}return e}getTextContentSize(){let e=0;const t=this.getChildren(),r=t.length;for(let i=0;i<r;i++){const s=t[i];e+=s.getTextContentSize(),E(s)&&i!==r-1&&!s.isInline()&&(e+=2)}return e}getDirection(){return this.getLatest().__dir}getTextFormat(){return this.getLatest().__textFormat}hasFormat(e){if(e!==""){const t=Yi[e];return(this.getFormat()&t)!==0}return!1}hasTextFormat(e){const t=ht[e];return(this.getTextFormat()&t)!==0}getFormatFlags(e,t){return nr(this.getLatest().__textFormat,e,t)}getTextStyle(){return this.getLatest().__textStyle}select(e,t){ue();const r=L();let i=e,s=t;const o=this.getChildrenSize();if(!this.canBeEmpty()){if(e===0&&t===0){const a=this.getFirstChild();if(A(a)||E(a))return a.select(0,0)}else if(!(e!==void 0&&e!==o||t!==void 0&&t!==o)){const a=this.getLastChild();if(A(a)||E(a))return a.select()}}i===void 0&&(i=o),s===void 0&&(s=o);const l=this.__key;return O(r)?(r.anchor.set(l,i,"element"),r.focus.set(l,s,"element"),r.dirty=!0,r):nl(l,i,l,s,"element","element")}selectStart(){const e=this.getFirstDescendant();return e?e.selectStart():this.select()}selectEnd(){const e=this.getLastDescendant();return e?e.selectEnd():this.select()}clear(){const e=this.getWritable();return this.getChildren().forEach(t=>t.remove()),e}append(...e){return this.splice(this.getChildrenSize(),0,e)}setDirection(e){const t=this.getWritable();return t.__dir=e,t}setFormat(e){return this.getWritable().__format=e!==""?Yi[e]:0,this}setStyle(e){return this.getWritable().__style=e||"",this}setTextFormat(e){const t=this.getWritable();return t.__textFormat=e,t}setTextStyle(e){const t=this.getWritable();return t.__textStyle=e,t}setIndent(e){return this.getWritable().__indent=e,this}splice(e,t,r){Qn(this)&&k(324,this.__key,this.__type);const i=this.getChildrenSize(),s=this.getWritable();e+t<=i||k(226,String(e),String(t),String(i));const o=s.__key,l=[],a=[],c=this.getChildAtIndex(e+t);let u=null,f=i-t+r.length;if(e!==0)if(e===i)u=this.getLastChild();else{const p=this.getChildAtIndex(e);p!==null&&(u=p.getPreviousSibling())}if(t>0){let p=u===null?this.getFirstChild():u.getNextSibling();for(let h=0;h<t;h++){p===null&&k(100);const m=p.getNextSibling(),g=p.__key;ut(p.getWritable()),a.push(g),p=m}}let d=u;for(const p of r){d!==null&&p.is(d)&&(u=d=d.getPreviousSibling());const h=p.getWritable();h.__parent===o&&f--,ut(h);const m=p.__key;if(d===null)s.__first=m,h.__prev=null;else{const g=d.getWritable();g.__next=m,h.__prev=g.__key}p.__key===o&&k(76),h.__parent=o,l.push(m),d=p}if(e+t===i)d!==null&&(d.getWritable().__next=null,s.__last=d.__key);else if(c!==null){const p=c.getWritable();if(d!==null){const h=d.getWritable();p.__prev=d.__key,h.__next=c.__key}else p.__prev=null}if(s.__size=f,a.length){const p=L();if(O(p)){const h=new Set(a),m=new Set(l),{anchor:g,focus:_}=p;ks(g,h,m)&&tr(g,g.getNode(),this,u,c),ks(_,h,m)&&tr(_,_.getNode(),this,u,c),f!==0||this.canBeEmpty()||Re(this)||this.remove()}}return s}getDOMSlot(e){return new sn(e)}exportDOM(e){const{element:t}=super.exportDOM(e);if(ye(t)){const r=this.getIndent();r>0&&(t.style.paddingInlineStart=40*r+"px");const i=this.getDirection();i&&(t.dir=i)}return{element:t}}exportJSON(){const e={children:[],direction:this.getDirection(),format:this.getFormatType(),indent:this.getIndent(),...super.exportJSON()},t=this.getTextFormat(),r=this.getTextStyle();return t===0&&r===""||Re(this)||this.getChildren().some(A)||(t!==0&&(e.textFormat=t),r!==""&&(e.textStyle=r)),e}updateFromJSON(e){return super.updateFromJSON(e).setFormat(e.format).setIndent(e.indent).setDirection(e.direction).setTextFormat(e.textFormat||0).setTextStyle(e.textStyle||"")}insertNewAfter(e,t){return null}canIndent(){return!0}collapseAtStart(e){return!1}excludeFromCopy(e){return!1}canReplaceWith(e){return!0}canInsertAfter(e){return!0}canBeEmpty(){return!0}canInsertTextBefore(){return!0}canInsertTextAfter(){return!0}isInline(){return!1}isShadowRoot(){return!1}canMergeWith(e){return!1}extractWithChild(e,t,r){return!1}canMergeWhenEmpty(){return!1}reconcileObservedMutation(e,t){const r=this.getDOMSlot(e);let i=r.getFirstChild();for(let s=this.getFirstChild();s;s=s.getNextSibling()){const o=t.getElementByKey(s.getKey());o!==null&&(i==null?(r.insertChild(o),i=o):i!==o&&r.replaceChild(o,i),i=i.nextSibling)}}}function E(n){return n instanceof _n}function ks(n,e,t){let r=n.getNode();for(;r;){const i=r.__key;if(e.has(i)&&!t.has(i))return!0;r=r.getParent()}return!1}class cl extends De{decorate(e,t){return null}isIsolated(){return!1}isInline(){return!0}isKeyboardSelectable(){return!0}}function V(n){return n instanceof cl}class Vt extends _n{__cachedText;static getType(){return"root"}static clone(){return new Vt}constructor(){super("root"),this.__cachedText=null}getTopLevelElementOrThrow(){k(51)}getTextContent(){const e=this.__cachedText;return!yn()&&Y()._dirtyType!==0||e===null?super.getTextContent():e}remove(){k(52)}replace(e){k(53)}insertBefore(e){k(54)}insertAfter(e){k(55)}updateDOM(e,t){return!1}splice(e,t,r){for(const i of r)E(i)||V(i)||k(282);return super.splice(e,t,r)}static importJSON(e){return X().updateFromJSON(e)}collapseAtStart(){return!0}}function ee(n){return n instanceof Vt}function ul(n){return new xn(new Map(n._nodeMap))}function xi(){return new xn(new Map([["root",new Vt]]))}function dl(n){const e=n.exportJSON(),t=n.constructor;if(e.type!==t.getType()&&k(130,t.name),E(n)){const r=e.children;Array.isArray(r)||k(59,t.name);const i=n.getChildren();for(let s=0;s<i.length;s++){const o=dl(i[s]);r.push(o)}}return e}function bc(n){return n instanceof xn}class xn{_nodeMap;_selection;_flushSync;_readOnly;constructor(e,t){this._nodeMap=e,this._selection=t||null,this._flushSync=!1,this._readOnly=!1}isEmpty(){return this._nodeMap.size===1&&this._selection===null}read(e,t){return Es(t&&t.editor||null,this,e)}clone(e){const t=new xn(this._nodeMap,e===void 0?this._selection:e);return t._readOnly=!0,t}toJSON(){return Es(null,this,()=>({root:dl(X())}))}}class vi extends _n{static getType(){return"artificial"}createDOM(e){return document.createElement("div")}}class Ht extends _n{static getType(){return"paragraph"}static clone(e){return new Ht(e.__key)}createDOM(e){const t=document.createElement("p"),r=It(e.theme,"paragraph");return r!==void 0&&t.classList.add(...r),t}updateDOM(e,t,r){return!1}static importDOM(){return{p:e=>({conversion:Nc,priority:0})}}exportDOM(e){const{element:t}=super.exportDOM(e);if(ye(t)){this.isEmpty()&&t.append(document.createElement("br"));const r=this.getFormatType();r&&(t.style.textAlign=r)}return{element:t}}static importJSON(e){return Se().updateFromJSON(e)}exportJSON(){const e=super.exportJSON();if(e.textFormat===void 0||e.textStyle===void 0){const t=this.getChildren().find(A);t?(e.textFormat=t.getFormat(),e.textStyle=t.getStyle()):(e.textFormat=this.getTextFormat(),e.textStyle=this.getTextStyle())}return e}insertNewAfter(e,t){const r=Se();r.setTextFormat(e.format),r.setTextStyle(e.style);const i=this.getDirection();return r.setDirection(i),r.setFormat(this.getFormatType()),r.setStyle(this.getStyle()),this.insertAfter(r,t),r}collapseAtStart(){const e=this.getChildren();if(e.length===0||A(e[0])&&e[0].getTextContent().trim()===""){if(this.getNextSibling()!==null)return this.selectNext(),this.remove(),!0;if(this.getPreviousSibling()!==null)return this.selectPrevious(),this.remove(),!0}return!1}}function Nc(n){const e=Se();return n.style&&(e.setFormat(n.style.textAlign),jc(n,e)),{node:e}}function Se(){return gr(new Ht)}function fl(n){return n instanceof Ht}const j=0,Ec=4;function hl(n,e,t,r){const i=n._keyToDOMMap;i.clear(),n._editorState=xi(),n._pendingEditorState=r,n._compositionKey=null,n._dirtyType=0,n._cloneNotNeeded.clear(),n._dirtyLeaves=new Set,n._dirtyElements.clear(),n._normalizedNodes=new Set,n._updateTags=new Set,n._updates=[],n._blockCursorElement=null;const s=n._observer;s!==null&&(s.disconnect(),n._observer=null),e!==null&&(e.textContent=""),t!==null&&(t.textContent="",i.set("root",t))}function wc(n){const e=new Set,t=new Set;let r=n;for(;r;){const{ownNodeConfig:i}=pr(r),s=r.transform;if(!t.has(s)){t.add(s);const o=r.transform();o&&e.add(o)}if(i){const o=i.$transform;o&&e.add(o),r=i.extends}else{const o=Object.getPrototypeOf(r);r=o.prototype instanceof De&&o!==De?o:void 0}}return e}function gl(n){const e=n||{},t=Sc(),r=e.theme||{},i=n===void 0?t:e.parentEditor||null,s=e.disableEvents||!1,o=xi(),l=e.namespace||(i!==null?i._config.namespace:bl()),a=e.editorState,c=[Vt,Ct,Wt,Ut,Ht,vi,...e.nodes||[]],{onError:u,html:f}=e,d=e.editable===void 0||e.editable;let p;if(n===void 0&&t!==null)p=t._nodes;else{p=new Map;for(let m=0;m<c.length;m++){let g=c[m],_=null,y=null;if(typeof g!="function"){const w=g;g=w.replace,_=w.with,y=w.withKlass||null}pr(g);const x=g.getType(),C=wc(g);p.set(x,{exportDOM:f&&f.export?f.export.get(g):void 0,klass:g,replace:_,replaceWithKlass:y,sharedNodeState:Ia(c[m]),transforms:C})}}const h=new Ft(o,i,p,{disableEvents:s,namespace:l,theme:r},u||console.error,(function(m,g){const _=new Map,y=new Set,x=C=>{Object.keys(C).forEach(w=>{let v=_.get(w);v===void 0&&(v=[],_.set(w,v)),v.push(C[w])})};return m.forEach(C=>{const w=C.klass.importDOM;if(w==null||y.has(w))return;y.add(w);const v=w.call(C.klass);v!==null&&x(v)}),g&&x(g),_})(p,f?f.import:void 0),d,n);return a!==void 0&&(h._pendingEditorState=a,h._dirtyType=2),(function(m){m.registerCommand(Eo,Za,j),m.registerCommand(wo,Qa,j),m.registerCommand(To,ec,j),m.registerCommand(ko,tc,j),m.registerCommand(Mo,nc,j)})(h),h}class Ft{static version;_headless;_parentEditor;_rootElement;_editorState;_pendingEditorState;_compositionKey;_deferred;_keyToDOMMap;_updates;_updating;_listeners;_commands;_nodes;_decorators;_pendingDecorators;_config;_dirtyType;_cloneNotNeeded;_dirtyLeaves;_dirtyElements;_normalizedNodes;_updateTags;_observer;_key;_onError;_htmlConversions;_window;_editable;_blockCursorElement;_createEditorArgs;constructor(e,t,r,i,s,o,l,a){this._createEditorArgs=a,this._parentEditor=t,this._rootElement=null,this._editorState=e,this._pendingEditorState=null,this._compositionKey=null,this._deferred=[],this._keyToDOMMap=new Map,this._updates=[],this._updating=!1,this._listeners={decorator:new Set,editable:new Set,mutation:new Map,root:new Set,textcontent:new Set,update:new Set},this._commands=new Map,this._config=i,this._nodes=r,this._decorators={},this._pendingDecorators=null,this._dirtyType=0,this._cloneNotNeeded=new Set,this._dirtyLeaves=new Set,this._dirtyElements=new Map,this._normalizedNodes=new Set,this._updateTags=new Set,this._observer=null,this._key=bl(),this._onError=s,this._htmlConversions=o,this._editable=l,this._headless=t!==null&&t._headless,this._window=null,this._blockCursorElement=null}isComposing(){return this._compositionKey!=null}registerUpdateListener(e){const t=this._listeners.update;return t.add(e),()=>{t.delete(e)}}registerEditableListener(e){const t=this._listeners.editable;return t.add(e),()=>{t.delete(e)}}registerDecoratorListener(e){const t=this._listeners.decorator;return t.add(e),()=>{t.delete(e)}}registerTextContentListener(e){const t=this._listeners.textcontent;return t.add(e),()=>{t.delete(e)}}registerRootListener(e){const t=this._listeners.root;return e(this._rootElement,null),t.add(e),()=>{e(null,this._rootElement),t.delete(e)}}registerCommand(e,t,r){r===void 0&&k(35);const i=this._commands;i.has(e)||i.set(e,[new Set,new Set,new Set,new Set,new Set]);const s=i.get(e);s===void 0&&k(36,String(e));const o=s[r];return o.add(t),()=>{o.delete(t),s.every(l=>l.size===0)&&i.delete(e)}}registerMutationListener(e,t,r){const i=this.resolveRegisteredNodeAfterReplacements(this.getRegisteredNode(e)).klass,s=this._listeners.mutation;let o=s.get(t);o===void 0&&(o=new Set,s.set(t,o)),o.add(i);const l=r&&r.skipInitialization;return l!==void 0&&l||this.initializeMutationListener(t,i),()=>{o.delete(i),o.size===0&&s.delete(t)}}getRegisteredNode(e){const t=this._nodes.get(e.getType());return t===void 0&&k(37,e.name),t}resolveRegisteredNodeAfterReplacements(e){for(;e.replaceWithKlass;)e=this.getRegisteredNode(e.replaceWithKlass);return e}initializeMutationListener(e,t){const r=this._editorState,i=Rs(r).get(t.getType());if(!i)return;const s=new Map;for(const o of i.keys())s.set(o,"created");s.size>0&&e(s,{dirtyLeaves:new Set,prevEditorState:r,updateTags:new Set(["registerMutationListener"])})}registerNodeTransformToKlass(e,t){const r=this.getRegisteredNode(e);return r.transforms.add(t),r}registerNodeTransform(e,t){const r=this.registerNodeTransformToKlass(e,t),i=[r],s=r.replaceWithKlass;if(s!=null){const o=this.registerNodeTransformToKlass(s,t);i.push(o)}return(function(o,l){const a=Rs(o.getEditorState()),c=[];for(const u of l){const f=a.get(u);f&&c.push(f)}c.length!==0&&o.update(()=>{for(const u of c)for(const f of u.keys()){const d=le(f);d&&d.markDirty()}},o._pendingEditorState===null?{tag:at}:void 0)})(this,i.map(o=>o.klass.getType())),()=>{i.forEach(o=>o.transforms.delete(t))}}hasNode(e){return this._nodes.has(e.getType())}hasNodes(e){return e.every(this.hasNode.bind(this))}dispatchCommand(e,t){return D(this,e,t)}getDecorators(){return this._decorators}getRootElement(){return this._rootElement}getKey(){return this._key}setRootElement(e){const t=this._rootElement;if(e!==t){const r=It(this._config.theme,"root"),i=this._pendingEditorState||this._editorState;if(this._rootElement=e,hl(this,t,e,i),t!==null&&(this._config.disableEvents||rc(t),r!=null&&t.classList.remove(...r)),e!==null){const s=Mi(e),o=e.style;o.userSelect="text",o.whiteSpace="pre-wrap",o.wordBreak="break-word",e.setAttribute("data-lexical-editor","true"),this._window=s,this._dirtyType=2,yo(this),this._updateTags.add(at),Be(this),this._config.disableEvents||(function(l,a){const c=l.ownerDocument;Hr.set(l,c);const u=Xn.get(c)??0;u<1&&c.addEventListener("selectionchange",Go),Xn.set(c,u+1),l.__lexicalEditor=a;const f=Yo(l);for(let d=0;d<Vr.length;d++){const[p,h]=Vr[d],m=typeof h=="function"?g=>{cs(g)||(as(g),(a.isEditable()||p==="click")&&h(g,a))}:g=>{if(cs(g))return;as(g);const _=a.isEditable();switch(p){case"cut":return _&&D(a,pi,g);case"copy":return D(a,ar,g);case"paste":return _&&D(a,fi,g);case"dragstart":return _&&D(a,Ko,g);case"dragover":return _&&D(a,zo,g);case"dragend":return _&&D(a,Va,g);case"focus":return _&&D(a,Ga,g);case"blur":return _&&D(a,qa,g);case"drop":return _&&D(a,jo,g)}};l.addEventListener(p,m),f.push(()=>{l.removeEventListener(p,m)})}})(e,this),r!=null&&e.classList.add(...r)}else this._window=null,this._updateTags.add(at),Be(this);rn("root",this,!1,e,t)}}getElementByKey(e){return this._keyToDOMMap.get(e)||null}getEditorState(){return this._editorState}setEditorState(e,t){e.isEmpty()&&k(38);let r=e;r._readOnly&&(r=ul(e),r._selection=e._selection?e._selection.clone():null),mo(this);const i=this._pendingEditorState,s=this._updateTags,o=t!==void 0?t.tag:null;i===null||i.isEmpty()||(o!=null&&s.add(o),Be(this)),this._pendingEditorState=r,this._dirtyType=2,this._dirtyElements.set("root",!1),this._compositionKey=null,o!=null&&s.add(o),this._updating||Be(this)}parseEditorState(e,t){return(function(r,i,s){const o=xi(),l=se,a=pe,c=oe,u=i._dirtyElements,f=i._dirtyLeaves,d=i._cloneNotNeeded,p=i._dirtyType;i._dirtyElements=new Map,i._dirtyLeaves=new Set,i._cloneNotNeeded=new Set,i._dirtyType=0,se=o,pe=!1,oe=i,Si(null);try{const h=i._nodes;_i(r.root,h),s&&s(),o._readOnly=!0}catch(h){h instanceof Error&&i._onError(h)}finally{i._dirtyElements=u,i._dirtyLeaves=f,i._cloneNotNeeded=d,i._dirtyType=p,se=l,pe=a,oe=c}return o})(typeof e=="string"?JSON.parse(e):e,this,t)}read(e){return Be(this),this.getEditorState().read(e,{editor:this})}update(e,t){(function(r,i,s){r._updating?r._updates.push([i,s]):ur(r,i,s)})(this,e,t)}focus(e,t={}){const r=this._rootElement;r!==null&&(r.setAttribute("autocapitalize","off"),Pe(this,()=>{const i=L(),s=X();i!==null?i.dirty||me(i.clone()):s.getChildrenSize()!==0&&(t.defaultSelection==="rootStart"?s.selectStart():s.selectEnd()),Dc("focus"),Pc(()=>{r.removeAttribute("autocapitalize"),e&&e()})}),this._pendingEditorState===null&&r.removeAttribute("autocapitalize"))}blur(){const e=this._rootElement;e!==null&&e.blur();const t=Te(this._window);t!==null&&t.removeAllRanges()}isEditable(){return this._editable}setEditable(e){this._editable!==e&&(this._editable=e,rn("editable",this,!0,e))}toJSON(){return{editorState:this._editorState.toJSON()}}}Ft.version="0.39.0+prod.esm";let ni=null;function Si(n){ni=n}let Tc=1;function pl(n,e){const t=Ci(n,e);return t===void 0&&k(30,e),t}function Ci(n,e){return n._nodes.get(e)}const kc=typeof queueMicrotask=="function"?queueMicrotask:n=>{Promise.resolve().then(n)};function ml(n){return V(jt(n))}function bi(n){const e=document.activeElement;if(!ye(e))return!1;const t=e.nodeName;return V(jt(n))&&(t==="INPUT"||t==="TEXTAREA"||e.contentEditable==="true"&&dr(e)==null)}function vn(n,e,t){const r=n.getRootElement();try{return r!==null&&r.contains(e)&&r.contains(t)&&e!==null&&!bi(e)&&yl(e)===n}catch{return!1}}function Ni(n){return n instanceof Ft}function yl(n){let e=n;for(;e!=null;){const t=dr(e);if(Ni(t))return t;e=Sn(e)}return null}function dr(n){return n?n.__lexicalEditor:null}function ct(n){return Qo(n)||n.isToken()}function Ke(n){return ct(n)||n.isSegmented()}function Ve(n){return Yt(n)&&n.nodeType===3}function _l(n){return Yt(n)&&n.nodeType===9}function $t(n){let e=n;for(;e!=null;){if(Ve(e))return e;e=e.firstChild}return null}function nr(n,e,t){const r=ht[e];if(t!==null&&(n&r)===(t&r))return n;let i=n^r;return e==="subscript"?i&=-65:e==="superscript"?i&=-33:e==="lowercase"?(i&=-513,i&=-1025):e==="uppercase"?(i&=-257,i&=-1025):e==="capitalize"&&(i&=-257,i&=-513),i}function Mc(n,e){const t=(function(){const o=ni;return ni=null,o})();if((e=e||t&&t.__key)!=null)return void(n.__key=e);ue(),ol();const r=Y(),i=tt(),s=""+Tc++;i._nodeMap.set(s,n),E(n)?r._dirtyElements.set(s,!0):r._dirtyLeaves.add(s),r._cloneNotNeeded.add(s),r._dirtyType=1,n.__key=s}function ut(n){const e=n.getParent();if(e!==null){const t=n.getWritable(),r=e.getWritable(),i=n.getPreviousSibling(),s=n.getNextSibling(),o=s!==null?s.__key:null,l=i!==null?i.__key:null,a=i!==null?i.getWritable():null,c=s!==null?s.getWritable():null;i===null&&(r.__first=o),s===null&&(r.__last=l),a!==null&&(a.__next=o),c!==null&&(c.__prev=l),t.__prev=null,t.__next=null,t.__parent=null,r.__size--}}function rr(n){ol(),Qn(n)&&k(323,n.__key,n.__type);const e=n.getLatest(),t=e.__parent,r=tt(),i=Y(),s=r._nodeMap,o=i._dirtyElements;t!==null&&(function(a,c,u){let f=a;for(;f!==null;){if(u.has(f))return;const d=c.get(f);if(d===void 0)break;u.set(f,!1),f=d.__parent}})(t,s,o);const l=e.__key;i._dirtyType=1,E(n)?o.set(l,!0):i._dirtyLeaves.add(l)}function ae(n){ue();const e=Y(),t=e._compositionKey;if(n!==t){if(e._compositionKey=n,t!==null){const r=le(t);r!==null&&r.getWritable()}if(n!==null){const r=le(n);r!==null&&r.getWritable()}}}function Ge(){return yn()?null:Y()._compositionKey}function le(n,e){const t=(e||tt())._nodeMap.get(n);return t===void 0?null:t}function xl(n,e){const t=fr(n,Y());return t!==void 0?le(t,e):null}function fr(n,e){return n[`__lexicalKey_${e._key}`]}function jt(n,e){let t=n;for(;t!=null;){const r=xl(t,e);if(r!==null)return r;t=Sn(t)}return null}function vl(n){const e=n._decorators,t=Object.assign({},e);return n._pendingDecorators=t,t}function Ms(n){return n.read(()=>X().getTextContent())}function X(){return Sl(tt())}function Sl(n){return n._nodeMap.get("root")}function me(n){ue();const e=tt();n!==null&&(n.dirty=!0,n.setCachedNodes(null)),e._selection=n}function At(n){const e=Y(),t=(function(r,i){let s=r;for(;s!=null;){const o=fr(s,i);if(o!==void 0)return o;s=Sn(s)}return null})(n,e);return t===null?n===e.getRootElement()?le("root"):null:le(t)}function Cl(n){return/[\uD800-\uDBFF][\uDC00-\uDFFF]/g.test(n)}function Ei(n){const e=[];let t=n;for(;t!==null;)e.push(t),t=t._parentEditor;return e}function bl(){return Math.random().toString(36).replace(/[^a-z]+/g,"").substring(0,5)}function Nl(n){return Ve(n)?n.nodeValue:null}function wi(n,e,t){const r=Te(Ce(e));if(r===null)return;const i=r.anchorNode;let{anchorOffset:s,focusOffset:o}=r;if(i!==null){let l=Nl(i);const a=jt(i);if(l!==null&&A(a)){if(l===or&&t){const c=t.length;l=t,s=c,o=c}l!==null&&Ti(a,l,s,o,n)}}}function Ti(n,e,t,r,i){let s=n;if(s.isAttached()&&(i||!s.isDirty())){const o=s.isComposing();let l=e;(o||i)&&e[e.length-1]===or&&(l=e.slice(0,-1));const a=s.getTextContent();if(i||l!==a){if(l===""){if(ae(null),gn||Bt||pn)s.remove();else{const m=Y();setTimeout(()=>{m.update(()=>{s.isAttached()&&s.remove()})},20)}return}const c=s.getParent(),u=Jt(),f=s.getTextContentSize(),d=Ge(),p=s.getKey();if(s.isToken()||d!==null&&p===d&&!o||O(u)&&(c!==null&&!c.canInsertTextBefore()&&u.anchor.offset===0||u.anchor.key===n.__key&&u.anchor.offset===0&&!s.canInsertTextBefore()&&!o||u.focus.key===n.__key&&u.focus.offset===f&&!s.canInsertTextAfter()&&!o))return void s.markDirty();const h=L();if(!O(h)||t===null||r===null)return void Os(s,l,h);if(h.setTextNodeRange(s,t,s,r),s.isSegmented()){const m=ie(s.getTextContent());s.replace(m),s=m}Os(s,l,h)}}}function Os(n,e,t){if(n.setTextContent(e),O(t)){const r=n.getKey();for(const i of["anchor","focus"]){const s=t[i];s.type==="text"&&s.key===r&&(s.offset=Xe(n,s.offset,"clamp"))}}}function kn(n,e,t){const r=e[t]||!1;return r==="any"||r===n[t]}function Oc(n,e){return kn(n,e,"altKey")&&kn(n,e,"ctrlKey")&&kn(n,e,"shiftKey")&&kn(n,e,"metaKey")}function H(n,e,t){return Oc(n,t)&&n.key.toLowerCase()===e.toLowerCase()}const je={ctrlKey:!Ne,metaKey:Ne},As={altKey:Ne,ctrlKey:!Ne};function Ds(n){return n.key==="Backspace"}function Ps(n){return H(n,"a",je)}function Ac(n){const e=X();if(O(n)){const t=n.anchor,r=n.focus,i=t.getNode().getTopLevelElementOrThrow().getParentOrThrow();return t.set(i.getKey(),0,"element"),r.set(i.getKey(),i.getChildrenSize(),"element"),Un(n),n}{const t=e.select(0,e.getChildrenSize());return me(Un(t)),t}}function It(n,e){n.__lexicalClassNameCache===void 0&&(n.__lexicalClassNameCache={});const t=n.__lexicalClassNameCache,r=t[e];if(r!==void 0)return r;const i=n[e];if(typeof i=="string"){const s=fo(i);return t[e]=s,s}return i}function ki(n,e,t,r,i){if(t.size===0)return;const s=r.__type,o=r.__key,l=e.get(s);l===void 0&&k(33,s);const a=l.klass;let c=n.get(a);c===void 0&&(c=new Map,n.set(a,c));const u=c.get(o),f=u==="destroyed"&&i==="created";(u===void 0||f)&&c.set(o,f?"updated":i)}function Ls(n,e,t){const r=n.getParent();let i=t,s=n;return r!==null&&(e&&t===0?(i=s.getIndexWithinParent(),s=r):e||t!==s.getChildrenSize()||(i=s.getIndexWithinParent()+1,s=r)),s.getChildAtIndex(e?i-1:i)}function ri(n,e){const t=n.offset;if(n.type==="element")return Ls(n.getNode(),e,t);{const r=n.getNode();if(e&&t===0||!e&&t===r.getTextContentSize()){const i=e?r.getPreviousSibling():r.getNextSibling();return i===null?Ls(r.getParentOrThrow(),e,r.getIndexWithinParent()+(e?0:1)):i}}return null}function El(n){const e=Ce(n).event,t=e&&e.inputType;return t==="insertFromPaste"||t==="insertFromPasteAsQuotation"}function D(n,e,t){return(function(r,i,s){const o=Ei(r);for(let l=4;l>=0;l--)for(let a=0;a<o.length;a++){const c=o[a],u=c._commands.get(i);if(u!==void 0){const f=u[l];if(f!==void 0){const d=Array.from(f),p=d.length;let h=!1;if(Pe(c,()=>{for(let m=0;m<p;m++)if(d[m](s,r))return void(h=!0)}),h)return h}}}return!1})(n,e,t)}function hr(n){return!ee(n)&&!n.isLastChild()&&!n.isInline()}function yt(n,e){const t=n._keyToDOMMap.get(e);return t===void 0&&k(75,e),t}function Sn(n){const e=n.assignedSlot||n.parentElement;return oi(e)?e.host:e}function wl(n){return _l(n)?n:ye(n)?n.ownerDocument:null}function Dc(n){ue(),Y()._updateTags.add(n)}function Pc(n){ue(),Y()._deferred.push(n)}function ii(n,e){let t=n.getParent();for(;t!==null;){if(t.is(e))return!0;t=t.getParent()}return!1}function Mi(n){const e=wl(n);return e?e.defaultView:null}function Ce(n){const e=n._window;return e===null&&k(78),e}function Lc(n){let e=n.getParentOrThrow();for(;e!==null;){if(Re(e))return e;e=e.getParentOrThrow()}return e}function Re(n){return ee(n)||E(n)&&n.isShadowRoot()}function gr(n){const e=Y(),t=n.getType(),r=Ci(e,t);r===void 0&&k(200,n.constructor.name,t);const{replace:i,replaceWithKlass:s}=r;if(i!==null){const o=i(n),l=o.constructor;return s!==null?o instanceof s||k(201,s.name,s.getType(),l.name,l.getType(),n.constructor.name,t):o instanceof n.constructor&&l!==n.constructor||k(202,l.name,l.getType(),n.constructor.name,t),o.__key===n.__key&&k(203,n.constructor.name,t,l.name,l.getType()),o}return n}function Nr(n,e){!ee(n.getParent())||E(e)||V(e)||k(99)}function Ic(n){const e=le(n);return e===null&&k(63,n),e}function Er(n){return(V(n)||E(n)&&!n.canBeEmpty())&&!n.isInline()}function si(n,e,t){t.style.removeProperty("caret-color"),e._blockCursorElement=null;const r=n.parentElement;r!==null&&r.removeChild(n)}function Te(n){return we?(n||window).getSelection():null}function Rc(n){const e=Mi(n);return e?e.getSelection():null}function ye(n){return Yt(n)&&n.nodeType===1}function Yt(n){return typeof n=="object"&&n!==null&&"nodeType"in n&&typeof n.nodeType=="number"}function oi(n){return Yt(n)&&n.nodeType===11}function li(n){const e=new RegExp(/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|mark|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var|#text)$/,"i");return n.nodeName.match(e)!==null}function ir(n){const e=new RegExp(/^(address|article|aside|blockquote|canvas|dd|div|dl|dt|fieldset|figcaption|figure|footer|form|h1|h2|h3|h4|h5|h6|header|hr|li|main|nav|noscript|ol|p|pre|section|table|td|tfoot|ul|video)$/,"i");return n.nodeName.match(e)!==null}function He(n){if(V(n)&&!n.isInline())return!0;if(!E(n)||Re(n))return!1;const e=n.getFirstChild(),t=e===null||nn(e)||A(e)||e.isInline();return!n.isInline()&&n.canBeEmpty()!==!1&&t}function Oi(){return Y()}const Is=new WeakMap,Fc=new Map;function Rs(n){if(!n._readOnly&&n.isEmpty())return Fc;n._readOnly||k(192);let e=Is.get(n);return e||(e=(function(t){const r=new Map;for(const[i,s]of t._nodeMap){const o=s.__type;let l=r.get(o);l||(l=new Map,r.set(o,l)),l.set(i,s)}return r})(n),Is.set(n,e)),e}function Tl(n){const e=n.constructor.clone(n);return e.afterCloneFrom(n),e}function $c(n){return(e=Tl(n))[qo]=!0,e;var e}function jc(n,e){const t=parseInt(n.style.paddingInlineStart,10)||0,r=Math.round(t/40);e.setIndent(r)}function Kc(n){return n.__lexicalUnmanaged===!0}function qt(n,e){return(function(t,r){return Object.prototype.hasOwnProperty.call(t,r)})(n,e)&&n[e]!==De[e]}function pr(n){const e=Gi in n.prototype?n.prototype[Gi]():void 0,t=(function(o){if(!(o===De||o.prototype instanceof De)){let l="<unknown>",a="<unknown>";try{l=o.getType()}catch{}try{Ft.version&&(a=JSON.parse(Ft.version))}catch{}k(290,o.name,l,a)}return o===cl||o===_n||o===De})(n),r=!t&&qt(n,"getType")?n.getType():void 0;let i,s=r;if(e)if(r)i=e[r];else for(const[o,l]of Object.entries(e))s=o,i=l;if(!t&&s&&(qt(n,"getType")||(n.getType=()=>s),qt(n,"clone")||(n.clone=o=>(Si(o),new n)),qt(n,"importJSON")||(n.importJSON=i&&i.$importJSON||(o=>new n().updateFromJSON(o))),!qt(n,"importDOM")&&i)){const{importDOM:o}=i;o&&(n.importDOM=()=>o)}return{ownNodeConfig:i,ownNodeType:s}}const dt=(n,e)=>{let t=n;for(;t!=null&&!ee(t);){if(e(t))return t;t=t.getParent()}return null},zc={next:"previous",previous:"next"};class Ai{origin;constructor(e){this.origin=e}[Symbol.iterator](){return kl({hasNext:Kt,initial:this.getAdjacentCaret(),map:e=>e,step:e=>e.getAdjacentCaret()})}getAdjacentCaret(){return fe(this.getNodeAtCaret(),this.direction)}getSiblingCaret(){return fe(this.origin,this.direction)}remove(){const e=this.getNodeAtCaret();return e&&e.remove(),this}replaceOrInsert(e,t){const r=this.getNodeAtCaret();return e.is(this.origin)||e.is(r)||(r===null?this.insert(e):r.replace(e,t)),this}splice(e,t,r="next"){const i=r===this.direction?t:Array.from(t).reverse();let s=this;const o=this.getParentAtCaret(),l=new Map;for(let a=s.getAdjacentCaret();a!==null&&l.size<e;a=a.getAdjacentCaret()){const c=a.origin.getWritable();l.set(c.getKey(),c)}for(const a of i){if(l.size>0){const c=s.getNodeAtCaret();if(c){if(l.delete(c.getKey()),l.delete(a.getKey()),!(c.is(a)||s.origin.is(a))){const u=a.getParent();u&&u.is(o)&&a.remove(),c.replace(a)}}else c===null&&k(263,Array.from(l).join(" "))}else s.insert(a);s=fe(a,this.direction)}for(const a of l.values())a.remove();return this}}class fn extends Ai{type="child";getLatest(){const e=this.origin.getLatest();return e===this.origin?this:We(e,this.direction)}getParentCaret(e="root"){return fe(Di(this.getParentAtCaret(),e),this.direction)}getFlipped(){const e=Gt(this.direction);return fe(this.getNodeAtCaret(),e)||We(this.origin,e)}getParentAtCaret(){return this.origin}getChildCaret(){return this}isSameNodeCaret(e){return e instanceof fn&&this.direction===e.direction&&this.origin.is(e.origin)}isSamePointCaret(e){return this.isSameNodeCaret(e)}}const Bc={root:ee,shadowRoot:Re};function Gt(n){return zc[n]}function Di(n,e="root"){return Bc[e](n)?null:n}class _t extends Ai{type="sibling";getLatest(){const e=this.origin.getLatest();return e===this.origin?this:fe(e,this.direction)}getSiblingCaret(){return this}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return E(this.origin)?We(this.origin,this.direction):null}getParentCaret(e="root"){return fe(Di(this.getParentAtCaret(),e),this.direction)}getFlipped(){const e=Gt(this.direction);return fe(this.getNodeAtCaret(),e)||We(this.origin.getParentOrThrow(),e)}isSamePointCaret(e){return e instanceof _t&&this.direction===e.direction&&this.origin.is(e.origin)}isSameNodeCaret(e){return(e instanceof _t||e instanceof xt)&&this.direction===e.direction&&this.origin.is(e.origin)}}class xt extends Ai{type="text";offset;constructor(e,t){super(e),this.offset=t}getLatest(){const e=this.origin.getLatest();return e===this.origin?this:vt(e,this.direction,this.offset)}getParentAtCaret(){return this.origin.getParent()}getChildCaret(){return null}getParentCaret(e="root"){return fe(Di(this.getParentAtCaret(),e),this.direction)}getFlipped(){return vt(this.origin,Gt(this.direction),this.offset)}isSamePointCaret(e){return e instanceof xt&&this.direction===e.direction&&this.origin.is(e.origin)&&this.offset===e.offset}isSameNodeCaret(e){return(e instanceof _t||e instanceof xt)&&this.direction===e.direction&&this.origin.is(e.origin)}getSiblingCaret(){return fe(this.origin,this.direction)}}function qe(n){return n instanceof xt}function Kt(n){return n instanceof _t}function Le(n){return n instanceof fn}const Wc={next:class extends xt{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(n){return this.origin.insertAfter(n),this}},previous:class extends xt{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(n){return this.origin.insertBefore(n),this}}},Uc={next:class extends _t{direction="next";getNodeAtCaret(){return this.origin.getNextSibling()}insert(n){return this.origin.insertAfter(n),this}},previous:class extends _t{direction="previous";getNodeAtCaret(){return this.origin.getPreviousSibling()}insert(n){return this.origin.insertBefore(n),this}}},Jc={next:class extends fn{direction="next";getNodeAtCaret(){return this.origin.getFirstChild()}insert(n){return this.origin.splice(0,0,[n]),this}},previous:class extends fn{direction="previous";getNodeAtCaret(){return this.origin.getLastChild()}insert(n){return this.origin.splice(this.origin.getChildrenSize(),0,[n]),this}}};function fe(n,e){return n?new Uc[e](n):null}function vt(n,e,t){return n?new Wc[e](n,Xe(n,t)):null}function Xe(n,e,t="error"){const r=n.getTextContentSize();let i=e==="next"?r:e==="previous"?0:e;return(i<0||i>r)&&(t!=="clamp"&&co(284,String(e),String(r),n.getKey()),i=i<0?0:r),i}function Fs(n,e){return new Hc(n,e)}function We(n,e){return E(n)?new Jc[e](n):null}function Vc(n){return n&&n.getChildCaret()||n}function Pi(n){return n&&Vc(n.getAdjacentCaret())}class Li{type="node-caret-range";direction;anchor;focus;constructor(e,t,r){this.anchor=e,this.focus=t,this.direction=r}getLatest(){const e=this.anchor.getLatest(),t=this.focus.getLatest();return e===this.anchor&&t===this.focus?this:new Li(e,t,this.direction)}isCollapsed(){return this.anchor.isSamePointCaret(this.focus)}getTextSlices(){const e=i=>{const s=this[i].getLatest();return qe(s)?(function(o,l){const{direction:a,origin:c}=o,u=Xe(c,l==="focus"?Gt(a):a);return Fs(o,u-o.offset)})(s,i):null},t=e("anchor"),r=e("focus");if(t&&r){const{caret:i}=t,{caret:s}=r;if(i.isSameNodeCaret(s))return[Fs(i,s.offset-i.offset),null]}return[t,r]}iterNodeCarets(e="root"){const t=qe(this.anchor)?this.anchor.getSiblingCaret():this.anchor.getLatest(),r=this.focus.getLatest(),i=qe(r),s=o=>o.isSameNodeCaret(r)?null:Pi(o)||o.getParentCaret(e);return kl({hasNext:o=>o!==null&&!(i&&r.isSameNodeCaret(o)),initial:t.isSameNodeCaret(r)?null:s(t),map:o=>o,step:s})}[Symbol.iterator](){return this.iterNodeCarets("root")}}class Hc{type="slice";caret;distance;constructor(e,t){this.caret=e,this.distance=t}getSliceIndices(){const{distance:e,caret:{offset:t}}=this,r=t+e;return r<t?[r,t]:[t,r]}getTextContent(){const[e,t]=this.getSliceIndices();return this.caret.origin.getTextContent().slice(e,t)}getTextContentSize(){return Math.abs(this.distance)}removeTextSlice(){const{caret:{origin:e,direction:t}}=this,[r,i]=this.getSliceIndices(),s=e.getTextContent();return vt(e.setTextContent(s.slice(0,r)+s.slice(i)),t,r)}}function Ii(n){return et(n,fe(X(),n.direction))}function Yc(n){return et(n,n)}function et(n,e){return n.direction!==e.direction&&k(265),new Li(n,e,n.direction)}function kl(n){const{initial:e,hasNext:t,step:r,map:i}=n;let s=e;return{[Symbol.iterator](){return this},next(){if(!t(s))return{done:!0,value:void 0};const o={done:!1,value:i(s)};return s=r(s),o}}}function Ml(n,e){const t=$n(n.origin,e.origin);switch(t===null&&k(275,n.origin.getKey(),e.origin.getKey()),t.type){case"same":{const r=n.type==="text",i=e.type==="text";return r&&i?(function(s,o){return Math.sign(s-o)})(n.offset,e.offset):n.type===e.type?0:r?-1:i?1:n.type==="child"?-1:1}case"ancestor":return n.type==="child"?-1:1;case"descendant":return e.type==="child"?1:-1;case"branch":return Ol(t)}}function Ol(n){const{a:e,b:t}=n,r=e.__key,i=t.__key;let s=e,o=t;for(;s&&o;s=s.getNextSibling(),o=o.getNextSibling()){if(s.__key===i)return-1;if(o.__key===r)return 1}return s===null?1:-1}function Mn(n,e){return e.is(n)}function $s(n){return E(n)?[n.getLatest(),null]:[n.getParent(),n.getLatest()]}function $n(n,e){if(n.is(e))return{commonAncestor:n,type:"same"};const t=new Map;for(let[r,i]=$s(n);r;i=r,r=r.getParent())t.set(r,i);for(let[r,i]=$s(e);r;i=r,r=r.getParent()){const s=t.get(r);if(s!==void 0)return s===null?(Mn(n,r)||k(276),{commonAncestor:r,type:"ancestor"}):i===null?(Mn(e,r)||k(277),{commonAncestor:r,type:"descendant"}):((E(s)||Mn(n,s))&&(E(i)||Mn(e,i))&&r.is(s.getParent())&&r.is(i.getParent())||k(278),{a:s,b:i,commonAncestor:r,type:"branch"})}return null}function Ue(n,e){const{type:t,key:r,offset:i}=n,s=Ic(n.key);return t==="text"?(A(s)||k(266,s.getType(),r),vt(s,e,i)):(E(s)||k(267,s.getType(),r),Xc(s,n.offset,e))}function hn(n,e){const{origin:t,direction:r}=e,i=r==="next";qe(e)?n.set(t.getKey(),e.offset,"text"):Kt(e)?A(t)?n.set(t.getKey(),Xe(t,r),"text"):n.set(t.getParentOrThrow().getKey(),t.getIndexWithinParent()+(i?1:0),"element"):(Le(e)&&E(t)||k(268),n.set(t.getKey(),i?0:t.getChildrenSize(),"element"))}function Gc(n){const e=L(),t=O(e)?e:rl();return jn(t,n),me(t),t}function jn(n,e){hn(n.anchor,e.anchor),hn(n.focus,e.focus)}function js(n){const{anchor:e,focus:t}=n,r=Ue(e,"next"),i=Ue(t,"next"),s=Ml(r,i)<=0?"next":"previous";return et(zt(r,s),zt(i,s))}function Ri(n){const{direction:e,origin:t}=n,r=fe(t,Gt(e)).getNodeAtCaret();return r?fe(r,e):We(t.getParentOrThrow(),e)}function Ks(n,e="root"){const t=[n];for(let r=Le(n)?n.getParentCaret(e):n.getSiblingCaret();r!==null;r=r.getParentCaret(e))t.push(Ri(r));return t}function wr(n){return!!n&&n.origin.isAttached()}function qc(n,e="removeEmptySlices"){if(n.isCollapsed())return n;const t="root",r="next";let i=e;const s=Dl(n,r),o=Ks(s.anchor,t),l=Ks(s.focus.getFlipped(),t),a=new Set,c=[];for(const h of s.iterNodeCarets(t))if(Le(h))a.add(h.origin.getKey());else if(Kt(h)){const{origin:m}=h;E(m)&&!a.has(m.getKey())||c.push(m)}for(const h of c)h.remove();for(const h of s.getTextSlices()){if(!h)continue;const{origin:m}=h.caret,g=m.getTextContentSize(),_=Ri(fe(m,r)),y=m.getMode();if(Math.abs(h.distance)===g&&i==="removeEmptySlices"||y==="token"&&h.distance!==0)_.remove();else if(h.distance!==0){i="removeEmptySlices";let x=h.removeTextSlice();const C=h.caret.origin;if(y==="segmented"){const w=x.origin,v=ie(w.getTextContent()).setStyle(w.getStyle()).setFormat(w.getFormat());_.replaceOrInsert(v),x=vt(v,r,x.offset)}C.is(o[0].origin)&&(o[0]=x),C.is(l[0].origin)&&(l[0]=x.getFlipped())}}let u,f;for(const h of o)if(wr(h)){u=Ae(h);break}for(const h of l)if(wr(h)){f=Ae(h);break}const d=(function(h,m,g){if(!h||!m)return null;const _=h.getParentAtCaret(),y=m.getParentAtCaret();if(!_||!y)return null;const x=_.getParents().reverse();x.push(_);const C=y.getParents().reverse();C.push(y);const w=Math.min(x.length,C.length);let v;for(v=0;v<w&&x[v]===C[v];v++);const T=(P,R)=>{let z;for(let $=v;$<P.length;$++){const B=P[$];if(Re(B))return;!z&&R(B)&&(z=B)}return z},S=T(x,He),N=S&&T(C,P=>g.has(P.getKey())&&He(P));return S&&N?[S,N]:null})(u,f,a);if(d){const[h,m]=d;We(h,"previous").splice(0,m.getChildren()),m.remove()}const p=[u,f,...o,...l].find(wr);if(p)return Yc(zt(Ae(p),n.direction));k(269,JSON.stringify(o.map(h=>h.origin.__key)))}function Ae(n){const e=(function(i){let s=i;for(;Le(s);){const o=Pi(s);if(!Le(o))break;s=o}return s})(n.getLatest()),{direction:t}=e;if(A(e.origin))return qe(e)?e:vt(e.origin,t,t);const r=e.getAdjacentCaret();return Kt(r)&&A(r.origin)?vt(r.origin,t,Gt(t)):e}function Al(n){return qe(n)&&n.offset!==Xe(n.origin,n.direction)}function zt(n,e){return n.direction===e?n:n.getFlipped()}function Dl(n,e){return n.direction===e?n:et(zt(n.focus,e),zt(n.anchor,e))}function Xc(n,e,t){let r=We(n,"next");for(let i=0;i<e;i++){const s=r.getAdjacentCaret();if(s===null)break;r=s}return zt(r,t)}function Zc(...n){return n}function Qc(n,e){if(!e||n===e)return n;for(const t in e)if(n[t]!==e[t])return{...n,...e};return n}const Pl=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,eu=Pl?M.useLayoutEffect:M.useEffect,On={tag:at};function tu({initialConfig:n,children:e}){const t=M.useMemo(()=>{const{theme:r,namespace:i,nodes:s,onError:o,editorState:l,html:a}=n,c=ga(null,r),u=gl({editable:n.editable,html:a,namespace:i,nodes:s,onError:f=>o(f,u),theme:r});return(function(f,d){if(d!==null){if(d===void 0)f.update(()=>{const p=X();if(p.isEmpty()){const h=Se();p.append(h);const m=Pl?document.activeElement:null;(L()!==null||m!==null&&m===f.getRootElement())&&h.select()}},On);else if(d!==null)switch(typeof d){case"string":{const p=f.parseEditorState(d);f.setEditorState(p,On);break}case"object":f.setEditorState(d,On);break;case"function":f.update(()=>{X().isEmpty()&&d(f)},On)}}})(u,l),[u,c]},[]);return eu(()=>{const r=n.editable,[i]=t;i.setEditable(r===void 0||r)},[]),b.jsx(ao.Provider,{value:t,children:e})}const nu=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?M.useLayoutEffect:M.useEffect;function ru(n){return{initialValueFn:()=>n.isEditable(),subscribe:e=>n.registerEditableListener(e)}}function iu(){return(function(n){const[e]=Je(),t=M.useMemo(()=>n(e),[e,n]),[r,i]=M.useState(()=>t.initialValueFn()),s=M.useRef(r);return nu(()=>{const{initialValueFn:o,subscribe:l}=t,a=o();return s.current!==a&&(s.current=a,i(a)),l(c=>{s.current=c,i(c)})},[t,n]),r})(ru)}const su=new Map;function ou(n){const e={};if(!n)return e;const t=n.split(";");for(const r of t)if(r!==""){const[i,s]=r.split(/:([^]+)/);i&&s&&(e[i.trim()]=s.trim())}return e}function Ll(n){const e=Oi().getElementByKey(n.getKey());if(e===null)return null;const t=e.ownerDocument.defaultView;return t===null?null:t.getComputedStyle(e)}function Il(n){return Ll(ee(n)?n:n.getParentOrThrow())}function zs(n){const e=Il(n);return e!==null&&e.direction==="rtl"}function Rl(n,e,t="self"){const r=n.getStartEndPoints();if(e.isSelected(n)&&!Ke(e)&&r!==null){const[i,s]=r,o=n.isBackward(),l=i.getNode(),a=s.getNode(),c=e.is(l),u=e.is(a);if(c||u){const[f,d]=ei(n),p=l.is(a),h=e.is(o?a:l),m=e.is(o?l:a);let g,_=0;p?(_=f>d?d:f,g=f>d?f:d):h?(_=o?d:f,g=void 0):m&&(_=0,g=o?f:d);const y=e.__text.slice(_,g);y!==e.__text&&(t==="clone"&&(e=$c(e)),e.__text=y)}}return e}function lu(n){const e=n.getStyle(),t=ou(e);su.set(e,t)}function Fl(n){const e=$l(n);return e!==null&&e.writingMode==="vertical-rl"}function $l(n){const e=n.anchor.getNode();return E(e)?Ll(e):Il(e)}function Bs(n,e){let t=Fl(n)?!e:e;jl(n)&&(t=!t);const r=Ue(n.focus,t?"previous":"next");if(Al(r))return!1;for(const i of Ii(r)){if(Le(i))return!i.origin.isInline();if(!E(i.origin)){if(V(i.origin))return!0;break}}return!1}function au(n,e,t,r){n.modify(e?"extend":"move",t,r)}function jl(n){const e=$l(n);return e!==null&&e.direction==="rtl"}function Ws(n,e,t){const r=jl(n);let i;i=Fl(n)||r?!t:t,au(n,e,i,"character")}function cu(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Kl=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,uu=Kl&&"documentMode"in document?document.documentMode:null;!(!Kl||!("InputEvent"in window)||uu)&&"getTargetRanges"in new window.InputEvent("input");function St(...n){return()=>{for(let e=n.length-1;e>=0;e--)n[e]();n.length=0}}function du(n){const e=dt(n,t=>E(t)&&!t.isInline());return E(e)||cu(4,n.__key),e}function ot(n,e){return n!==null&&Object.getPrototypeOf(n).constructor.name===e.name}const fu=Symbol.for("preact-signals");function mr(){if(Ze>1)return void Ze--;let n,e=!1;for(;on!==void 0;){let t=on;for(on=void 0,ai++;t!==void 0;){const r=t.o;if(t.o=void 0,t.f&=-3,!(8&t.f)&&zl(t))try{t.c()}catch(i){e||(n=i,e=!0)}t=r}}if(ai=0,Ze--,e)throw n}function hu(n){if(Ze>0)return n();Ze++;try{return n()}finally{mr()}}let J,on;function Us(n){const e=J;J=void 0;try{return n()}finally{J=e}}let Ze=0,ai=0,Kn=0;function Js(n){if(J===void 0)return;let e=n.n;return e===void 0||e.t!==J?(e={i:0,S:n,p:J.s,n:void 0,t:J,e:void 0,x:void 0,r:e},J.s!==void 0&&(J.s.n=e),J.s=e,n.n=e,32&J.f&&n.S(e),e):e.i===-1?(e.i=0,e.n!==void 0&&(e.n.p=e.p,e.p!==void 0&&(e.p.n=e.n),e.p=J.s,e.n=void 0,J.s.n=e,J.s=e),e):void 0}function ge(n,e){this.v=n,this.i=0,this.n=void 0,this.t=void 0,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}function gu(n,e){return new ge(n,e)}function zl(n){for(let e=n.s;e!==void 0;e=e.n)if(e.S.i!==e.i||!e.S.h()||e.S.i!==e.i)return!0;return!1}function Vs(n){for(let e=n.s;e!==void 0;e=e.n){const t=e.S.n;if(t!==void 0&&(e.r=t),e.S.n=e,e.i=-1,e.n===void 0){n.s=e;break}}}function Bl(n){let e,t=n.s;for(;t!==void 0;){const r=t.p;t.i===-1?(t.S.U(t),r!==void 0&&(r.n=t.n),t.n!==void 0&&(t.n.p=r)):e=t,t.S.n=t.r,t.r!==void 0&&(t.r=void 0),t=r}n.s=e}function Et(n,e){ge.call(this,void 0),this.x=n,this.s=void 0,this.g=Kn-1,this.f=4,this.W=e?.watched,this.Z=e?.unwatched,this.name=e?.name}function Wl(n){const e=n.u;if(n.u=void 0,typeof e=="function"){Ze++;const t=J;J=void 0;try{e()}catch(r){throw n.f&=-2,n.f|=8,Fi(n),r}finally{J=t,mr()}}}function Fi(n){for(let e=n.s;e!==void 0;e=e.n)e.S.U(e);n.x=void 0,n.s=void 0,Wl(n)}function pu(n){if(J!==this)throw new Error("Out-of-order effect");Bl(this),J=n,this.f&=-2,8&this.f&&Fi(this),mr()}function Ot(n,e){this.x=n,this.u=void 0,this.s=void 0,this.o=void 0,this.f=32,this.name=e?.name}function $i(n,e){const t=new Ot(n,e);try{t.c()}catch(i){throw t.d(),i}const r=t.d.bind(t);return r[Symbol.dispose]=r,r}function mu(n,e={}){const t={};for(const r in n){const i=e[r],s=gu(i===void 0?n[r]:i);t[r]=s}return t}ge.prototype.brand=fu,ge.prototype.h=function(){return!0},ge.prototype.S=function(n){const e=this.t;e!==n&&n.e===void 0&&(n.x=e,this.t=n,e!==void 0?e.e=n:Us(()=>{var t;(t=this.W)==null||t.call(this)}))},ge.prototype.U=function(n){if(this.t!==void 0){const e=n.e,t=n.x;e!==void 0&&(e.x=t,n.e=void 0),t!==void 0&&(t.e=e,n.x=void 0),n===this.t&&(this.t=t,t===void 0&&Us(()=>{var r;(r=this.Z)==null||r.call(this)}))}},ge.prototype.subscribe=function(n){return $i(()=>{const e=this.value,t=J;J=void 0;try{n(e)}finally{J=t}},{name:"sub"})},ge.prototype.valueOf=function(){return this.value},ge.prototype.toString=function(){return this.value+""},ge.prototype.toJSON=function(){return this.value},ge.prototype.peek=function(){const n=J;J=void 0;try{return this.value}finally{J=n}},Object.defineProperty(ge.prototype,"value",{get(){const n=Js(this);return n!==void 0&&(n.i=this.i),this.v},set(n){if(n!==this.v){if(ai>100)throw new Error("Cycle detected");this.v=n,this.i++,Kn++,Ze++;try{for(let e=this.t;e!==void 0;e=e.x)e.t.N()}finally{mr()}}}}),Et.prototype=new ge,Et.prototype.h=function(){if(this.f&=-3,1&this.f)return!1;if((36&this.f)==32||(this.f&=-5,this.g===Kn))return!0;if(this.g=Kn,this.f|=1,this.i>0&&!zl(this))return this.f&=-2,!0;const n=J;try{Vs(this),J=this;const e=this.x();(16&this.f||this.v!==e||this.i===0)&&(this.v=e,this.f&=-17,this.i++)}catch(e){this.v=e,this.f|=16,this.i++}return J=n,Bl(this),this.f&=-2,!0},Et.prototype.S=function(n){if(this.t===void 0){this.f|=36;for(let e=this.s;e!==void 0;e=e.n)e.S.S(e)}ge.prototype.S.call(this,n)},Et.prototype.U=function(n){if(this.t!==void 0&&(ge.prototype.U.call(this,n),this.t===void 0)){this.f&=-33;for(let e=this.s;e!==void 0;e=e.n)e.S.U(e)}},Et.prototype.N=function(){if(!(2&this.f)){this.f|=6;for(let n=this.t;n!==void 0;n=n.x)n.t.N()}},Object.defineProperty(Et.prototype,"value",{get(){if(1&this.f)throw new Error("Cycle detected");const n=Js(this);if(this.h(),n!==void 0&&(n.i=this.i),16&this.f)throw this.v;return this.v}}),Ot.prototype.c=function(){const n=this.S();try{if(8&this.f||this.x===void 0)return;const e=this.x();typeof e=="function"&&(this.u=e)}finally{n()}},Ot.prototype.S=function(){if(1&this.f)throw new Error("Cycle detected");this.f|=1,this.f&=-9,Wl(this),Vs(this),Ze++;const n=J;return J=this,pu.bind(this,n)},Ot.prototype.N=function(){2&this.f||(this.f|=2,this.o=on,on=this)},Ot.prototype.d=function(){this.f|=8,1&this.f||Fi(this)},Ot.prototype.dispose=function(){this.d()};function yu(n){return(typeof n.nodes=="function"?n.nodes():n.nodes)||[]}function q(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function Ul(n,e){if(n&&e&&!Array.isArray(e)&&typeof n=="object"&&typeof e=="object"){const t=n,r=e;for(const i in r)t[i]=Ul(t[i],r[i]);return n}return e}const ji=0,ci=1,Jl=2,Tr=3,An=4,wt=5,kr=6,Xt=7;function Mr(n){return n.id===ji}function Vl(n){return n.id===Jl}function _u(n){return(function(e){return e.id===ci})(n)||q(305,String(n.id),String(ci)),Object.assign(n,{id:Jl})}const xu=new Set;class vu{builder;configs;_dependency;_peerNameSet;extension;state;_signal;constructor(e,t){this.builder=e,this.extension=t,this.configs=new Set,this.state={id:ji}}mergeConfigs(){let e=this.extension.config||{};const t=this.extension.mergeConfig?this.extension.mergeConfig.bind(this.extension):Qc;for(const r of this.configs)e=t(e,r);return e}init(e){const t=this.state;Vl(t)||q(306,String(t.id));const r={getDependency:this.getInitDependency.bind(this),getDirectDependentNames:this.getDirectDependentNames.bind(this),getPeer:this.getInitPeer.bind(this),getPeerNameSet:this.getPeerNameSet.bind(this)},i={...r,getDependency:this.getDependency.bind(this),getInitResult:this.getInitResult.bind(this),getPeer:this.getPeer.bind(this)},s=(function(l,a,c){return Object.assign(l,{config:a,id:Tr,registerState:c})})(t,this.mergeConfigs(),r);let o;this.state=s,this.extension.init&&(o=this.extension.init(e,s.config,r)),this.state=(function(l,a,c){return Object.assign(l,{id:An,initResult:a,registerState:c})})(s,o,i)}build(e){const t=this.state;let r;t.id!==An&&q(307,String(t.id),String(wt)),this.extension.build&&(r=this.extension.build(e,t.config,t.registerState));const i={...t.registerState,getOutput:()=>r,getSignal:this.getSignal.bind(this)};this.state=(function(s,o,l){return Object.assign(s,{id:wt,output:o,registerState:l})})(t,r,i)}register(e,t){this._signal=t;const r=this.state;r.id!==wt&&q(308,String(r.id),String(wt));const i=this.extension.register&&this.extension.register(e,r.config,r.registerState);return this.state=(function(s){return Object.assign(s,{id:kr})})(r),()=>{const s=this.state;s.id!==Xt&&q(309,String(r.id),String(Xt)),this.state=(function(o){return Object.assign(o,{id:wt})})(s),i&&i()}}afterRegistration(e){const t=this.state;let r;return t.id!==kr&&q(310,String(t.id),String(kr)),this.extension.afterRegistration&&(r=this.extension.afterRegistration(e,t.config,t.registerState)),this.state=(function(i){return Object.assign(i,{id:Xt})})(t),r}getSignal(){return this._signal===void 0&&q(311),this._signal}getInitResult(){this.extension.init===void 0&&q(312,this.extension.name);const e=this.state;return(function(t){return t.id>=An})(e)||q(313,String(e.id),String(An)),e.initResult}getInitPeer(e){const t=this.builder.extensionNameMap.get(e);return t?t.getExtensionInitDependency():void 0}getExtensionInitDependency(){const e=this.state;return(function(t){return t.id>=Tr})(e)||q(314,String(e.id),String(Tr)),{config:e.config}}getPeer(e){const t=this.builder.extensionNameMap.get(e);return t?t.getExtensionDependency():void 0}getInitDependency(e){const t=this.builder.getExtensionRep(e);return t===void 0&&q(315,this.extension.name,e.name),t.getExtensionInitDependency()}getDependency(e){const t=this.builder.getExtensionRep(e);return t===void 0&&q(315,this.extension.name,e.name),t.getExtensionDependency()}getState(){const e=this.state;return(function(t){return t.id>=Xt})(e)||q(316,String(e.id),String(Xt)),e}getDirectDependentNames(){return this.builder.incomingEdges.get(this.extension.name)||xu}getPeerNameSet(){let e=this._peerNameSet;return e||(e=new Set((this.extension.peerDependencies||[]).map(([t])=>t)),this._peerNameSet=e),e}getExtensionDependency(){if(!this._dependency){const e=this.state;(function(t){return t.id>=wt})(e)||q(317,this.extension.name),this._dependency={config:e.config,init:e.initResult,output:e.output}}return this._dependency}}const Hs={tag:at};function Su(){const n=X();n.isEmpty()&&n.append(Se())}const Cu={config:{setOptions:Hs,updateOptions:Hs},init:({$initialEditorState:n=Su})=>({$initialEditorState:n,initialized:!1}),afterRegistration(n,{updateOptions:e,setOptions:t},r){const i=r.getInitResult();if(!i.initialized){i.initialized=!0;const{$initialEditorState:s}=i;if(bc(s))n.setEditorState(s,t);else if(typeof s=="function")n.update(()=>{s(n)},e);else if(s&&(typeof s=="string"||typeof s=="object")){const o=n.parseEditorState(s);n.setEditorState(o,t)}}return()=>{}},name:"@lexical/extension/InitialState",nodes:[Vt,Ct,Wt,Ut,Ht]},Ys=Symbol.for("@lexical/extension/LexicalBuilder");function Gs(){}function bu(n){throw n}function Dn(n){return Array.isArray(n)?n:[n]}const Or="0.39.0+prod.esm";class Rt{roots;extensionNameMap;outgoingConfigEdges;incomingEdges;conflicts;_sortedExtensionReps;PACKAGE_VERSION;constructor(e){this.outgoingConfigEdges=new Map,this.incomingEdges=new Map,this.extensionNameMap=new Map,this.conflicts=new Map,this.PACKAGE_VERSION=Or,this.roots=e;for(const t of e)this.addExtension(t)}static fromExtensions(e){const t=[Dn(Cu)];for(const r of e)t.push(Dn(r));return new Rt(t)}static maybeFromEditor(e){const t=e[Ys];return t&&(t.PACKAGE_VERSION!==Or&&q(292,t.PACKAGE_VERSION,Or),t instanceof Rt||q(293)),t}static fromEditor(e){const t=Rt.maybeFromEditor(e);return t===void 0&&q(294),t}constructEditor(){const{$initialEditorState:e,onError:t,...r}=this.buildCreateEditorArgs(),i=Object.assign(gl({...r,...t?{onError:s=>{t(s,i)}}:{}}),{[Ys]:this});for(const s of this.sortedExtensionReps())s.build(i);return i}buildEditor(){let e=Gs;function t(){try{e()}finally{e=Gs}}const r=Object.assign(this.constructEditor(),{dispose:t,[Symbol.dispose]:t});return e=St(this.registerEditor(r),()=>r.setRootElement(null)),r}hasExtensionByName(e){return this.extensionNameMap.has(e)}getExtensionRep(e){const t=this.extensionNameMap.get(e.name);if(t)return t.extension!==e&&q(295,e.name),t}addEdge(e,t,r){const i=this.outgoingConfigEdges.get(e);i?i.set(t,r):this.outgoingConfigEdges.set(e,new Map([[t,r]]));const s=this.incomingEdges.get(t);s?s.add(e):this.incomingEdges.set(t,new Set([e]))}addExtension(e){this._sortedExtensionReps!==void 0&&q(296);const t=Dn(e),[r]=t;typeof r.name!="string"&&q(297,typeof r.name);let i=this.extensionNameMap.get(r.name);if(i!==void 0&&i.extension!==r&&q(298,r.name),!i){i=new vu(this,r),this.extensionNameMap.set(r.name,i);const s=this.conflicts.get(r.name);typeof s=="string"&&q(299,r.name,s);for(const o of r.conflictsWith||[])this.extensionNameMap.has(o)&&q(299,r.name,o),this.conflicts.set(o,r.name);for(const o of r.dependencies||[]){const l=Dn(o);this.addEdge(r.name,l[0].name,l.slice(1)),this.addExtension(l)}for(const[o,l]of r.peerDependencies||[])this.addEdge(r.name,o,l?[l]:[])}}sortedExtensionReps(){if(this._sortedExtensionReps)return this._sortedExtensionReps;const e=[],t=(r,i)=>{let s=r.state;if(Vl(s))return;const o=r.extension.name;var l;Mr(s)||q(300,o,i||"[unknown]"),Mr(l=s)||q(304,String(l.id),String(ji)),s=Object.assign(l,{id:ci}),r.state=s;const a=this.outgoingConfigEdges.get(o);if(a)for(const c of a.keys()){const u=this.extensionNameMap.get(c);u&&t(u,o)}s=_u(s),r.state=s,e.push(r)};for(const r of this.extensionNameMap.values())Mr(r.state)&&t(r);for(const r of e)for(const[i,s]of this.outgoingConfigEdges.get(r.extension.name)||[])if(s.length>0){const o=this.extensionNameMap.get(i);if(o)for(const l of s)o.configs.add(l)}for(const[r,...i]of this.roots)if(i.length>0){const s=this.extensionNameMap.get(r.name);s===void 0&&q(301,r.name);for(const o of i)s.configs.add(o)}return this._sortedExtensionReps=e,this._sortedExtensionReps}registerEditor(e){const t=this.sortedExtensionReps(),r=new AbortController,i=[()=>r.abort()],s=r.signal;for(const o of t){const l=o.register(e,s);l&&i.push(l)}for(const o of t){const l=o.afterRegistration(e);l&&i.push(l)}return St(...i)}buildCreateEditorArgs(){const e={},t=new Set,r=new Map,i=new Map,s={},o={},l=this.sortedExtensionReps();for(const u of l){const{extension:f}=u;if(f.onError!==void 0&&(e.onError=f.onError),f.disableEvents!==void 0&&(e.disableEvents=f.disableEvents),f.parentEditor!==void 0&&(e.parentEditor=f.parentEditor),f.editable!==void 0&&(e.editable=f.editable),f.namespace!==void 0&&(e.namespace=f.namespace),f.$initialEditorState!==void 0&&(e.$initialEditorState=f.$initialEditorState),f.nodes)for(const d of yu(f)){if(typeof d!="function"){const p=r.get(d.replace);p&&q(302,f.name,d.replace.name,p.extension.name),r.set(d.replace,u)}t.add(d)}if(f.html){if(f.html.export)for(const[d,p]of f.html.export.entries())i.set(d,p);f.html.import&&Object.assign(s,f.html.import)}f.theme&&Ul(o,f.theme)}Object.keys(o).length>0&&(e.theme=o),t.size&&(e.nodes=[...t]);const a=Object.keys(s).length>0,c=i.size>0;(a||c)&&(e.html={},a&&(e.html.import=s),c&&(e.html.export=i));for(const u of l)u.init(e);return e.onError||(e.onError=bu),e}}function Nu(n,e){const t=Rt.fromEditor(n).extensionNameMap.get(e);return t?t.getExtensionDependency():void 0}const Eu={name:"@lexical/react/ReactProvider"};function wu(){return X().getTextContent()}function Tu(n,e=!0){if(n)return!1;let t=wu();return e&&(t=t.trim()),t===""}function ku(n){if(!Tu(n,!1))return!1;const e=X().getChildren(),t=e.length;if(t>1)return!1;for(let r=0;r<t;r++){const i=e[r];if(V(i))return!1;if(E(i)){if(!fl(i)||i.__indent!==0)return!1;const s=i.getChildren(),o=s.length;for(let l=0;l<o;l++){const a=s[r];if(!A(a))return!1}}}return!0}function Hl(n){return()=>ku(n)}function Mu(n){const e=window.location.origin,t=r=>{if(r.origin!==e)return;const i=n.getRootElement();if(document.activeElement!==i)return;const s=r.data;if(typeof s=="string"){let o;try{o=JSON.parse(s)}catch{return}if(o&&o.protocol==="nuanria_messaging"&&o.type==="request"){const l=o.payload;if(l&&l.functionId==="makeChanges"){const a=l.args;if(a){const[c,u,f,d,p]=a;n.update(()=>{const h=L();if(O(h)){const m=h.anchor;let g=m.getNode(),_=0,y=0;if(A(g)&&c>=0&&u>=0&&(_=c,y=c+u,h.setTextNodeRange(g,_,g,y)),_===y&&f===""||(h.insertRawText(f),g=m.getNode()),A(g)){_=d,y=d+p;const x=g.getTextContentSize();_=_>x?x:_,y=y>x?x:y,h.setTextNodeRange(g,_,g,y)}r.stopImmediatePropagation()}})}}}}};return window.addEventListener("message",t,!0),()=>{window.removeEventListener("message",t,!0)}}function Ou(n,e){const t=_l(e)?e.body.childNodes:e.childNodes;let r=[];const i=[];for(const s of t)if(!Gl.has(s.nodeName)){const o=ql(s,n,i,!1);o!==null&&(r=r.concat(o))}return(function(s){for(const o of s)o.getNextSibling()instanceof vi&&o.insertAfter(mt());for(const o of s){const l=o.getChildren();for(const a of l)o.insertBefore(a);o.remove()}})(i),r}function Au(n,e){if(typeof document>"u"||typeof window>"u"&&global.window===void 0)throw new Error("To use $generateHtmlFromNodes in headless mode please initialize a headless browser implementation such as JSDom before calling this function.");const t=document.createElement("div"),r=X().getChildren();for(let i=0;i<r.length;i++)Yl(n,r[i],t,e);return t.innerHTML}function Yl(n,e,t,r=null){let i=r===null||e.isSelected(r);const s=E(e)&&e.excludeFromCopy("html");let o=e;r!==null&&A(e)&&(o=Rl(r,e,"clone"));const l=E(o)?o.getChildren():[],a=Ci(n,o.getType());let c;c=a&&a.exportDOM!==void 0?a.exportDOM(n,o):o.exportDOM(n);const{element:u,after:f}=c;if(!u)return!1;const d=document.createDocumentFragment();for(let p=0;p<l.length;p++){const h=l[p],m=Yl(n,h,d,r);!i&&E(e)&&m&&e.extractWithChild(h,r,"html")&&(i=!0)}if(i&&!s){if((ye(u)||oi(u))&&u.append(d),t.append(u),f){const p=f.call(o,u);p&&(oi(u)?u.replaceChildren(p):u.replaceWith(p))}}else t.append(d);return i}const Gl=new Set(["STYLE","SCRIPT"]);function ql(n,e,t,r,i=new Map,s){let o=[];if(Gl.has(n.nodeName))return o;let l=null;const a=(function(h,m){const{nodeName:g}=h,_=m._htmlConversions.get(g.toLowerCase());let y=null;if(_!==void 0)for(const x of _){const C=x(h);C!==null&&(y===null||(y.priority||0)<=(C.priority||0))&&(y=C)}return y!==null?y.conversion:null})(n,e),c=a?a(n):null;let u=null;if(c!==null){u=c.after;const h=c.node;if(l=Array.isArray(h)?h[h.length-1]:h,l!==null){for(const[,m]of i)if(l=m(l,s),!l)break;l&&o.push(...Array.isArray(h)?h:[l])}c.forChild!=null&&i.set(n.nodeName,c.forChild)}const f=n.childNodes;let d=[];const p=(l==null||!Re(l))&&(l!=null&&ti(l)||r);for(let h=0;h<f.length;h++)d.push(...ql(f[h],e,t,p,new Map(i),l));return u!=null&&(d=u(d)),ir(n)&&(d=Du(n,d,p?()=>{const h=new vi;return t.push(h),h}:Se)),l==null?d.length>0?o=o.concat(d):ir(n)&&(function(h){return h.nextSibling==null||h.previousSibling==null?!1:li(h.nextSibling)&&li(h.previousSibling)})(n)&&(o=o.concat(mt())):E(l)&&l.append(...d),o}function Du(n,e,t){const r=n.style.textAlign,i=[];let s=[];for(let o=0;o<e.length;o++){const l=e[o];if(ti(l))r&&!l.getFormat()&&l.setFormat(r),i.push(l);else if(s.push(l),o===e.length-1||o<e.length-1&&ti(e[o+1])){const a=t();a.setFormat(r),a.append(...s),i.push(a),s=[]}}return i}function sr(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}function Pu(n,e=L()){return e==null&&sr(166),O(e)&&e.isCollapsed()||e.getNodes().length===0?"":Au(n,e)}function Lu(n,e=L()){return e==null&&sr(166),O(e)&&e.isCollapsed()||e.getNodes().length===0?null:JSON.stringify(Iu(n,e))}function qs(n,e,t){const r=n.getData("application/x-lexical-editor");if(r)try{const l=JSON.parse(r);if(l.namespace===t._config.namespace&&Array.isArray(l.nodes))return Xs(t,Ru(l.nodes),e)}catch(l){console.error(l)}const i=n.getData("text/html"),s=n.getData("text/plain");if(i&&s!==i)try{const l=new DOMParser().parseFromString((function(a){return window.trustedTypes&&window.trustedTypes.createPolicy?window.trustedTypes.createPolicy("lexical",{createHTML:c=>c}).createHTML(a):a})(i),"text/html");return Xs(t,Ou(t,l),e)}catch(l){console.error(l)}const o=s||n.getData("text/uri-list");if(o!=null)if(O(e)){const l=o.split(/(\r?\n|\t)/);l[l.length-1]===""&&l.pop();for(let a=0;a<l.length;a++){const c=L();if(O(c)){const u=l[a];u===`
`||u===`\r
`?c.insertParagraph():u==="	"?c.insertNodes([mn()]):c.insertText(u)}}}else e.insertRawText(o)}function Xs(n,e,t){n.dispatchCommand(Ka,{nodes:e,selection:t})||(t.insertNodes(e),(function(r){if(O(r)&&r.isCollapsed()){const i=r.anchor;let s=null;const o=Ue(i,"previous");if(o)if(qe(o))s=o.origin;else{const l=et(o,We(X(),"next").getFlipped());for(const a of l){if(A(a.origin)){s=a.origin;break}if(E(a.origin)&&!a.origin.isInline())break}}if(s&&A(s)){const l=s.getFormat(),a=s.getStyle();r.format===l&&r.style===a||(r.format=l,r.style=a,r.dirty=!0)}}})(t))}function Xl(n,e,t,r=[]){let i=e===null||t.isSelected(e);const s=E(t)&&t.excludeFromCopy("html");let o=t;e!==null&&A(o)&&(o=Rl(e,o,"clone"));const l=E(o)?o.getChildren():[],a=(function(c){const u=c.exportJSON(),f=c.constructor;if(u.type!==f.getType()&&sr(58,f.name),E(c)){const d=u.children;Array.isArray(d)||sr(59,f.name)}return u})(o);A(o)&&o.getTextContentSize()===0&&(i=!1);for(let c=0;c<l.length;c++){const u=l[c],f=Xl(n,e,u,a.children);!i&&E(t)&&f&&t.extractWithChild(u,e,"clone")&&(i=!0)}if(i&&!s)r.push(a);else if(Array.isArray(a.children))for(let c=0;c<a.children.length;c++){const u=a.children[c];r.push(u)}return i}function Iu(n,e){const t=[],r=X().getChildren();for(let i=0;i<r.length;i++)Xl(n,e,r[i],t);return{namespace:n._config.namespace,nodes:t}}function Ru(n){const e=[];for(let t=0;t<n.length;t++){const r=n[t],i=Cc(r);A(i)&&lu(i),e.push(i)}return e}let Tt=null;async function Zs(n,e,t){if(Tt!==null)return!1;if(e!==null)return new Promise((c,u)=>{n.update(()=>{c(Qs(n,e,t))})});const r=n.getRootElement(),i=n._window||window,s=i.document,o=Te(i);if(r===null||o===null)return!1;const l=s.createElement("span");l.style.cssText="position: fixed; top: -1000px;",l.append(s.createTextNode("#")),r.append(l);const a=new Range;return a.setStart(l,0),a.setEnd(l,1),o.removeAllRanges(),o.addRange(a),new Promise((c,u)=>{const f=n.registerCommand(ar,d=>(ot(d,ClipboardEvent)&&(f(),Tt!==null&&(i.clearTimeout(Tt),Tt=null),c(Qs(n,d,t))),!0),Ec);Tt=i.setTimeout(()=>{f(),Tt=null,c(!1)},50),s.execCommand("copy"),l.remove()})}function Qs(n,e,t){if(t===void 0){const i=Te(n._window),s=L();if(!s||s.isCollapsed()||!i)return!1;const o=i.anchorNode,l=i.focusNode;if(o!==null&&l!==null&&!vn(n,o,l))return!1;t=Fu(s)}e.preventDefault();const r=e.clipboardData;return r!==null&&($u(r,t),!0)}const Zl=[["text/html",Pu],["application/x-lexical-editor",Lu]];function Fu(n=L()){const e={"text/plain":n?n.getTextContent():""};if(n){const t=Oi();for(const[r,i]of Zl){const s=i(t,n);s!==null&&(e[r]=s)}}return e}function $u(n,e){for(const[t]of Zl)e[t]===void 0&&n.setData(t,"");for(const t in e){const r=e[t];r!==void 0&&n.setData(t,r)}}function eo(n,e){if(document.caretRangeFromPoint!==void 0){const t=document.caretRangeFromPoint(n,e);return t===null?null:{node:t.startContainer,offset:t.startOffset}}if(document.caretPositionFromPoint!=="undefined"){const t=document.caretPositionFromPoint(n,e);return t===null?null:{node:t.offsetNode,offset:t.offset}}return null}const Nt=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0,ju=Nt&&"documentMode"in document?document.documentMode:null,Ku=Nt&&/Mac|iPod|iPhone|iPad/.test(navigator.platform),zu=!(!Nt||!("InputEvent"in window)||ju)&&"getTargetRanges"in new window.InputEvent("input"),Bu=Nt&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),to=Nt&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,Wu=Nt&&/^(?=.*Chrome).*/i.test(navigator.userAgent),Uu=Nt&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&Ku&&!Wu,no=I("DRAG_DROP_PASTE_FILE");function Pn(n){let e=null;if(ot(n,DragEvent)?e=n.dataTransfer:ot(n,ClipboardEvent)&&(e=n.clipboardData),e===null)return[!1,[],!1];const t=e.types,r=t.includes("Files"),i=t.includes("text/html")||t.includes("text/plain");return[r,Array.from(e.files),i]}function ro(n){const e=L();if(!O(e))return!1;const t=new Set,r=e.getNodes();for(let i=0;i<r.length;i++){const s=r[i],o=s.getKey();if(t.has(o))continue;const l=dt(s,c=>E(c)&&!c.isInline());if(l===null)continue;const a=l.getKey();l.canIndent()&&!t.has(a)&&(t.add(a),n(l))}return t.size>0}function io(n){const e=jt(n);return V(e)}function Ar(n){for(const e of["lowercase","uppercase","capitalize"])n.hasFormat(e)&&n.toggleFormat(e)}function Ju(n){return St(n.registerCommand(No,e=>{const t=L();return!!_e(t)&&(t.clear(),!0)},j),n.registerCommand(lt,e=>{const t=L();return O(t)?(t.deleteCharacter(e),!0):!!_e(t)&&(t.deleteNodes(),!0)},j),n.registerCommand(cn,e=>{const t=L();return!!O(t)&&(t.deleteWord(e),!0)},j),n.registerCommand(un,e=>{const t=L();return!!O(t)&&(t.deleteLine(e),!0)},j),n.registerCommand(Pt,e=>{const t=L();if(typeof e=="string")t!==null&&t.insertText(e);else{if(t===null)return!1;const r=e.dataTransfer;if(r!=null)qs(r,t,n);else if(O(t)){const i=e.data;return i&&t.insertText(i),!0}}return!0},j),n.registerCommand(Ur,()=>{const e=L();return!!O(e)&&(e.removeText(),!0)},j),n.registerCommand(Ye,e=>{const t=L();return!!O(t)&&(t.formatText(e),!0)},j),n.registerCommand(Ja,e=>{const t=L();if(!O(t)&&!_e(t))return!1;const r=t.getNodes();for(const i of r){const s=dt(i,o=>E(o)&&!o.isInline());s!==null&&s.setFormat(e)}return!0},j),n.registerCommand(Dt,e=>{const t=L();return!!O(t)&&(t.insertLineBreak(e),!0)},j),n.registerCommand(Gn,()=>{const e=L();return!!O(e)&&(e.insertParagraph(),!0)},j),n.registerCommand(Wa,()=>(xc([mn()]),!0),j),n.registerCommand(Ua,()=>ro(e=>{const t=e.getIndent();e.setIndent(t+1)}),j),n.registerCommand(ss,()=>ro(e=>{const t=e.getIndent();t>0&&e.setIndent(Math.max(0,t-1))}),j),n.registerCommand(Do,e=>{const t=L();if(_e(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectPrevious(),!0}else if(O(t)){const r=ri(t.focus,!0);if(!e.shiftKey&&V(r)&&!r.isIsolated()&&!r.isInline())return r.selectPrevious(),e.preventDefault(),!0}return!1},j),n.registerCommand(Po,e=>{const t=L();if(_e(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),r[0].selectNext(0,0),!0}else if(O(t)){if((function(i){const s=i.focus;return s.key==="root"&&s.offset===X().getChildrenSize()})(t))return e.preventDefault(),!0;const r=ri(t.focus,!1);if(!e.shiftKey&&V(r)&&!r.isIsolated()&&!r.isInline())return r.selectNext(),e.preventDefault(),!0}return!1},j),n.registerCommand(Ao,e=>{const t=L();if(_e(t)){const r=t.getNodes();if(r.length>0)return e.preventDefault(),zs(r[0])?r[0].selectNext(0,0):r[0].selectPrevious(),!0}if(!O(t))return!1;if(Bs(t,!0)){const r=e.shiftKey;return e.preventDefault(),Ws(t,r,!0),!0}return!1},j),n.registerCommand(Oo,e=>{const t=L();if(_e(t)){const i=t.getNodes();if(i.length>0)return e.preventDefault(),zs(i[0])?i[0].selectPrevious():i[0].selectNext(0,0),!0}if(!O(t))return!1;const r=e.shiftKey;return!!Bs(t,!1)&&(e.preventDefault(),Ws(t,r,!1),!0)},j),n.registerCommand(Io,e=>{if(io(e.target))return!1;const t=L();if(O(t)){if((function(r){if(!r.isCollapsed())return!1;const{anchor:i}=r;if(i.offset!==0)return!1;const s=i.getNode();if(ee(s))return!1;const o=du(s);return o.getIndent()>0&&(o.is(s)||s.is(o.getFirstDescendant()))})(t))return e.preventDefault(),n.dispatchCommand(ss,void 0);if(to&&navigator.language==="ko-KR")return!1}else if(!_e(t))return!1;return e.preventDefault(),n.dispatchCommand(lt,!0)},j),n.registerCommand(Fo,e=>{if(io(e.target))return!1;const t=L();return!(!O(t)&&!_e(t))&&(e.preventDefault(),n.dispatchCommand(lt,!1))},j),n.registerCommand(qn,e=>{const t=L();if(!O(t))return!1;if(Ar(t),e!==null){if((to||Bu||Uu)&&zu)return!1;if(e.preventDefault(),e.shiftKey)return n.dispatchCommand(Dt,!1)}return n.dispatchCommand(Gn,void 0)},j),n.registerCommand(Ro,()=>{const e=L();return!!O(e)&&(n.blur(),!0)},j),n.registerCommand(jo,e=>{const[,t]=Pn(e);if(t.length>0){const i=eo(e.clientX,e.clientY);if(i!==null){const{offset:s,node:o}=i,l=jt(o);if(l!==null){const a=rl();if(A(l))a.anchor.set(l.getKey(),s,"text"),a.focus.set(l.getKey(),s,"text");else{const u=l.getParentOrThrow().getKey(),f=l.getIndexWithinParent()+1;a.anchor.set(u,f,"element"),a.focus.set(u,f,"element")}const c=Un(a);me(c)}n.dispatchCommand(no,t)}return e.preventDefault(),!0}const r=L();return!!O(r)},j),n.registerCommand(Ko,e=>{const[t]=Pn(e),r=L();return!(t&&!O(r))},j),n.registerCommand(zo,e=>{const[t]=Pn(e),r=L();if(t&&!O(r))return!1;const i=eo(e.clientX,e.clientY);if(i!==null){const s=jt(i.node);V(s)&&e.preventDefault()}return!0},j),n.registerCommand(Jr,()=>(Ac(),!0),j),n.registerCommand(ar,e=>(Zs(n,ot(e,ClipboardEvent)?e:null),!0),j),n.registerCommand(pi,e=>((async function(t,r){await Zs(r,ot(t,ClipboardEvent)?t:null),r.update(()=>{const i=L();O(i)?i.removeText():_e(i)&&i.getNodes().forEach(s=>s.remove())})})(e,n),!0),j),n.registerCommand(fi,e=>{const[,t,r]=Pn(e);return t.length>0&&!r?(n.dispatchCommand(no,t),!0):Yt(e.target)&&bi(e.target)?!1:L()!==null&&((function(i,s){i.preventDefault(),s.update(()=>{const o=L(),l=ot(i,InputEvent)||ot(i,KeyboardEvent)?null:i.clipboardData;l!=null&&o!==null&&qs(l,o,s)},{tag:sc})})(e,n),!0)},j),n.registerCommand(Lo,e=>{const t=L();return O(t)&&Ar(t),!1},j),n.registerCommand($o,e=>{const t=L();return O(t)&&Ar(t),!1},j))}function Vu(n,...e){const t=new URL("https://lexical.dev/docs/error"),r=new URLSearchParams;r.append("code",n);for(const i of e)r.append("v",i);throw t.search=r.toString(),Error(`Minified Lexical error #${n}; visit ${t.toString()} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)}const Ki=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?M.useLayoutEffect:M.useEffect;function Hu({editor:n,ErrorBoundary:e}){return(function(t,r){const[i,s]=M.useState(()=>t.getDecorators());return Ki(()=>t.registerDecoratorListener(o=>{Ji.flushSync(()=>{s(o)})}),[t]),M.useEffect(()=>{s(t.getDecorators())},[t]),M.useMemo(()=>{const o=[],l=Object.keys(i);for(let a=0;a<l.length;a++){const c=l[a],u=b.jsx(r,{onError:d=>t._onError(d),children:b.jsx(M.Suspense,{fallback:null,children:i[c]})}),f=t.getElementByKey(c);f!==null&&o.push(Ji.createPortal(u,f,c))}return o},[r,i,t])})(n,e)}function Yu({editor:n,ErrorBoundary:e}){return(function(t){const r=Rt.maybeFromEditor(t);if(r&&r.hasExtensionByName(Eu.name)){for(const i of["@lexical/plain-text","@lexical/rich-text"])r.hasExtensionByName(i)&&Vu(320,i);return!0}return!1})(n)?null:b.jsx(Hu,{editor:n,ErrorBoundary:e})}function so(n){return n.getEditorState().read(Hl(n.isComposing()))}function Gu({contentEditable:n,placeholder:e=null,ErrorBoundary:t}){const[r]=Je();return(function(i){Ki(()=>St(Ju(i),Mu(i)),[i])})(r),b.jsxs(b.Fragment,{children:[n,b.jsx(qu,{content:e}),b.jsx(Yu,{editor:r,ErrorBoundary:t})]})}function qu({content:n}){const[e]=Je(),t=(function(i){const[s,o]=M.useState(()=>so(i));return Ki(()=>{function l(){const a=so(i);o(a)}return l(),St(i.registerUpdateListener(()=>{l()}),i.registerEditableListener(()=>{l()}))},[i]),s})(e),r=iu();return t?typeof n=="function"?n(r):n:null}const Ql=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?M.useLayoutEffect:M.useEffect;function Xu({editor:n,ariaActiveDescendant:e,ariaAutoComplete:t,ariaControls:r,ariaDescribedBy:i,ariaErrorMessage:s,ariaExpanded:o,ariaInvalid:l,ariaLabel:a,ariaLabelledBy:c,ariaMultiline:u,ariaOwns:f,ariaRequired:d,autoCapitalize:p,className:h,id:m,role:g="textbox",spellCheck:_=!0,style:y,tabIndex:x,"data-testid":C,...w},v){const[T,S]=M.useState(n.isEditable()),N=M.useCallback(R=>{R&&R.ownerDocument&&R.ownerDocument.defaultView?n.setRootElement(R):n.setRootElement(null)},[n]),P=M.useMemo(()=>(function(...R){return z=>{for(const $ of R)typeof $=="function"?$(z):$!=null&&($.current=z)}})(v,N),[N,v]);return Ql(()=>(S(n.isEditable()),n.registerEditableListener(R=>{S(R)})),[n]),b.jsx("div",{"aria-activedescendant":T?e:void 0,"aria-autocomplete":T?t:"none","aria-controls":T?r:void 0,"aria-describedby":i,...s!=null?{"aria-errormessage":s}:{},"aria-expanded":T&&g==="combobox"?!!o:void 0,...l!=null?{"aria-invalid":l}:{},"aria-label":a,"aria-labelledby":c,"aria-multiline":u,"aria-owns":T?f:void 0,"aria-readonly":!T||void 0,"aria-required":d,autoCapitalize:p,className:h,contentEditable:T,"data-testid":C,id:m,ref:P,role:g,spellCheck:_,style:y,tabIndex:x,...w})}const Zu=M.forwardRef(Xu);function oo(n){return n.getEditorState().read(Hl(n.isComposing()))}const Qu=M.forwardRef(ed);function ed(n,e){const{placeholder:t,...r}=n,[i]=Je();return b.jsxs(b.Fragment,{children:[b.jsx(Zu,{editor:i,...r,ref:e}),t!=null&&b.jsx(td,{editor:i,content:t})]})}function td({content:n,editor:e}){const t=(function(o){const[l,a]=M.useState(()=>oo(o));return Ql(()=>{function c(){const u=oo(o);a(u)}return c(),St(o.registerUpdateListener(()=>{c()}),o.registerEditableListener(()=>{c()}))},[o]),l})(e),[r,i]=M.useState(e.isEditable());if(M.useLayoutEffect(()=>(i(e.isEditable()),e.registerEditableListener(o=>{i(o)})),[e]),!t)return null;let s=null;return typeof n=="function"?s=n(r):n!==null&&(s=n),s===null?null:b.jsx("div",{"aria-hidden":!0,children:s})}function nd(n,e,t,r,i){if(n===null||t.size===0&&r.size===0&&!i)return 0;const s=e._selection,o=n._selection;if(i)return 1;if(!(O(s)&&O(o)&&o.isCollapsed()&&s.isCollapsed()))return 0;const l=(function(_,y,x){const C=_._nodeMap,w=[];for(const v of y){const T=C.get(v);T!==void 0&&w.push(T)}for(const[v,T]of x){if(!T)continue;const S=C.get(v);S===void 0||ee(S)||w.push(S)}return w})(e,t,r);if(l.length===0)return 0;if(l.length>1){const _=e._nodeMap,y=_.get(s.anchor.key),x=_.get(o.anchor.key);return y&&x&&!n._nodeMap.has(y.__key)&&A(y)&&y.__text.length===1&&s.anchor.offset===1?2:0}const a=l[0],c=n._nodeMap.get(a.__key);if(!A(c)||!A(a)||c.__mode!==a.__mode)return 0;const u=c.__text,f=a.__text;if(u===f)return 0;const d=s.anchor,p=o.anchor;if(d.key!==p.key||d.type!=="text")return 0;const h=d.offset,m=p.offset,g=f.length-u.length;return g===1&&m===h-1?2:g===-1&&m===h+1?3:g===-1&&m===h?4:0}function rd(n,e){let t=Date.now(),r=0;return(i,s,o,l,a,c)=>{const u=Date.now();if(c.has(Qr))return r=0,t=u,2;const f=nd(i,s,l,a,n.isComposing()),d=(()=>{const p=o===null||o.editor===n,h=c.has(ic);if(!h&&p&&c.has(at))return 0;if(i===null)return 1;const m=s._selection;if(!(l.size>0||a.size>0))return m!==null?0:2;const g=typeof e=="number"?e:e.peek();return h===!1&&f!==0&&f===r&&u<t+g&&p||l.size===1&&(function(_,y,x){const C=y._nodeMap.get(_),w=x._nodeMap.get(_),v=y._selection,T=x._selection;return!(O(v)&&O(T)&&v.anchor.type==="element"&&v.focus.type==="element"&&T.anchor.type==="text"&&T.focus.type==="text"||!A(C)||!A(w)||C.__parent!==w.__parent)&&JSON.stringify(y.read(()=>C.exportJSON()))===JSON.stringify(x.read(()=>w.exportJSON()))})(Array.from(l)[0],i,s)?0:1})();return t=u,r=f,d}}function lo(n){n.undoStack=[],n.redoStack=[],n.current=null}function ea(n,e,t){const r=rd(n,t);return St(n.registerCommand(hi,()=>((function(s,o){const l=o.redoStack,a=o.undoStack;if(a.length!==0){const c=o.current,u=a.pop();c!==null&&(l.push(c),s.dispatchCommand(Nn,!0)),a.length===0&&s.dispatchCommand(En,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Qr})}})(n,e),!0),j),n.registerCommand(gi,()=>((function(s,o){const l=o.redoStack,a=o.undoStack;if(l.length!==0){const c=o.current;c!==null&&(a.push(c),s.dispatchCommand(En,!0));const u=l.pop();l.length===0&&s.dispatchCommand(Nn,!1),o.current=u||null,u&&u.editor.setEditorState(u.editorState,{tag:Qr})}})(n,e),!0),j),n.registerCommand(Ha,()=>(lo(e),!1),j),n.registerCommand(Ya,()=>(lo(e),n.dispatchCommand(Nn,!1),n.dispatchCommand(En,!1),!0),j),n.registerUpdateListener(({editorState:s,prevEditorState:o,dirtyLeaves:l,dirtyElements:a,tags:c})=>{const u=e.current,f=e.redoStack,d=e.undoStack,p=u===null?null:u.editorState;if(u!==null&&s===p)return;const h=r(o,s,u,l,a,c);if(h===1)f.length!==0&&(e.redoStack=[],n.dispatchCommand(Nn,!1)),u!==null&&(d.push({...u}),n.dispatchCommand(En,!0));else if(h===2)return;e.current={editor:n,editorState:s}}))}function ta(){return{current:null,redoStack:[],undoStack:[]}}const Dr={build:(n,{delay:e,createInitialHistoryState:t,disabled:r})=>mu({delay:e,disabled:r,historyState:t(n)}),config:{createInitialHistoryState:ta,delay:300,disabled:typeof window>"u"},name:"@lexical/history/History",register:(n,e,t)=>{const r=t.getOutput();return $i(()=>r.disabled.value?void 0:ea(n,r.historyState.value,r.delay))}};Zc(Dr,{createInitialHistoryState:()=>{throw new Error("SharedHistory did not inherit parent history")},disabled:!0});function id({delay:n,externalHistoryState:e}){const[t]=Je();return(function(r,i,s=1e3){const o=M.useMemo(()=>i||ta(),[i]);M.useEffect(()=>ea(r,o,s),[s,r,o])})(t,e,n),null}function sd({defaultSelection:n}){const[e]=Je();return M.useEffect(()=>{e.focus(()=>{const t=document.activeElement,r=e.getRootElement();r===null||t!==null&&r.contains(t)||r.focus({preventScroll:!0})},{defaultSelection:n})},[n,e]),null}const od=typeof window<"u"&&window.document!==void 0&&window.document.createElement!==void 0?M.useLayoutEffect:M.useEffect;function ld({ignoreHistoryMergeTagChange:n=!0,ignoreSelectionChange:e=!1,onChange:t}){const[r]=Je();return od(()=>{if(t)return r.registerUpdateListener(({editorState:i,dirtyElements:s,dirtyLeaves:o,prevEditorState:l,tags:a})=>{e&&s.size===0&&o.size===0||n&&a.has(at)||l.isEmpty()||t(i,r,a)})},[r,n,e,t]),null}const ad=M.createContext(null),Pr={didCatch:!1,error:null};class cd extends M.Component{constructor(e){super(e),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=Pr}static getDerivedStateFromError(e){return{didCatch:!0,error:e}}resetErrorBoundary(...e){const{error:t}=this.state;t!==null&&(this.props.onReset?.({args:e,reason:"imperative-api"}),this.setState(Pr))}componentDidCatch(e,t){this.props.onError?.(e,t)}componentDidUpdate(e,t){const{didCatch:r}=this.state,{resetKeys:i}=this.props;r&&t.error!==null&&ud(e.resetKeys,i)&&(this.props.onReset?.({next:i,prev:e.resetKeys,reason:"keys"}),this.setState(Pr))}render(){const{children:e,fallbackRender:t,FallbackComponent:r,fallback:i}=this.props,{didCatch:s,error:o}=this.state;let l=e;if(s){const a={error:o,resetErrorBoundary:this.resetErrorBoundary};if(typeof t=="function")l=t(a);else if(r)l=M.createElement(r,a);else if(i!==void 0)l=i;else throw o}return M.createElement(ad.Provider,{value:{didCatch:s,error:o,resetErrorBoundary:this.resetErrorBoundary}},l)}}function ud(n=[],e=[]){return n.length!==e.length||n.some((t,r)=>!Object.is(t,e[r]))}function dd({children:n,onError:e}){return b.jsx(cd,{fallback:b.jsx("div",{style:{border:"1px solid #f00",color:"#f00",padding:"8px"},children:"An error was thrown."}),onError:e,children:n})}const fd={paragraph:"editor-line",placeholder:"editor-placeholder"},Lr=n=>String(n).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"),Ln=(n,e=[])=>{if(!n)return"";const t=String(n).split(`
`);let r=0;return t.map((i,s)=>{if(!i)return`<div class="editor-line" data-line="${s}"><br></div>`;const o=/[A-Za-z']+/g,a=Array.from(i.matchAll(o)).map(()=>e[r++]||null),c=a.reduce((h,m)=>{const g=Bn(m?.result||null,"rhyme");return g&&(h[g]=(h[g]||0)+1),h},{});let u="",f=0,d=0;i.replace(o,(h,m)=>{const g=i.slice(f,m);g&&(u+=Lr(g));const y=a[d]?.result||null,x=Bn(y,"rhyme"),C=x&&c[x]>1,w=y?.classes?.length?y.classes:["editor-word"],v=C?y?.channels?.text?.className:"",T=y?.channels?.accent?.className||"",S=[...new Set([...w,v,T,T?"has-feel":""])].filter(Boolean).join(" ");return u+=`<span class="${S}">${Lr(h)}</span>`,f=m+h.length,d+=1,h});const p=i.slice(f);return p&&(u+=Lr(p)),`<div class="editor-line" data-line="${s}">${u||"<br>"}</div>`}).join("")},hd=M.memo(function({wordCount:e,charCount:t,limit:r,isOverLimit:i}){return b.jsxs("div",{className:"editor-stats",children:[b.jsxs("span",{className:"stat-badge",children:[e," words"]}),b.jsxs("span",{className:`stat-badge ${i?"stat-badge--alert":""}`,children:[t," / ",r.toLocaleString()," chars"]})]})});function gd({content:n}){const[e]=Je();return M.useEffect(()=>{e.update(()=>{const t=X();t.clear(),n.split(`
`).forEach(r=>{const i=Se();i.append(ie(r)),t.append(i)})})},[n,e]),null}function pd({onWordClick:n}){const[e]=Je();return M.useEffect(()=>{const t=e.getRootElement();if(!t)return;const r=i=>{const s=window.getSelection();if(!s||s.rangeCount===0)return;const o=s.getRangeAt(0),l=s.anchorNode;if(l?.nodeType!==Node.TEXT_NODE)return;const a=l.textContent||"";let c=o.startOffset,u=o.startOffset;for(;c>0&&/\w/.test(a[c-1]);)c-=1;for(;u<a.length&&/\w/.test(a[u]);)u+=1;const f=a.slice(c,u);f&&n?.(f)};return t.addEventListener("click",r),()=>t.removeEventListener("click",r)},[e,n]),null}const md=500,yd=1800,_d=400,Ir=n=>{const e=n.trim();return{words:e?e.split(/\s+/).length:0,chars:n.length}},xd=n=>{const e=window.getSelection?.();if(!e||e.rangeCount===0||!n)return null;const t=e.getRangeAt(0),r=t.startContainer,i=(r.nodeType===Node.TEXT_NODE?r.parentElement?.closest(".editor-line"):r.closest?.(".editor-line"))||null;if(!i||!n.contains(i))return null;const s=Array.from(n.querySelectorAll(".editor-line")),o=s.indexOf(i);if(o<0)return null;const l=t.cloneRange();l.selectNodeContents(i),l.setEnd(t.startContainer,t.startOffset);let c=l.toString().length;for(let u=0;u<o;u+=1)c+=s[u].innerText.length+1;return c};function vd({initialTitle:n="",initialContent:e="",onSave:t,onContentChange:r,onCancel:i,isEditing:s=!1,disabled:o=!1,colorEngine:l=null,engineRevision:a=0,onWordClick:c}){const[u,f]=M.useState(n),[d,p]=M.useState(e),[h,m]=M.useState(()=>Ir(e)),[g,_]=M.useState(!1),[y,x]=M.useState(null),[C,w]=M.useState(""),[v,T]=M.useState(!1),S=M.useRef(e),N=M.useRef(null),P=M.useRef(null),R=M.useRef(null),z=M.useRef(null),$=M.useRef(!1);M.useEffect(()=>{f(n),p(e),m(Ir(e)),S.current=e,w("")},[n,e]),M.useEffect(()=>()=>{N.current&&clearTimeout(N.current),P.current&&clearTimeout(P.current),R.current&&clearTimeout(R.current)},[]),M.useEffect(()=>{te()},[a,l]),M.useEffect(()=>{if($.current||typeof document>"u"||document.documentElement.dataset.visualTest!=="true"||!l?.getTokenResult)return;const K=S.current.trim().split(/\s+/)[0];K&&c&&($.current=!0,c(K))},[C,c,l,a]);const B=h.chars>ve.content,F=ve.content-h.chars;function U(){P.current&&clearTimeout(P.current),P.current=setTimeout(()=>{P.current=null,te()},yd)}const W=M.useMemo(()=>({namespace:"ScholomanceEditor",theme:fd,editable:!o&&!g,onError:K=>console.error(K)}),[o,g]),ce=()=>{N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{N.current=null;const K=S.current;p(K),r?.(K)},md)};function te(){try{if(l){const{decorations:K}=l.decorateText(S.current);w(Ln(S.current,K))}else w(Ln(S.current,[]))}catch{}}const xe=()=>{T(!0),R.current&&clearTimeout(R.current),R.current=setTimeout(()=>{T(!1)},_d)},nt=(K,Z)=>{K.read(()=>{const be=X().getTextContent();S.current=be;const Me=Ir(be);(Me.words!==h.words||Me.chars!==h.chars)&&m(Me);const he=Z.getRootElement();if(he&&!z.current&&(z.current=he),l&&z.current){const zi=xd(z.current);if(zi!==null){const Cn=be.split(`
`);let Bi=zi,Wi=Cn[0]||"";for(let bn=0;bn<Cn.length;bn+=1){const Ui=Cn[bn].length+1;if(Bi<=Ui){Wi=Cn[bn];break}Bi-=Ui}try{l.decorateText(Wi)}catch{}}}ce(),U(),xe()})},G=async()=>{x(null);const K=S.current;if(!K.trim()){x({field:"content",message:"Content cannot be empty"});return}if(u.length>ve.title){x({field:"title",message:`Title must be ${ve.title} characters or less`});return}if(K.length>ve.content){x({field:"content",message:`Content must be ${ve.content.toLocaleString()} characters or less`});return}_(!0);try{await t?.(u.trim(),K.trim()),x(null),p(K),r?.(K)}catch(Z){x({field:"form",message:Z.message||"Failed to save scroll"})}finally{_(!1)}},Q=y?.field==="form";y?.field;const ne=y?.field==="title";return b.jsxs(zn.div,{className:`scroll-editor surface ${S.current.trim()?"has-text":"is-empty"}`,"data-surface":"editor","data-role":"editor",initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.2},children:[b.jsxs("div",{className:"editor-header",children:[b.jsx("label",{htmlFor:"scroll-title",className:"sr-only",children:"Scroll Title"}),b.jsx("input",{type:"text",id:"scroll-title",className:"editor-title-input",placeholder:"Scroll Title...",value:u,onChange:K=>f(K.target.value),disabled:o||g,maxLength:ve.title,"aria-invalid":ne,"aria-describedby":ne?"editor-error-message":void 0}),b.jsx(hd,{wordCount:h.words,charCount:h.chars,limit:ve.content,isOverLimit:B})]}),y&&!Q&&b.jsxs("div",{id:"editor-error-message",className:"editor-validation-error",role:"alert",children:[b.jsx("span",{className:"error-sigil",children:"⚠"}),y.message]}),b.jsxs("div",{className:"editor-body",style:{position:"relative"},children:[C?b.jsx("div",{className:"editor-content overlay","aria-hidden":"true",style:{position:"absolute",inset:0,pointerEvents:v?"none":"auto",opacity:v?.2:1},onClick:K=>{const Z=K.target;Z?.classList?.contains("editor-word")&&c?.(Z.innerText),z.current?.focus()},dangerouslySetInnerHTML:{__html:C}}):null,b.jsxs(tu,{initialConfig:W,children:[b.jsx(Gu,{contentEditable:b.jsx(Qu,{className:"editor-content"}),placeholder:b.jsx("div",{className:"editor-placeholder",children:"Inscribe thy verses upon this sacred parchment..."}),ErrorBoundary:dd}),b.jsx(id,{}),b.jsx(sd,{}),b.jsx(gd,{content:e}),b.jsx(ld,{onChange:nt}),b.jsx(pd,{onWordClick:c})]},`${a}-${e}`)]}),b.jsxs("div",{className:"editor-footer",children:[b.jsxs("div",{className:"editor-hint",children:[b.jsx("kbd",{children:"Ctrl"}),"+",b.jsx("kbd",{children:"S"})," to save",i&&b.jsxs(b.Fragment,{children:[" ","· ",b.jsx("kbd",{children:"Esc"})," to cancel"]}),B&&b.jsxs("span",{className:"editor-warning",children:["Reduce by ",Math.abs(F)," chars to save"]})]}),b.jsxs("div",{className:"editor-actions",children:[i&&b.jsx("button",{type:"button",className:"editor-btn editor-btn--secondary",onClick:i,disabled:g,children:"Cancel"}),b.jsx("button",{type:"button",className:"editor-btn editor-btn--primary",onClick:G,disabled:o||g||!S.current.trim()||B,children:g?b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"btn-sigil spinning",children:"☼"}),"Inscribing..."]}):b.jsxs(b.Fragment,{children:[b.jsx("span",{className:"btn-sigil",children:"★"}),s?"Update Scroll":"Save Scroll"]})})]}),Q&&b.jsxs("div",{className:"editor-validation-error",role:"alert",children:[b.jsx("span",{className:"error-sigil",children:"⚠"}),y.message]})]})]})}function Sd(n){const e=new Date(n),r=new Date-e,i=Math.floor(r/6e4),s=Math.floor(r/36e5),o=Math.floor(r/864e5);return i<1?"Just now":i<60?`${i}m ago`:s<24?`${s}h ago`:o<7?`${o}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}function Cd(n,e=80){return n.length<=e?n:n.slice(0,e).trim()+"..."}function bd({scrolls:n,activeScrollId:e,onSelect:t,onDelete:r,onNewScroll:i}){return b.jsxs("div",{className:"scroll-list",children:[b.jsxs("div",{className:"scroll-list-header",children:[b.jsxs("h3",{className:"scroll-list-title",children:[b.jsx("span",{className:"title-sigil",children:"📜"}),"Saved Scrolls",b.jsx("span",{className:"scroll-count",children:n.length})]}),b.jsxs("button",{type:"button",className:"new-scroll-btn",onClick:i,title:"Create new scroll",children:[b.jsx("span",{children:"✚"})," New"]})]}),b.jsx("div",{className:"scroll-list-body",children:b.jsx(ra,{mode:"popLayout",children:n.length===0?b.jsxs(zn.div,{className:"scroll-empty",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[b.jsx("div",{className:"empty-sigil",children:"✨"}),b.jsx("p",{children:"No scrolls yet"}),b.jsx("span",{children:"Begin thy first inscription above"})]}):n.map(s=>b.jsxs(zn.div,{className:`scroll-item ${e===s.id?"scroll-item--active":""}`,initial:{opacity:0,x:-10},animate:{opacity:1,x:0},exit:{opacity:0,x:10},transition:{duration:.15},layout:!0,children:[b.jsxs("button",{type:"button",className:"scroll-item-main",onClick:()=>t(s.id),children:[b.jsx("div",{className:"scroll-item-title",children:s.title||"Untitled Scroll"}),b.jsx("div",{className:"scroll-item-preview",children:Cd(s.content)}),b.jsxs("div",{className:"scroll-item-meta",children:[b.jsxs("span",{className:"scroll-word-count",children:[s.content.trim().split(/\s+/).length," words"]}),b.jsx("span",{className:"scroll-date",children:Sd(s.updatedAt)})]})]}),b.jsx("button",{type:"button",className:"scroll-delete-btn",onClick:o=>{o.stopPropagation(),confirm("Delete this scroll permanently?")&&r(s.id)},title:"Delete scroll","aria-label":"Delete scroll",children:"✕"})]},s.id))})})]})}const Nd=2250,Zt={VOID:1,PSYCHIC:0,ALCHEMY:0,WILL:0,SONIC:0};function wd(){const{isReady:n,engine:e,revision:t}=ia(),{scrolls:r,createScroll:i,updateScroll:s,deleteScroll:o,getScrollById:l}=fa(),[a,c]=M.useState(null),[u,f]=M.useState(null),[d,p]=M.useState("VOID"),[h,m]=M.useState(Zt),[g,_]=M.useState(!0),y=M.useRef(!1),x=M.useRef(null),C=M.useRef(0),w=!!u,v=u?l(u):null;M.useEffect(()=>{!u&&r.length&&f(r[0].id)},[u,r]);const T=M.useCallback(F=>{if(!F?.trim()||!e?.getTokenResult)return{scores:Zt,dominant:"VOID"};const U=(F.match(/[A-Za-z']+/g)||[]).slice(-160);if(!U.length)return{scores:Zt,dominant:"VOID"};const W=U.map(G=>e.getTokenResult(G)).filter(Boolean).map(G=>{const Q=Bn(G,"rhyme"),ne=Bn(G,"phoneme"),K=ne?ne.split(/\s+/).filter(Boolean).length:0,Z=G.evidence.find(he=>he.type==="phoneme"&&he.value.startsWith("coda:")),ke=Z?Z.value.slice(5):null,be=G.evidence.filter(he=>he.type==="usage"&&he.value.startsWith("coda-group:")).map(he=>he.value.slice(11)),Me=G.chips.find(he=>he.type==="school")?.label||"VOID";return{coda:ke,codaGroups:be,rhymeKey:Q,phonemeCount:K,school:Me}});if(!W.length)return{scores:Zt,dominant:"VOID"};const ce=new Array(W.length).fill(0);for(let G=1;G<W.length;G++){const Q=W[G-1],ne=W[G];let K=0;Q.rhymeKey&&ne.rhymeKey&&Q.rhymeKey===ne.rhymeKey?K=.6:Q.coda&&ne.coda&&(Q.codaGroups?.length&&ne.codaGroups?.length&&Q.codaGroups.some(ke=>ne.codaGroups.includes(ke))||Q.coda===ne.coda)&&(K=.35),K&&(ce[G]+=K,ce[G-1]+=K*.6)}const te={VOID:0,PSYCHIC:0,ALCHEMY:0,WILL:0,SONIC:0};W.forEach((G,Q)=>{const ne=G.coda?G.coda.split(/[^A-Z]+/).filter(Boolean):[],K=Math.min(1.2,ne.length*.35),Z=Math.min(.8,Math.max(0,G.phonemeCount-2)*.06),ke=1+K+Z+ce[Q];te[G.school]+=ke});let xe="VOID",nt=-1;return Object.entries(te).forEach(([G,Q])=>{Q>nt&&(nt=Q,xe=G)}),{scores:te,dominant:xe}},[e]),S=M.useCallback(F=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{if(!F?.trim()){m(Zt),p("VOID");return}const{scores:U,dominant:W}=T(F);m(U),p(W),_(!0)},Nd)},[T]);M.useEffect(()=>()=>{x.current&&clearTimeout(x.current)},[]),M.useEffect(()=>{if(y.current||typeof document>"u"||document.documentElement.dataset.visualTest!=="true"||!e?.getTokenResult)return;const F=(v?.content||"").trim().split(/\s+/)[0];F&&(y.current=!0,P(F))},[v,e,P]);const N=M.useMemo(()=>{const[F,U,W]=sa(h),ce=`rgb(${F}, ${U}, ${W})`,te=`rgba(${F}, ${U}, ${W}, 0.18)`,xe=`rgba(${F}, ${U}, ${W}, 0.45)`;return{"--school-accent":ce,"--school-accent-soft":te,"--school-accent-glow":xe}},[h]),P=M.useCallback(F=>{if(!e?.getTokenResult)return;const U=e.getTokenResult(F);c(U);const W=C.current+1;C.current=W,e.requestEnrichment(F).then(()=>{C.current===W&&c(e.getTokenResult(F))}).catch(()=>{})},[e]),R=M.useCallback((F,U)=>{if(w&&u)s(u,{title:F,content:U});else{const ce=i(F,U);f(ce.id)}const W=U.split(/\s+/)[0];W&&P(W)},[w,u,s,i,P]),z=M.useCallback(F=>{o(F),u===F&&f(null)},[u,o]),$=()=>{f(null)},B=oa({view:"editor",overlay:a?"open":"closed",school:d});return b.jsxs("section",{className:`readPage surface ${B} ${g?"rhyme-idle":""}`,"data-surface":"read",style:N,children:[b.jsxs("div",{className:"read-layout",children:[b.jsx("aside",{className:"read-sidebar",children:b.jsx(bd,{scrolls:r,activeScrollId:u,onSelect:f,onDelete:z,onNewScroll:$})}),b.jsx("main",{className:"read-stage","data-surface":"workbench",children:b.jsx(vd,{initialTitle:v?v.title:"",initialContent:v?v.content:"",onSave:R,onContentChange:S,onWordClick:P,isEditing:w,disabled:!n,colorEngine:e,engineRevision:t},u||"new")})]}),a&&b.jsx(ha,{annotation:a,onClose:()=>c(null)})]})}export{wd as default};
